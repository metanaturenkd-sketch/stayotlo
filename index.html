<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ArchDoor Ventures | OTLO Collection</title>
    <link rel="icon" href="logo/logo.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f7; color: #1d1d1f; -webkit-font-smoothing: antialiased; }
        .brand-gradient { background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%); }
        .brand-gradient-text { background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .font-display { font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: 2.25rem; text-transform: uppercase; letter-spacing: 0.2em; }
        @media (min-width: 768px) { .font-display { font-size: 3.25rem; } }

        /* Enhanced Navigation Glass Effect */
        .nav-glass { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); border-bottom: 1px solid rgba(0, 0, 0, 0.05); }

        /* Mobile Menu Glass Effect */
        .mobile-menu-glass { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(24px); 
            -webkit-backdrop-filter: blur(24px); 
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        /* Sliders */
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; background: #e5e5e5; border-radius: 4px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: #1d1d1f; border-radius: 50%; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.2); border: 2px solid #fff; transition: transform 0.2s; }
        input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }

        /* 360 Viewer Overrides & Structural Fixes */
        .slider-360 {
            -webkit-appearance: none;
            height: 4px !important;
            background: rgba(0,0,0,0.15) !important;
            border-radius: 10px;
            outline: none;
        }

        .slider-360::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px !important;
            height: 18px !important;
            background: #1d1d1f !important;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #fff !important;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .slider-360::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }

        /* ===== EXPERIENCE 360 RESPONSIVE FIXES ===== */
        .experience-360-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .experience-360-canvas {
            width: 100%;
            height: auto;
            aspect-ratio: 1458 / 774;
            max-height: 75vh;
            object-fit: contain;
            display: block;
            touch-action: pan-y; /* allows page scrolling while touching horizontally */
        }

        /* AMENITIES CARD STYLES */
        .select-card { 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            border: 2px solid #e5e7eb; 
            background-color: white; 
            cursor: pointer;
            position: relative;
        }
        .select-card:hover { transform: translateY(-1px); border-color: #d1d5db; }
        
        .select-card .amenity-title { color: #1f2937; }
        .select-card .amenity-subtext { color: #6b7280; }

        .select-card.active { 
            background-color: #22c55e; 
            border-color: #22c55e; 
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        .select-card.active .amenity-title { color: white; }
        .select-card.active .amenity-subtext { color: rgba(255,255,255,0.8); }
        .select-card.active input[type="range"] { background: rgba(255,255,255,0.3); }
        .select-card.active input[type="range"]::-webkit-slider-thumb { background: white; border-color: white; box-shadow: none; }
        .select-card .opt-in-control { display: none; }
        .select-card.active .opt-in-control { display: block; animation: fadeIn 0.3s ease; }

        /* Carousel */
        .carousel-track { 
            display: flex; 
            transition: transform 3s cubic-bezier(0.19, 1, 0.22, 1); 
            will-change: transform;
        }
        .carousel-slide { min-width: 100%; transition: opacity 0.6s ease; position: relative; }
        
        /* Image Quality & Slower Fade */
        .gallery-image, .plan-image, .explode-layer { 
            will-change: opacity, transform;
        }
        .gallery-image { 
            position: absolute; 
            inset: 0; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            transition: opacity 2.5s ease-in-out; 
        }
        .gallery-image.active { opacity: 1; z-index: 10; }
        .gallery-image.inactive { opacity: 0; z-index: 0; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes textReveal { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-text-reveal { animation: textReveal 1s ease-out forwards; }
        .flash-update { animation: flash 0.4s ease-out; }
        @keyframes flash { 0% { background-color: rgba(34, 197, 94, 0.1); } 100% { background-color: transparent; } }

        /* Custom SVG Diagram Animations */
        @keyframes dashMarch { to { stroke-dashoffset: -24; } }
        @keyframes pulseFill { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; fill: #000; } }
        @keyframes slideRight { 0% { transform: translateX(0); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        
        .group:hover .svg-animate-dash { animation: dashMarch 1s linear infinite; }
        .group:hover .svg-animate-pulse { animation: pulseFill 2s ease-in-out infinite; }
        .group:hover .svg-animate-slide { animation: slideRight 1.5s ease-in-out infinite; }

        /* Reveal on Scroll */
        .reveal-on-scroll { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .reveal-on-scroll.visible { opacity: 1; transform: translateY(0); }

        /* Utils */
        .calc-tab-btn.active { color: #000; border-bottom: 2px solid #000; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Scenario Button Styles */
        .scenario-dot { width: 24px; height: 24px; border-radius: 50%; border: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; transition: all 0.2s; background: white; color: #9ca3af; }
        .scenario-dot:hover { border-color: #000; color: #000; }
        .scenario-dot.active { background: #22c55e; color: white; border-color: #22c55e; } 
        .scenario-dot.has-data { border-color: #9ca3af; color: #000; } 
        
        /* Mobile Menu */
        #mobile-menu { transition: opacity 0.3s ease, transform 0.3s ease; }
        #mobile-menu.hidden { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        #mobile-menu:not(.hidden) { opacity: 1; pointer-events: auto; transform: translateY(0); }

        .mobile-calc-footer { box-shadow: 0 -4px 20px rgba(0,0,0,0.05); }

        /* Architectural Patterns */
        .arch-grid {
            background-image: linear-gradient(to right, #e5e7eb 1px, transparent 1px),
                              linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
            background-size: 40px 40px;
        }
        .arch-grid-dark {
            background-image: linear-gradient(to right, rgba(255,255,255,0.015) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255,255,255,0.015) 1px, transparent 1px);
            background-size: 16px 16px;
        }

        /* Floor Plan Slideshow */
        .plan-image { 
            position: absolute; 
            inset: 0; 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
            transition: opacity 1.5s ease-in-out; 
            filter: invert(1);
            mix-blend-mode: screen;
            will-change: opacity;
            transform: scale(1.08) translateZ(0);
        }
        .plan-image.active { opacity: 1; z-index: 10; }
        .plan-image.inactive { opacity: 0; z-index: 0; pointer-events: none; }
        
        #plan-modal-img {
            filter: invert(1);
            mix-blend-mode: screen;
        }

        /* Exploded View Anatomy Styles */
        .explode-wrapper {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            transition: transform 2.5s cubic-bezier(0.19, 1, 0.22, 1);
            transform-style: preserve-3d;
            backface-visibility: hidden;
            position: relative;
        }
        .explode-layer {
            position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain;
            transition: all 2.5s cubic-bezier(0.19, 1, 0.22, 1);
            will-change: transform, opacity;
            transform: translateZ(0);
            opacity: 1; /* Safety override to ensure visibility */
        }
        .explode-view { z-index: 10; opacity: 1; cursor: pointer; }
        .explode-shell { z-index: 3; pointer-events: none; }
        .explode-interior { z-index: 2; pointer-events: none; }
        .explode-base { z-index: 1; pointer-events: none; }

        /* Exploded State - Tightly controlled spreading to prevent boundary cuts */
        #explode-stage.is-exploded .explode-view { opacity: 0; pointer-events: none; }
        #explode-stage.is-exploded .explode-interior { pointer-events: auto; cursor: zoom-in; opacity: 1;}
        #explode-stage.is-exploded .explode-base { pointer-events: auto; opacity: 1;}
        #explode-stage.is-exploded .explode-shell { opacity: 1;}
        
        #explode-stage.is-exploded .explode-wrapper { transform: scale(0.35) translateY(5%); }
        #explode-stage.is-exploded .explode-shell { transform: translateY(-75%); filter: drop-shadow(0 20px 40px rgba(0,0,0,0.12)); }
        #explode-stage.is-exploded .explode-interior { transform: translateY(0%); filter: drop-shadow(0 20px 40px rgba(0,0,0,0.12)); }
        #explode-stage.is-exploded .explode-base { transform: translateY(75%); filter: drop-shadow(0 20px 40px rgba(0,0,0,0.12)); }

        /* Focused State (Zoom) */
        #explode-stage.is-focused .explode-wrapper { transform: scale(0.95) translateY(2%); cursor: zoom-out; }
        #explode-stage.is-focused .explode-shell { transform: translateY(-100%); opacity: 0; }
        #explode-stage.is-focused .explode-base { transform: translateY(100%); opacity: 0; }
        #explode-stage.is-focused .explode-interior { cursor: zoom-out; opacity: 1;}

        /* Explode UI Toggle Pill */
        .glass-toggle { width: 88px; height: 48px; border-radius: 24px; padding: 4px; position: relative; display: flex; }
        .glass-highlight { position: absolute; width: 40px; height: 40px; background: #000; border-radius: 50%; left: 4px; top: 4px; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

        /* PRINT STYLES */
        .print-only-header { display: none; }
        @media print {
            @page { margin: 0.5cm; }
            body { background-color: white; color: black; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            nav, #bg-music, .fixed.bottom-6, #tab-philosophy, #tab-benchmarks, #tab-concepts, .mobile-calc-footer, #export-modal, button, .toggle-wrapper { display: none !important; }
            #tab-calculator { display: block !important; height: auto !important; overflow: visible !important; min-height: 0 !important; }
            .print-only-header { display: block !important; margin-bottom: 20px; border-bottom: 4px solid black; padding-bottom: 20px; }
            .grid { display: block !important; }
            .lg\:col-span-5 { display: none !important; }
            .lg\:col-span-7 { width: 100% !important; border: none !important; padding: 0 !important; overflow: visible !important; height: auto !important; }
            #results-panel { height: auto !important; overflow: visible !important; }
            #results-panel > .grid { display: grid !important; grid-template-columns: 1fr 1fr 1fr 1fr !important; gap: 10px; page-break-inside: avoid; }
            .bg-white { box-shadow: none !important; border: 1px solid #eee !important; margin-bottom: 20px; break-inside: avoid; }
            .bg-gray-50 { background-color: #fff !important; border: 1px solid #eee !important; }
            canvas { max-width: 100% !important; max-height: 300px !important; margin-bottom: 20px; }
            h1, h2, h3, h4, p, span { color: black !important; }
            .bg-black { background-color: #111 !important; color: white !important; }
            .bg-black p, .bg-black span { color: white !important; }
        }
    </style>
</head>
<body class="antialiased selection:bg-black selection:text-white overflow-x-hidden text-gray-900 pb-24 lg:pb-0">

    <!-- Added autoplay and preload="auto" to start loading the audio immediately -->
    <audio id="bg-music" loop autoplay preload="auto"><source src="music/borealis.mp3" type="audio/mpeg"></audio>

    <nav class="fixed top-0 w-full z-50 nav-glass transition-all duration-300">
        <div class="max-w-screen-2xl mx-auto px-4 md:px-6 h-16 md:h-20 flex justify-between items-center relative">
            
            <div class="flex items-center gap-3 cursor-pointer shrink-0 w-[240px]" onclick="switchTab('concepts')">
                <img src="logo/logo.png" alt="ArchDoor Logo" class="w-8 h-8 object-contain" onerror="this.style.display='none'">
                <div class="text-base md:text-lg font-bold tracking-tight uppercase whitespace-nowrap">ArchDoor Ventures</div>
            </div>
            
            <div class="hidden md:flex justify-between w-[550px] lg:w-[680px] text-[10px] lg:text-xs font-semibold uppercase tracking-widest text-gray-500 h-full items-center">
                <button onclick="switchTab('concepts')" class="transition-colors nav-btn text-black font-extrabold hover:opacity-80" data-target="concepts">
                    OTLO Collection
                </button>
                <button onclick="switchTab('philosophy')" class="hover:text-black transition-colors nav-btn" data-target="philosophy">Philosophy</button>
                <button onclick="switchTab('benchmarks')" class="hover:text-black transition-colors nav-btn" data-target="benchmarks">Benchmarks</button>
                <button onclick="switchTab('calculator')" class="hover:text-black transition-colors nav-btn" data-target="calculator">Investor Engine</button>
            </div>

            <div class="hidden md:flex w-48 shrink-0 justify-end"></div>

            <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-black focus:outline-none absolute right-4">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <div id="mobile-menu" class="hidden absolute top-16 left-0 w-full mobile-menu-glass md:hidden flex-col p-6 space-y-4 text-center z-40 transition-all duration-300">
            <button onclick="switchTab('concepts'); toggleMobileMenu()" class="block w-full py-4 text-sm font-extrabold uppercase tracking-widest text-black border-b border-gray-100/50">OTLO Collection</button>
            <button onclick="switchTab('philosophy'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800 border-b border-gray-100/50">Philosophy</button>
            <button onclick="switchTab('benchmarks'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800 border-b border-gray-100/50">Benchmarks</button>
            <button onclick="switchTab('calculator'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800">Investor Engine</button>
        </div>
    </nav>

    <main class="pt-16 md:pt-20">

        <section id="tab-philosophy" class="tab-content hidden min-h-screen animate-fade-in flex flex-col bg-white">
            <div class="relative w-full border-b border-gray-200">
                <div class="absolute inset-0 arch-grid opacity-30 pointer-events-none"></div>
                <div class="absolute inset-0 bg-gradient-to-b from-white/0 to-white/80 pointer-events-none"></div>
                
                <div class="relative max-w-screen-xl mx-auto px-6 text-center pt-20 md:pt-32 pb-16 md:pb-24 z-10">
                    <h1 class="text-5xl md:text-8xl lg:text-[10rem] font-bold tracking-tighter leading-none mb-8 text-black opacity-0 animate-fade-in" style="animation-delay: 0.1s">
                        DESIGN IS <br><span class="brand-gradient-text">LEVERAGE.</span>
                    </h1>
                    <div class="w-20 h-1 bg-black mx-auto mb-8 opacity-0 animate-fade-in" style="animation-delay: 0.3s"></div>
                    <p class="text-lg md:text-3xl max-w-4xl mx-auto font-light leading-relaxed text-gray-600 mb-12 opacity-0 animate-fade-in" style="animation-delay: 0.4s">
                        We align <strong class="text-black font-semibold">architectural innovation</strong> with <strong class="text-black font-semibold">institutional capital</strong> to develop assets that define the next era of hospitality.
                    </p>
                </div>
            </div>

            <div class="w-full border-b border-gray-200 bg-white">
                <div class="max-w-6xl mx-auto px-6 py-12">
                    <div class="grid grid-cols-2 md:grid-cols-4 divide-x divide-gray-100 reveal-on-scroll">
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">14.2%</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">Eco-Tourism CAGR</p>
                        </div>
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">$1.2T</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">Wellness Economy (2025)</p>
                        </div>
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">45%</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">ADR Premium</p>
                        </div>
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">High</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">Barrier to Entry (Design)</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="w-full bg-gray-50/50 py-20 md:py-32">
                <div class="max-w-7xl mx-auto px-6">
                    <div class="grid lg:grid-cols-2 gap-16 md:gap-24 mb-24 md:mb-32 reveal-on-scroll items-start">
                        
                        <div class="space-y-10 sticky top-24">
                            <div>
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-6 h-px bg-blue-600"></div>
                                    <h3 class="text-xs font-bold uppercase tracking-widest text-blue-600">Design as Value Creation</h3>
                                </div>
                                <h2 class="text-4xl md:text-6xl font-bold mb-6 text-black tracking-tight leading-tight">Architecture as the<br>Anchor Amenity</h2>
                                <p class="text-gray-600 leading-relaxed text-lg font-light border-l-2 border-gray-200 pl-6">
                                    In the micro-resort model, the architecture isn't just shelter—it's the product. We leverage <strong>biophilic principles</strong> and <strong>site-specific modularity</strong> to turn challenging terrain into high-yield inventory.
                                </p>
                            </div>
                            <ul class="space-y-6">
                                <li class="group flex items-start gap-4 p-4 hover:bg-white hover:shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-100">
                                    <span class="w-3 h-3 mt-1.5 border border-black bg-transparent group-hover:bg-black transition-colors duration-300 shrink-0"></span>
                                    <div>
                                        <strong class="block text-black mb-1 text-sm uppercase tracking-wider">Modular & Adaptive</strong>
                                        <span class="text-gray-500 font-light">Prefabricated units reduce construction timelines by 40%.</span>
                                    </div>
                                </li>
                                <li class="group flex items-start gap-4 p-4 hover:bg-white hover:shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-100">
                                    <span class="w-3 h-3 mt-1.5 border border-black bg-transparent group-hover:bg-black transition-colors duration-300 shrink-0"></span>
                                    <div>
                                        <strong class="block text-black mb-1 text-sm uppercase tracking-wider">Experiential Layouts</strong>
                                        <span class="text-gray-500 font-light">Floor plans optimized for wellness and social connection.</span>
                                    </div>
                                </li>
                                <li class="group flex items-start gap-4 p-4 hover:bg-white hover:shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-100">
                                    <span class="w-3 h-3 mt-1.5 border border-black bg-transparent group-hover:bg-black transition-colors duration-300 shrink-0"></span>
                                    <div>
                                        <strong class="block text-black mb-1 text-sm uppercase tracking-wider">Sustainable Luxury</strong>
                                        <span class="text-gray-500 font-light">Passive solar design and off-grid capabilities.</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="bg-white p-10 md:p-12 rounded-[2rem] shadow-xl shadow-gray-100/50 border border-gray-100 relative">
                            <div class="absolute inset-0 arch-grid opacity-10 pointer-events-none rounded-[2rem]"></div>
                            <div class="relative z-10">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-10 text-center">The Value Creation Cycle</h3>
                                <div class="relative">
                                    <div class="absolute left-[23px] top-4 bottom-4 w-px bg-gradient-to-b from-gray-200 via-gray-300 to-gray-200"></div>
                                    
                                    <div class="space-y-12">
                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 22h20M2 22V2l20 20"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Distinctive Design</h4>
                                                <p class="text-sm text-gray-500 font-light">Architecture as the primary marketing asset.</p>
                                            </div>
                                        </div>

                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Viral Visibility</h4>
                                                <p class="text-sm text-gray-500 font-light">Organic reach reduces marketing CAC significantly.</p>
                                            </div>
                                        </div>

                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Pricing Power</h4>
                                                <p class="text-sm text-gray-500 font-light">Scarcity drives 45% ADR premiums vs. market.</p>
                                            </div>
                                        </div>

                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Asset Valuation</h4>
                                                <p class="text-sm text-gray-500 font-light">Superior NOI yields higher exit multiples.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-24 md:mb-32 reveal-on-scroll">
                        <div class="text-center mb-16">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-purple-600 mb-3">Market Positioning</h3>
                            <h2 class="text-4xl md:text-5xl font-bold">Defining the Asset Class</h2>
                        </div>
                        <div class="overflow-hidden rounded-3xl border border-gray-200 bg-white shadow-sm">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-50 text-xs font-bold uppercase text-gray-500 tracking-wider">
                                    <tr>
                                        <th class="px-8 py-6">Metric</th>
                                        <th class="px-8 py-6 font-medium">Traditional Hotel</th>
                                        <th class="px-8 py-6 font-medium">Boutique Hotel</th>
                                        <th class="px-8 py-6 bg-black text-white text-base tracking-widest">Micro-Resort</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Guest Experience</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Standardized</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Curated</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">Hyper-Immersive</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Capital Intensity</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">High ($300k+/key)</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Medium ($200k+/key)</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">Optimized ($100-200k/key)</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Staffing Model</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Heavy (0.75 FTE/Key)</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Medium (0.5 FTE/Key)</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">Lean (0.2 FTE/Key)</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Development Speed</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">24-36 Months</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">18-24 Months</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">6-12 Months</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">GOP Margin</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">25-35%</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">30-40%</td>
                                        <td class="px-8 py-6 font-bold text-green-600 border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">50-65%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="reveal-on-scroll pb-20 mb-20">
                        <div class="grid lg:grid-cols-2 gap-12 md:gap-20 mb-12 items-center">
                            <div>
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-6 h-px bg-green-600"></div>
                                    <h3 class="text-xs font-bold uppercase tracking-widest text-green-600">The Future of Hospitality (2025-2035)</h3>
                                </div>
                                <h2 class="text-3xl md:text-5xl font-bold mb-6">Diversified Revenue Streams</h2>
                                <p class="text-gray-600 leading-relaxed text-lg font-light">Unlike traditional hotels that rely heavily on room revenue, micro-resorts unlock significant wallet share through on-site experiences. Our model targets a <strong>50/50 split</strong> between Room Revenue and Experience Revenue.</p>
                            </div>
                             <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 flex flex-col group hover:shadow-md transition-all duration-500 h-full">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">Asset Appreciation Potential (5-Year)</h3>
                                <div class="relative h-64 w-full flex-grow"><canvas id="growthChart"></canvas></div>
                            </div>
                        </div>

                        <div class="grid lg:grid-cols-2 gap-8 md:gap-12">
                            <div class="bg-white p-8 rounded-[2rem] border border-gray-200 shadow-lg relative overflow-hidden group flex flex-col h-full">
                                <div class="absolute inset-0 arch-grid opacity-5 pointer-events-none"></div>
                                <h4 class="text-xs font-bold uppercase text-gray-400 mb-6 tracking-widest">Revenue Composition Comparison</h4>
                                <div class="relative h-64 w-full flex-grow">
                                    <canvas id="compositionChart"></canvas>
                                </div>
                            </div>

                            <div class="bg-black text-white p-8 rounded-[2rem] shadow-2xl flex flex-col relative overflow-hidden group h-full justify-between">
                                <div class="absolute -right-10 -top-10 w-40 h-40 bg-gray-800 rounded-full blur-3xl opacity-20 group-hover:opacity-40 transition-opacity duration-700"></div>
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 relative z-10">Daily Revenue Potential (RevPAR)</h3>
                                <div class="relative h-64 w-full flex-grow z-10"><canvas id="revparChart"></canvas></div>
                                <p class="text-[10px] text-gray-500 mt-6 text-center relative z-10 uppercase tracking-widest">Reflects Ancillary Revenue Uplift • Currency: <span id="chart-currency-label">USD</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-benchmarks" class="tab-content hidden min-h-screen bg-gray-50 relative">
            <div class="absolute inset-0 arch-grid opacity-20 pointer-events-none"></div>
            <div class="py-8 md:py-12 px-6 border-b border-gray-200 bg-white sticky top-16 md:top-20 z-10 shadow-sm md:shadow-none">
                <div class="max-w-7xl mx-auto text-center">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1 block">Market Analysis</span>
                    <h1 class="text-3xl md:text-5xl font-bold tracking-tighter mb-4 text-black">BENCHMARKS.</h1>
                    <div class="mt-2 inline-flex bg-gray-100 p-1 rounded-full">
                        <button onclick="filterBenchmarks('USA')" id="btn-usa" class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest transition-all shadow-sm bg-white text-black">USA</button>
                        <button onclick="filterBenchmarks('IND')" id="btn-ind" class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest transition-all text-gray-500 hover:text-black">India</button>
                    </div>
                </div>
            </div>
            <div class="max-w-7xl mx-auto px-4 md:px-6 py-8 md:py-12"><div id="benchmark-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div></div>
        </section>

        <section id="tab-concepts" class="tab-content min-h-screen bg-white relative">

            <div id="otlo-subnav-sticky" class="sticky top-16 md:top-20 z-50 w-full bg-slate-900/85 backdrop-blur-2xl border-b border-white/10 shadow-md">
                <div class="w-full overflow-x-auto no-scrollbar py-2.5">
                    <div class="max-w-screen-2xl mx-auto px-4 md:px-6 flex items-center justify-between">
                        <div class="w-[240px] hidden md:block shrink-0"></div>
                        
                        <div class="flex items-center justify-between w-[550px] lg:w-[680px] text-[9px] md:text-[10px] font-bold uppercase tracking-widest transition-all shrink-0">
                            <button data-section="otlo-intro" onclick="scrollToConceptSection('otlo-intro')" class="subnav-btn px-4 py-1.5 rounded-full transition-all whitespace-nowrap text-white/60 bg-transparent hover:text-white">Gallery</button>
                            <button data-section="otlo-meaning" onclick="scrollToConceptSection('otlo-meaning')" class="subnav-btn px-4 py-1.5 rounded-full transition-all whitespace-nowrap text-white/60 bg-transparent hover:text-white">Vision</button>
                            <button data-section="otlo-spatial" onclick="scrollToConceptSection('otlo-spatial')" class="subnav-btn px-4 py-1.5 rounded-full transition-all whitespace-nowrap text-white/60 bg-transparent hover:text-white">Spatial Flow</button>
                            <button data-section="otlo-360" onclick="scrollToConceptSection('otlo-360')" class="subnav-btn px-4 py-1.5 rounded-full transition-all whitespace-nowrap text-white/60 bg-transparent hover:text-white">360° View</button>
                            <button data-section="otlo-anatomy" onclick="scrollToConceptSection('otlo-anatomy')" class="subnav-btn px-4 py-1.5 rounded-full transition-all whitespace-nowrap text-white/60 bg-transparent hover:text-white">Anatomy</button>
                            <button data-section="otlo-amenities" onclick="scrollToConceptSection('otlo-amenities')" class="subnav-btn px-4 py-1.5 rounded-full transition-all whitespace-nowrap text-white/60 bg-transparent hover:text-white">Amenities</button>
                        </div>

                        <div class="w-48 hidden md:block shrink-0"></div>
                    </div>
                </div>
            </div>

            <div id="otlo-intro" class="relative w-full h-[calc(100vh-130px)] bg-black overflow-hidden group scroll-mt-32">
                
                <div class="absolute top-4 md:top-6 right-4 md:right-6 z-40">
                    <button onclick="toggleMute()" id="mute-btn" class="text-white hover:text-white/70 transition-colors drop-shadow-md">
                        <svg id="sound-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <!-- Play icon state -> showing playing visually by default -->
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="carousel-track h-full" id="carousel-track" style="will-change: transform;">
                    <div class="carousel-slide min-w-full h-full relative group">
                        <div class="absolute inset-0 z-0 bg-gray-900" id="gallery-mountain">
                            <img src="images/msd.png" class="gallery-image active" data-index="0" onerror="this.src='https://images.unsplash.com/photo-1542718610-a1d656d1884c?auto=format&fit=crop&q=80'">
                            <img src="images/msn.png" loading="lazy" class="gallery-image inactive" data-index="1" onerror="this.src='https://images.unsplash.com/photo-1510798831971-661eb04b3739?auto=format&fit=crop&q=80'">
                            <img src="images/mcd.png" loading="lazy" class="gallery-image inactive" data-index="2" onerror="this.src='https://images.unsplash.com/photo-1449844908441-8829872d2607?auto=format&fit=crop&q=80'">
                            <img src="images/mcn.png" loading="lazy" class="gallery-image inactive" data-index="3" onerror="this.src='https://images.unsplash.com/photo-1518733057094-95b53143d2a7?auto=format&fit=crop&q=80'">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent z-20"></div>
                        </div>
                        <div class="absolute bottom-24 md:bottom-32 right-6 md:right-10 z-30 flex gap-2">
                            <button onclick="cycleInternalImage('gallery-mountain', -1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">←</button>
                            <button onclick="cycleInternalImage('gallery-mountain', 1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">→</button>
                        </div>
                    </div>
                    <div class="carousel-slide min-w-full h-full relative group">
                        <div class="absolute inset-0 z-0 bg-gray-900" id="gallery-lake">
                            <img src="images/lsd.png" class="gallery-image active" data-index="0" onerror="this.src='https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?auto=format&fit=crop&q=80'">
                            <img src="images/lsn.png" loading="lazy" class="gallery-image inactive" data-index="1" onerror="this.src='https://images.unsplash.com/photo-1504280390224-4bc343058814?auto=format&fit=crop&q=80'">
                            <img src="images/lcd.png" loading="lazy" class="gallery-image inactive" data-index="2" onerror="this.src='https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80'">
                            <img src="images/lcn.png" loading="lazy" class="gallery-image inactive" data-index="3" onerror="this.src='https://images.unsplash.com/photo-1518732714860-b62714ce0c59?auto=format&fit=crop&q=80'">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent z-20"></div>
                        </div>
                        <div class="absolute bottom-24 md:bottom-32 right-6 md:right-10 z-30 flex gap-2">
                            <button onclick="cycleInternalImage('gallery-lake', -1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">←</button>
                            <button onclick="cycleInternalImage('gallery-lake', 1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">→</button>
                        </div>
                    </div>
                </div>
                <button onclick="moveCarousel(-1)" class="absolute left-2 md:left-6 top-1/2 -translate-y-1/2 z-40 w-10 h-10 md:w-16 md:h-16 rounded-full bg-white/10 backdrop-blur-lg border border-white/20 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300 group"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg></button>
                <button onclick="moveCarousel(1)" class="absolute right-2 md:right-6 top-1/2 -translate-y-1/2 z-40 w-10 h-10 md:w-16 md:h-16 rounded-full bg-white/10 backdrop-blur-lg border border-white/20 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300 group"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg></button>

                <div class="absolute bottom-8 md:bottom-12 left-0 w-full z-40 flex flex-col items-center justify-center pointer-events-none animate-fade-in" style="animation-delay: 0.8s">
                    <img src="logo/logoo.png" alt="OTLO Logo" class="w-24 md:w-32 object-contain mb-4 drop-shadow-xl" style="filter: brightness(0) invert(1);" onerror="this.style.display='none'">
                    <p class="text-[9px] md:text-[10px] font-light uppercase tracking-[0.25em] text-white/70 text-center px-4 leading-relaxed">
                        OTLO SHORES <span class="mx-2 md:mx-4 text-white/30">|</span> 
                        OTLO PEAK <span class="mx-2 md:mx-4 text-white/30">|</span> 
                        OTLO WOODS
                    </p>
                </div>
            </div>

            <div id="otlo-meaning" class="w-full min-h-[calc(100vh-140px)] flex flex-col justify-center py-16 scroll-mt-28">
                <div class="max-w-7xl mx-auto px-6 w-full">
                    
                    <div class="mb-16 max-w-4xl mx-auto text-center reveal-on-scroll relative group cursor-default">
                        <div class="absolute -inset-10 bg-gradient-to-r from-blue-50 via-gray-50 to-green-50 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-1000 blur-xl -z-10"></div>
                        <h2 class="text-4xl md:text-5xl font-bold tracking-tight leading-tight mb-8 relative z-10">The Meaning of OTLO</h2>
                        <div class="w-0 group-hover:w-24 h-px bg-black mx-auto mb-8 transition-all duration-700 relative z-10"></div>
                        <p class="text-xl md:text-3xl text-gray-800 font-light leading-relaxed mb-6 relative z-10 transition-colors duration-500 group-hover:text-black">
                            OTLO is a design-driven micro-resort concept built around a universal architectural idea: <strong class="font-semibold text-black relative inline-block">the threshold<span class="absolute bottom-0 left-0 w-full h-1 bg-green-200 -z-10 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></span></strong>.
                        </p>
                        <p class="text-base md:text-lg text-gray-500 font-light leading-relaxed max-w-3xl mx-auto relative z-10">
                            Inspired by the Gujarati <em>otlo</em> — a transitional porch space between home and street — the project reinterprets this globally recognized spatial archetype (porch, portico, engawa) as a contemporary hospitality experience.
                        </p>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-12 md:gap-8 reveal-on-scroll">
                        
                        <div class="flex flex-col group cursor-default">
                            <div class="bg-gray-50 rounded-[2rem] p-8 mb-8 h-56 flex items-center justify-center border border-gray-100 relative overflow-hidden hover:-translate-y-2 hover:shadow-xl hover:bg-white transition-all duration-500">
                                <div class="absolute inset-0 arch-grid opacity-10 pointer-events-none"></div>
                                <svg viewBox="0 0 300 120" class="w-full h-full relative z-10 stroke-gray-900 fill-none transition-transform duration-500 group-hover:scale-105" stroke-width="1.5">
                                    <rect x="20" y="30" width="50" height="40" stroke-width="1" class="transition-colors duration-500 group-hover:fill-gray-100"/>
                                    <line x1="30" y1="30" x2="30" y2="70" stroke-width="0.5" stroke-opacity="0.4"/>
                                    <line x1="40" y1="30" x2="40" y2="70" stroke-width="0.5" stroke-opacity="0.4"/>
                                    <line x1="50" y1="30" x2="50" y2="70" stroke-width="0.5" stroke-opacity="0.4"/>
                                    <line x1="60" y1="30" x2="60" y2="70" stroke-width="0.5" stroke-opacity="0.4"/>
                                    
                                    <line x1="85" y1="50" x2="105" y2="50" stroke-dasharray="2 2" class="svg-animate-slide" />
                                    <polyline points="100,45 105,50 100,55" stroke-width="1" class="svg-animate-slide"/>
                                    
                                    <rect x="120" y="25" width="60" height="50" stroke-dasharray="4 4" stroke-width="1.5" class="svg-animate-dash transition-colors duration-500 group-hover:stroke-blue-600" />
                                    <circle cx="150" cy="50" r="3" fill="currentColor" stroke="none" class="svg-animate-pulse" />
                                    
                                    <line x1="195" y1="50" x2="215" y2="50" stroke-dasharray="2 2" class="svg-animate-slide" />
                                    <polyline points="210,45 215,50 210,55" stroke-width="1" class="svg-animate-slide" />
                                    
                                    <path d="M 230 70 Q 245 20 260 70 T 290 70" stroke-width="1.5" class="transition-all duration-500 group-hover:stroke-green-600" />
                                    <path d="M 240 70 Q 255 40 270 70" stroke-width="1" stroke-opacity="0.4" class="transition-all duration-500 group-hover:stroke-green-600" />
                                    
                                    <text x="45" y="95" font-size="7" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest">Urban</text>
                                    <text x="150" y="95" font-size="7" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest font-bold transition-colors duration-500 group-hover:fill-blue-600">Threshold</text>
                                    <text x="260" y="95" font-size="7" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-colors duration-500 group-hover:fill-green-600">Nature</text>
                                </svg>
                            </div>
                            <h4 class="text-xs font-bold uppercase tracking-widest text-black mb-4">1. Liminal Environment</h4>
                            <p class="text-sm text-gray-500 font-light leading-relaxed border-l-2 border-transparent group-hover:border-black transition-colors pl-4">
                                Each modular cabin is conceived as a liminal environment positioned between urban life and natural landscape. Rather than isolating guests from nature or fully immersing them in it, OTLO creates calibrated buffer spaces that foster restoration, mindfulness, and social connection.
                            </p>
                        </div>

                        <div class="flex flex-col group cursor-default">
                            <div class="bg-gray-50 rounded-[2rem] p-8 mb-8 h-56 flex items-center justify-center border border-gray-100 relative overflow-hidden hover:-translate-y-2 hover:shadow-xl hover:bg-white transition-all duration-500">
                                <div class="absolute inset-0 arch-grid opacity-10 pointer-events-none"></div>
                                <svg viewBox="0 0 300 120" class="w-full h-full relative z-10 stroke-gray-900 fill-none transition-transform duration-500 group-hover:scale-105" stroke-width="1">
                                    <rect x="30" y="20" width="60" height="30" class="transition-colors duration-500 group-hover:stroke-gray-400" />
                                    <line x1="40" y1="20" x2="40" y2="50" stroke-opacity="0.3"/>
                                    <line x1="80" y1="20" x2="80" y2="50" stroke-opacity="0.3"/>
                                    <text x="60" y="70" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-opacity duration-500 group-hover:opacity-50">Porch</text>

                                    <rect x="120" y="20" width="60" height="30" class="transition-colors duration-500 group-hover:stroke-gray-400" />
                                    <circle cx="135" cy="35" r="8" stroke-opacity="0.3"/>
                                    <circle cx="165" cy="35" r="8" stroke-opacity="0.3"/>
                                    <text x="150" y="70" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-opacity duration-500 group-hover:opacity-50">Portico</text>

                                    <rect x="210" y="20" width="60" height="30" class="transition-colors duration-500 group-hover:stroke-gray-400" />
                                    <line x1="210" y1="35" x2="270" y2="35" stroke-dasharray="2 2" stroke-opacity="0.4"/>
                                    <text x="240" y="70" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-opacity duration-500 group-hover:opacity-50">Engawa</text>

                                    <line x1="60" y1="80" x2="135" y2="100" stroke-dasharray="2 2" class="svg-animate-dash" />
                                    <line x1="150" y1="80" x2="150" y2="90" stroke-dasharray="2 2" class="svg-animate-dash" />
                                    <line x1="240" y1="80" x2="165" y2="100" stroke-dasharray="2 2" class="svg-animate-dash" />

                                    <rect x="130" y="90" width="40" height="20" fill="currentColor" class="transition-all duration-500 group-hover:scale-110 origin-[150px_100px]" />
                                    <text x="150" y="103" font-size="7" stroke="none" fill="white" text-anchor="middle" class="font-bold tracking-widest transition-all duration-500 group-hover:scale-110 origin-[150px_100px]">OTLO</text>
                                </svg>
                            </div>
                            <h4 class="text-xs font-bold uppercase tracking-widest text-black mb-4">2. The Spatial Experience</h4>
                            <p class="text-sm text-gray-500 font-light leading-relaxed border-l-2 border-transparent group-hover:border-black transition-colors pl-4">
                                OTLO is not just accommodation — it is a spatial experience centered on pause, presence, and transition. The concept taps into growing demand for experiential travel, slow living, and wellness-focused retreats.
                            </p>
                        </div>

                        <div class="flex flex-col group cursor-default">
                            <div class="bg-gray-50 rounded-[2rem] p-8 mb-8 h-56 flex items-center justify-center border border-gray-100 relative overflow-hidden hover:-translate-y-2 hover:shadow-xl hover:bg-white transition-all duration-500">
                                <div class="absolute inset-0 arch-grid opacity-10 pointer-events-none"></div>
                                <svg viewBox="0 0 300 130" class="w-full h-full relative z-10 stroke-gray-900 fill-none transition-transform duration-500 group-hover:scale-105" stroke-width="1.5">
                                    <rect x="130" y="10" width="40" height="25" stroke-dasharray="3 3" class="svg-animate-dash transition-colors duration-500 group-hover:stroke-black" />
                                    <circle cx="150" cy="22.5" r="2.5" fill="currentColor" stroke="none" class="svg-animate-pulse" />
                                    <text x="150" y="50" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest font-bold">Core Module</text>

                                    <line x1="150" y1="55" x2="150" y2="65" stroke-width="1" stroke-opacity="0.4" class="transition-opacity duration-500 group-hover:stroke-opacity-100"/>
                                    <line x1="50" y1="65" x2="250" y2="65" stroke-width="1" stroke-opacity="0.4" class="transition-opacity duration-500 group-hover:stroke-opacity-100"/>
                                    <line x1="50" y1="65" x2="50" y2="75" stroke-width="1" stroke-opacity="0.4" class="transition-opacity duration-500 group-hover:stroke-opacity-100"/>
                                    <line x1="150" y1="65" x2="150" y2="75" stroke-width="1" stroke-opacity="0.4" class="transition-opacity duration-500 group-hover:stroke-opacity-100"/>
                                    <line x1="250" y1="65" x2="250" y2="75" stroke-width="1" stroke-opacity="0.4" class="transition-opacity duration-500 group-hover:stroke-opacity-100"/>

                                    <rect x="35" y="75" width="30" height="20" stroke-width="1" class="transition-colors duration-500 group-hover:fill-gray-100" />
                                    <line x1="25" y1="95" x2="25" y2="70" stroke-width="1" stroke-opacity="0.4"/>
                                    <line x1="75" y1="95" x2="75" y2="60" stroke-width="1" stroke-opacity="0.4"/>
                                    <text x="50" y="115" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-transform duration-500 group-hover:font-bold">Forest</text>

                                    <rect x="135" y="75" width="30" height="20" stroke-width="1" class="transition-colors duration-500 group-hover:fill-gray-100" />
                                    <path d="M 120 95 L 140 60 L 155 80 L 165 50 L 180 95" stroke-width="1" stroke-opacity="0.4" />
                                    <text x="150" y="115" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-transform duration-500 group-hover:font-bold">Mountain</text>

                                    <rect x="235" y="75" width="30" height="20" stroke-width="1" class="transition-colors duration-500 group-hover:fill-gray-100" />
                                    <path d="M 220 90 Q 230 85, 240 90 T 260 90 T 280 90" stroke-width="1" stroke-opacity="0.4"/>
                                    <path d="M 220 95 Q 230 90, 240 95 T 260 95 T 280 95" stroke-width="1" stroke-opacity="0.4"/>
                                    <text x="250" y="115" font-size="6" stroke="none" fill="currentColor" text-anchor="middle" class="font-mono uppercase tracking-widest transition-transform duration-500 group-hover:font-bold">Waterfront</text>
                                </svg>
                            </div>
                            <h4 class="text-xs font-bold uppercase tracking-widest text-black mb-4">3. Contextual Scalability</h4>
                            <p class="text-sm text-gray-500 font-light leading-relaxed border-l-2 border-transparent group-hover:border-black transition-colors pl-4">
                                Its modular strategy allows scalable development across forests, mountains, or waterfront contexts while maintaining a strong, culturally resonant brand identity.
                            </p>
                        </div>

                    </div>
                </div>
            </div>

            <div class="w-full bg-white border-t border-gray-100">
                
                <div id="otlo-spatial" class="w-full max-w-[1800px] mx-auto min-h-[calc(100vh-140px)] flex flex-col items-center justify-center py-10 md:py-16 scroll-mt-28 reveal-on-scroll">
                    <div class="mb-10 text-center">
                        <h2 class="text-4xl md:text-5xl font-bold tracking-tight leading-tight mb-6">OTLO Design Anatomy</h2>
                        <div class="w-12 h-px bg-black mx-auto"></div>
                    </div>

                    <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 text-center md:text-left w-full max-w-[95%]">1. Spatial Flow</h3>
                    
                    <div class="relative w-[95%] aspect-square md:aspect-[16/9] bg-[#111e30] shadow-2xl rounded-[2rem] overflow-hidden group border border-[#1e3450] cursor-zoom-in transition-all flex flex-col p-4 md:p-6 mb-6" onclick="openPlanModal()">
                        
                        <div class="relative z-50 flex justify-center mb-6 md:mb-8" onclick="event.stopPropagation()">
                            <div class="flex items-center gap-6 bg-white/10 backdrop-blur-md border border-white/10 px-5 py-2.5 rounded-full shadow-md">
                                <button onclick="cyclePlan(-1)" class="text-white/50 hover:text-white transition-colors flex items-center justify-center">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
                                </button>
                                <div class="w-px h-4 bg-white/20"></div>
                                <button id="btn-play-pause" onclick="togglePlanPlay()" class="text-white hover:text-white/70 transition-opacity flex items-center justify-center w-5 h-5">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                                </button>
                                <div class="w-px h-4 bg-white/20"></div>
                                <button onclick="cyclePlan(1)" class="text-white/50 hover:text-white transition-colors flex items-center justify-center">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg>
                                </button>
                            </div>
                        </div>

                        <div class="absolute inset-0 arch-grid-dark pointer-events-none z-0"></div>
                        
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_rgba(59,130,246,0.15),_transparent_40%)] pointer-events-none z-0"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_bottom_left,_rgba(16,185,129,0.08),_transparent_40%)] pointer-events-none z-0"></div>
                        <div class="absolute inset-0 bg-gradient-to-b from-white/5 to-transparent pointer-events-none z-0"></div>
                        
                        <div id="plan-gallery" class="w-full flex-grow relative z-10">
                            <img src="plans/plan1.png" class="plan-image active" data-index="0" onerror="this.src='https://images.unsplash.com/photo-1503387762-592deb58ef4e?auto=format&fit=crop&q=80'" alt="">
                            <img src="plans/plan2.png" loading="lazy" class="plan-image inactive" data-index="1" onerror="this.src='https://images.unsplash.com/photo-1524813686514-a57563d77965?auto=format&fit=crop&q=80'" alt="">
                            <img src="plans/plan3.png" loading="lazy" class="plan-image inactive" data-index="2" onerror="this.src='https://images.unsplash.com/photo-1542718610-a1d656d1884c?auto=format&fit=crop&q=80'" alt="">
                            <img src="plans/plan4.png" loading="lazy" class="plan-image inactive" data-index="3" onerror="this.src='https://images.unsplash.com/photo-1510798831971-661eb04b3739?auto=format&fit=crop&q=80'" alt="">
                            <img src="plans/plan5.png" loading="lazy" class="plan-image inactive" data-index="4" onerror="this.src='https://images.unsplash.com/photo-1449844908441-8829872d2607?auto=format&fit=crop&q=80'" alt="">
                        </div>
                    </div>
                </div>

                <!-- NEW 360 EXPERIENCE SECTION -->
                <div id="otlo-360" class="w-full max-w-[1800px] mx-auto min-h-[calc(100vh-140px)] flex flex-col items-center justify-center py-10 md:py-16 scroll-mt-28 reveal-on-scroll border-t border-gray-100">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 text-center md:text-left w-full max-w-[95%]">2. The 360° Experience</h3>
                    
                    <div class="experience-360 relative w-[95%] bg-gray-50/50 rounded-[2rem] overflow-hidden border border-gray-100 shadow-sm transition-all mb-8 flex flex-col items-center py-6 md:py-8">
                        
                        <!-- UI Controls -->
                        <div class="controls-360 relative z-50 flex justify-center mb-6">
                            <div class="flex items-center gap-1 bg-white/90 backdrop-blur-md border border-gray-200 px-2 py-1.5 rounded-full shadow-md">
                                <button id="btn-360-ext" onclick="Experience360.setView('exterior')" class="px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest bg-black text-white transition-colors">Exterior</button>
                                <button id="btn-360-int" onclick="Experience360.setView('interior')" class="px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest text-gray-500 hover:text-black transition-colors">Interior</button>
                                <div class="w-px h-4 bg-gray-300 mx-1"></div>
                                <button id="btn-360-play" onclick="Experience360.togglePlay()" class="w-6 h-6 flex items-center justify-center text-gray-500 hover:text-black transition-colors rounded-full" title="Play/Pause Rotation">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                                </button>
                            </div>
                        </div>

                        <!-- Canvas Viewer Container -->
                        <div class="experience-360-container viewer-360 px-4 md:px-8 cursor-grab active:cursor-grabbing" id="experience-360-interaction">
                            <canvas id="experience-360-canvas" class="experience-360-canvas transition-opacity duration-300"></canvas>
                            
                            <!-- Loading Indicator -->
                            <div id="experience-360-loader" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-50/80 backdrop-blur-sm z-10 transition-opacity duration-500">
                                <svg class="animate-spin h-6 w-6 text-gray-400 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                <span class="text-[10px] font-bold uppercase tracking-widest text-gray-500">Loading Assets...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Slider Control -->
                    <div class="w-full max-w-lg mx-auto flex flex-col items-center px-6">
                        <input type="range" id="experience-360-slider" class="slider-360 w-full" min="1" max="51" value="1">
                        <p class="text-[9px] text-gray-400 mt-4 text-center uppercase tracking-widest">Drag image or use slider to rotate</p>
                    </div>
                </div>
                
                <div id="otlo-anatomy" class="w-full max-w-[1800px] mx-auto min-h-[calc(100vh-140px)] flex flex-col items-center justify-center py-10 md:py-16 scroll-mt-28 reveal-on-scroll border-t border-gray-100">
                    
                    <div class="flex justify-between items-end w-full max-w-[95%] mb-6">
                        <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">3. System Anatomy</h3>
                        
                        <!-- Typology Selector -->
                        <div class="flex items-center gap-1 bg-white/90 backdrop-blur-md border border-gray-200 p-1 rounded-full shadow-sm relative z-50">
                            <button id="btn-type-a" onclick="switchTypology('A')" class="px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest bg-black text-white transition-colors">Type A</button>
                            <button id="btn-type-b" onclick="switchTypology('B')" class="px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest text-gray-500 hover:text-black transition-colors">Type B</button>
                            <button id="btn-type-c" onclick="switchTypology('C')" class="px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest text-gray-500 hover:text-black transition-colors">Type C</button>
                        </div>
                    </div>

                    <div class="relative flex items-center bg-gray-50 border border-gray-200 rounded-full p-1 shadow-sm w-[88px] h-12 mb-4 z-50">
                        <div id="explode-highlight" class="absolute w-10 h-10 bg-black rounded-full transition-transform duration-300 left-1 translate-x-0"></div>
                        <button onclick="setExplodeState(false)" class="relative z-10 w-10 h-10 flex items-center justify-center transition-colors text-white" id="btn-col" aria-label="Collapse">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
                        </button>
                        <button onclick="setExplodeState(true)" class="relative z-10 w-10 h-10 flex items-center justify-center transition-colors text-gray-400 hover:text-black" id="btn-exp" aria-label="Explode">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="3" rx="1"/><rect x="4" y="10.5" width="16" height="3" rx="1"/><rect x="4" y="17" width="16" height="3" rx="1"/></svg>
                        </button>
                    </div>

                    <div id="explode-stage" class="relative w-[95%] h-[55vh] md:h-[65vh] bg-gray-50/50 rounded-[2rem] overflow-hidden border border-gray-100 flex items-center justify-center group shadow-sm transition-all z-10">
                        <div class="explode-wrapper relative w-full max-w-[1200px] h-full">
                            <img id="anatomy-view-img" src="images/view.png" loading="lazy" class="explode-layer explode-view" alt="" onerror="this.src='https://images.unsplash.com/photo-1542718610-a1d656d1884c?auto=format&fit=crop&q=80'" onclick="setExplodeState(true)">
                            <img src="images/shell.png" loading="lazy" class="explode-layer explode-shell" onerror="this.src='https://images.unsplash.com/photo-1541888086968-9de15039eb14?auto=format&fit=crop&q=80'" alt="Shell structure">
                            <img id="anatomy-interior-img" src="images/interior.png" loading="lazy" class="explode-layer explode-interior" onerror="this.src='https://images.unsplash.com/photo-1600607686527-6fb886090705?auto=format&fit=crop&q=80'" alt="Interior layout" onclick="toggleExplodeFocus()">
                            <img src="images/base.png" loading="lazy" class="explode-layer explode-base" onerror="this.src='https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80'" alt="Foundation" onclick="setExplodeState(false)">
                        </div>
                    </div>
                    <p class="text-[9px] text-gray-400 mt-4 text-center uppercase tracking-widest" id="explode-hint">Click interior to zoom</p>
                </div>

                <!-- NEW AMENITIES SECTION -->
                <div id="otlo-amenities" class="w-full max-w-[1800px] mx-auto flex flex-col items-center py-10 md:py-16 scroll-mt-28 reveal-on-scroll border-t border-gray-100">
                    
                    <!-- Intro / Concept -->
                    <div class="max-w-4xl mx-auto text-center px-6 mb-20">
                        <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">4. Curated Amenities</h3>
                        <h2 class="text-3xl md:text-5xl font-bold tracking-tight leading-tight mb-6 text-black">OTLO — A Porch to Pause.<br><span class="text-gray-400">A Retreat to Remember.</span></h2>
                        <div class="w-12 h-px bg-black mx-auto mb-6"></div>
                        <p class="text-gray-500 font-light leading-relaxed text-base md:text-lg">
                            At OTLO, every space is conceived as a threshold — between architecture and landscape, solitude and gathering, ritual and celebration. Inspired by the idea of the porch as a place of transition and connection, OTLO invites guests to slow down, step outside, and stay awhile. Our amenities are intentionally layered to create a refined yet immersive hospitality experience rooted in wellness, design, and meaningful connection.
                        </p>
                    </div>

                    <!-- Resort Experiences Grid -->
                    <div class="w-full max-w-[95%] mb-24">
                        <div class="text-center mb-12">
                            <h3 class="text-2xl font-bold mb-4">Resort Experiences</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            
                            <!-- Card 1 -->
                            <div class="bg-gray-50 rounded-[2rem] p-8 border border-gray-100 hover:bg-white hover:shadow-xl transition-all duration-500 group relative overflow-hidden flex flex-col h-full">
                                <div class="absolute inset-0 arch-grid opacity-5 pointer-events-none"></div>
                                <div class="mb-6 w-12 h-12 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-900 group-hover:scale-110 transition-transform duration-500 relative z-10">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>
                                </div>
                                <h4 class="text-sm font-bold uppercase tracking-widest text-black mb-6 relative z-10">Recreation & Movement</h4>
                                <ul class="space-y-5 relative z-10 flex-grow">
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Infinity Edge Pool</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">A resort-style infinity pool designed for sunrise swims and golden-hour lounging.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Professional Pickleball Courts</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Competition-grade courts for spirited matches or relaxed play.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Nature Walking Trails</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Curated trails woven into the landscape, encouraging exploration and reflection.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Children’s Discovery Garden</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">A thoughtfully designed outdoor play environment that fosters creativity and connection.</span>
                                    </li>
                                </ul>
                            </div>

                            <!-- Card 2 -->
                            <div class="bg-gray-50 rounded-[2rem] p-8 border border-gray-100 hover:bg-white hover:shadow-xl transition-all duration-500 group relative overflow-hidden flex flex-col h-full">
                                <div class="absolute inset-0 arch-grid opacity-5 pointer-events-none"></div>
                                <div class="mb-6 w-12 h-12 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-900 group-hover:scale-110 transition-transform duration-500 relative z-10">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                                </div>
                                <h4 class="text-sm font-bold uppercase tracking-widest text-black mb-6 relative z-10">Wellness & Restoration</h4>
                                <ul class="space-y-5 relative z-10 flex-grow">
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Sauna Vaults</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Architectural heat sanctuaries crafted for detoxification and deep relaxation.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Cold Immersion Experiences</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Purpose-built cold plunge facilities supporting contrast therapy and recovery rituals.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Wellness Pavilions</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Open-air structures hosting yoga, breathwork, meditation, and guided retreats.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Signature Spa Experiences</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Seasonal treatments and curated wellness packages designed to restore balance.</span>
                                    </li>
                                </ul>
                            </div>

                            <!-- Card 3 -->
                            <div class="bg-gray-50 rounded-[2rem] p-8 border border-gray-100 hover:bg-white hover:shadow-xl transition-all duration-500 group relative overflow-hidden flex flex-col h-full">
                                <div class="absolute inset-0 arch-grid opacity-5 pointer-events-none"></div>
                                <div class="mb-6 w-12 h-12 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-900 group-hover:scale-110 transition-transform duration-500 relative z-10">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>
                                </div>
                                <h4 class="text-sm font-bold uppercase tracking-widest text-black mb-6 relative z-10">Culinary & Experiences</h4>
                                <ul class="space-y-5 relative z-10 flex-grow">
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Chef’s Table & Private Dining</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Intimate culinary experiences led by guest chefs or curated for private in-cabin dining.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Farm-to-Table Breakfasts</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Locally sourced morning provisions delivered directly to your cabin.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Wine & Cocktail Tastings</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Guided tastings featuring regional selections and signature mixology experiences.</span>
                                    </li>
                                </ul>
                            </div>

                            <!-- Card 4 -->
                            <div class="bg-gray-50 rounded-[2rem] p-8 border border-gray-100 hover:bg-white hover:shadow-xl transition-all duration-500 group relative overflow-hidden flex flex-col h-full">
                                <div class="absolute inset-0 arch-grid opacity-5 pointer-events-none"></div>
                                <div class="mb-6 w-12 h-12 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-900 group-hover:scale-110 transition-transform duration-500 relative z-10">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                </div>
                                <h4 class="text-sm font-bold uppercase tracking-widest text-black mb-6 relative z-10">Social & Gathering</h4>
                                <ul class="space-y-5 relative z-10 flex-grow">
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">OTLO Pavilion</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">A central gathering space for connection, conversation, and shared moments.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Event Pavilion & Lawn</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">A flexible venue designed for intimate weddings, retreats, and private celebrations.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Elevated Bar Lounge</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">A refined cocktail setting offering curated wines and seasonal menus.</span>
                                    </li>
                                    <li class="group/item cursor-default">
                                        <strong class="block text-black text-sm mb-1 group-hover/item:text-blue-600 transition-colors">Private Resort Buy-Outs</strong>
                                        <span class="text-xs text-gray-500 font-light leading-relaxed">Exclusive full-property reservations for destination events.</span>
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>

                    <!-- The OTLO Cabins (Accordions) -->
                    <div class="w-full max-w-[95%] grid lg:grid-cols-12 gap-12 border-t border-gray-100 pt-16 mb-20">
                        <div class="lg:col-span-5 sticky top-24 self-start">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">The OTLO Cabins</h3>
                            <h4 class="text-3xl md:text-5xl font-bold tracking-tight mb-6 text-black leading-tight">Private Architecture.<br><span class="text-gray-400">Personal Sanctuary.</span></h4>
                            <div class="w-10 h-px bg-black mb-6"></div>
                            <p class="text-gray-500 font-light leading-relaxed text-sm md:text-base pr-8">
                                Each OTLO cabin is designed as a self-contained retreat — where architecture frames nature and comfort meets intention. Thoughtfully crafted interiors and private outdoor spaces create a seamless extension between shelter and landscape.
                            </p>
                        </div>
                        
                        <div class="lg:col-span-7 pt-4 lg:pt-0">
                            <!-- Accordion Item 1 -->
                            <div class="border-b border-gray-200">
                                <button onclick="toggleAccordion('acc-outdoor')" class="w-full py-6 flex justify-between items-center group text-left focus:outline-none">
                                    <span class="text-lg md:text-xl font-bold text-gray-900 group-hover:translate-x-2 transition-transform duration-300">Outdoor Living & Wellness</span>
                                    <span class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 transition-all duration-300 shrink-0" id="icon-acc-outdoor">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transition-transform duration-300"><path d="M6 9l6 6 6-6"/></svg>
                                    </span>
                                </button>
                                <div id="acc-outdoor" class="overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0px;">
                                    <div class="pb-8 pt-2 grid sm:grid-cols-2 gap-x-6 gap-y-4">
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Private Outdoor Hot Tub</strong>
                                            <span class="text-xs text-gray-500 font-light">Year-round soaking beneath open skies.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Dedicated Cold Plunge</strong>
                                            <span class="text-xs text-gray-500 font-light">Invigorating contrast therapy on your deck.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Fire Pit Lounge</strong>
                                            <span class="text-xs text-gray-500 font-light">Evenings centered around warmth and conversation.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Expansive Private Deck</strong>
                                            <span class="text-xs text-gray-500 font-light">Generous seating extending your living space.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Freestanding Soaking Tub</strong>
                                            <span class="text-xs text-gray-500 font-light">Immersive bathing positioned for tranquility.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Outdoor Privacy Screening</strong>
                                            <span class="text-xs text-gray-500 font-light">Architectural layering ensuring seclusion.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Accordion Item 2 -->
                            <div class="border-b border-gray-200">
                                <button onclick="toggleAccordion('acc-interior')" class="w-full py-6 flex justify-between items-center group text-left focus:outline-none">
                                    <span class="text-lg md:text-xl font-bold text-gray-900 group-hover:translate-x-2 transition-transform duration-300">Interior Comfort & Design</span>
                                    <span class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 transition-all duration-300 shrink-0" id="icon-acc-interior">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transition-transform duration-300"><path d="M6 9l6 6 6-6"/></svg>
                                    </span>
                                </button>
                                <div id="acc-interior" class="overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0px;">
                                    <div class="pb-8 pt-2 grid sm:grid-cols-2 gap-x-6 gap-y-4">
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Fully Equipped Kitchenette</strong>
                                            <span class="text-xs text-gray-500 font-light">A complete culinary setup ideal for extended stays.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Premium Bedding</strong>
                                            <span class="text-xs text-gray-500 font-light">King Suites, Queen Suites, Family Bunk Options.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Luxury Bath Amenities</strong>
                                            <span class="text-xs text-gray-500 font-light">Curated bath products that elevate everyday rituals.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Rainfall Shower Fixtures</strong>
                                            <span class="text-xs text-gray-500 font-light">Spa-inspired bathing experiences.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Climate-Controlled Interiors</strong>
                                            <span class="text-xs text-gray-500 font-light">Year-round comfort in every season.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Integrated Surround Sound</strong>
                                            <span class="text-xs text-gray-500 font-light">Seamless audio for curated ambiance.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Accordion Item 3 -->
                            <div class="border-b border-gray-200">
                                <button onclick="toggleAccordion('acc-smart')" class="w-full py-6 flex justify-between items-center group text-left focus:outline-none">
                                    <span class="text-lg md:text-xl font-bold text-gray-900 group-hover:translate-x-2 transition-transform duration-300">Smart Living & Convenience</span>
                                    <span class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 transition-all duration-300 shrink-0" id="icon-acc-smart">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transition-transform duration-300"><path d="M6 9l6 6 6-6"/></svg>
                                    </span>
                                </button>
                                <div id="acc-smart" class="overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0px;">
                                    <div class="pb-8 pt-2 grid sm:grid-cols-2 gap-x-6 gap-y-4">
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Technology Package</strong>
                                            <span class="text-xs text-gray-500 font-light">High-Speed Wi-Fi, Smart TV, Keyless Entry.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Dedicated Covered Parking</strong>
                                            <span class="text-xs text-gray-500 font-light">Private, convenient access for each cabin.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">EV Charging Stations</strong>
                                            <span class="text-xs text-gray-500 font-light">On-site charging supporting sustainable travel.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Accordion Item 4 -->
                            <div class="border-b border-gray-200">
                                <button onclick="toggleAccordion('acc-addons')" class="w-full py-6 flex justify-between items-center group text-left focus:outline-none">
                                    <span class="text-lg md:text-xl font-bold text-gray-900 group-hover:translate-x-2 transition-transform duration-300">Curated Add-Ons</span>
                                    <span class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 transition-all duration-300 shrink-0" id="icon-acc-addons">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transition-transform duration-300"><path d="M6 9l6 6 6-6"/></svg>
                                    </span>
                                </button>
                                <div id="acc-addons" class="overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0px;">
                                    <div class="pb-8 pt-2 grid sm:grid-cols-2 gap-x-6 gap-y-4">
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Pet-Friendly Cabins</strong>
                                            <span class="text-xs text-gray-500 font-light">Select accommodations offering dedicated pet packages.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Celebration Styling</strong>
                                            <span class="text-xs text-gray-500 font-light">Birthdays, Proposals, Custom Curated Moments.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Merchandise Collection</strong>
                                            <span class="text-xs text-gray-500 font-light">Branded Robes, Firewood Kits, Wellness Ritual Kits.</span>
                                        </div>
                                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-100 transition-all">
                                            <strong class="block text-sm text-black mb-1">Flexible Scheduling</strong>
                                            <span class="text-xs text-gray-500 font-light">Early Check-In & Late Check-Out options.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Accommodation Options -->
                    <div class="w-full max-w-[95%] mb-12">
                        <div class="text-center max-w-2xl mx-auto mb-12">
                            <h3 class="text-2xl font-bold mb-4">Accommodation Options</h3>
                            <p class="text-gray-500 font-light text-sm">Three architecturally distinct cabin models designed to accommodate a variety of stays:</p>
                        </div>
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white border border-gray-200 rounded-[2rem] p-8 text-center hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <h4 class="text-xl font-bold mb-2">1.5 Bed / 1 Bath</h4>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Sleeps 2</p>
                                <p class="text-sm text-gray-500 font-light">Perfect for couples and extended stays with a dedicated workstation.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-[2rem] p-8 text-center hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <h4 class="text-xl font-bold mb-2">2 Bedroom / 1 Bath</h4>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Sleeps 4</p>
                                <p class="text-sm text-gray-500 font-light">Perfectly balanced layout designed for families or small groups.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-[2rem] p-8 text-center hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <h4 class="text-xl font-bold mb-2">2 Bedroom / 2 Bath</h4>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Sleeps 4 to 6</p>
                                <p class="text-sm text-gray-500 font-light">Spacious floor plans designed with group stays and privacy in mind.</p>
                            </div>
                        </div>
                        <div class="max-w-4xl mx-auto text-center bg-gray-50 rounded-2xl p-6 border border-gray-100">
                            <p class="text-xs text-gray-500 font-light leading-relaxed">
                                Select accommodations are <strong>ADA accessible</strong> to ensure comfort and accessibility for all guests. Every cabin blends privacy, comfort, and intentional design to create a stay that feels both elevated and personal.
                            </p>
                        </div>
                    </div>

                </div>

            </div>

            <div class="w-full bg-[#fcfcfc] py-20 flex flex-col items-center justify-center border-t border-gray-100">
                <img src="logo/logoo.png" alt="OTLO Logo" class="h-10 md:h-12 mb-3 object-contain" onerror="this.style.display='none'">
                <p class="text-[9px] md:text-[10px] text-gray-500 font-bold tracking-[0.3em] uppercase">&reg;</p>
            </div>

        </section>

        <section id="tab-calculator" class="tab-content hidden min-h-screen bg-gray-50 flex flex-col print-header">
            <div class="bg-white border-b border-gray-200 px-4 md:px-6 py-4 flex flex-col md:flex-row justify-between items-start md:items-center sticky top-16 md:top-20 z-40 shadow-sm">
                <div class="flex items-center gap-6 overflow-x-auto w-full md:w-auto pb-2 md:pb-0 no-scrollbar">
                    <button onclick="switchCalcTab('inputs')" class="calc-tab-btn active text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="inputs">Project Inputs</button>
                    <button onclick="switchCalcTab('financing')" class="calc-tab-btn text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="financing">Financing</button>
                    <button onclick="switchCalcTab('revenue')" class="calc-tab-btn text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="revenue">Revenue & Ops</button>
                    <button onclick="switchCalcTab('projections')" class="calc-tab-btn text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="projections">Projections</button>
                </div>
                
                <div class="flex items-center gap-3 mt-4 md:mt-0 w-full md:w-auto justify-between md:justify-end">
                    <div class="flex items-center gap-3 mr-2 bg-gray-50 px-3 py-1.5 rounded-full border border-gray-200">
                        <span class="text-[9px] uppercase font-bold text-gray-400 hidden sm:inline">Scenarios</span>
                        <div class="flex items-center gap-2">
                            <div class="flex items-center gap-1 group relative">
                                <button onclick="triggerExportOptions(1)" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform mr-1" title="Export">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button onclick="loadCustom(1)" id="btn-load-1" class="scenario-dot" title="Load Scenario 1">1</button>
                                <button onclick="saveCustom(1)" id="btn-save-1" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                            </div>
                            
                            <div class="w-px h-3 bg-gray-300 mx-1"></div>

                            <div class="flex items-center gap-1 group relative">
                                <button onclick="triggerExportOptions(2)" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform mr-1" title="Export">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button onclick="loadCustom(2)" id="btn-load-2" class="scenario-dot" title="Load Scenario 2">2</button>
                                <button onclick="saveCustom(2)" id="btn-save-2" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                            </div>

                            <div class="w-px h-3 bg-gray-300 mx-1"></div>

                            <div class="flex items-center gap-1 group relative">
                                <button onclick="triggerExportOptions(3)" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform mr-1" title="Export">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button onclick="loadCustom(3)" id="btn-load-3" class="scenario-dot" title="Load Scenario 3">3</button>
                                <button onclick="saveCustom(3)" id="btn-save-3" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="triggerExportOptions(null)" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-widest hover:bg-gray-300 transition-all shadow-sm flex items-center gap-1" title="Export Current"><span>Export</span></button>

                    <div class="flex items-center gap-3">
                        <div class="relative inline-block w-28 align-middle select-none transition duration-200 ease-in">
                            <div class="flex bg-gray-200 rounded-full p-1">
                                <button onclick="setCurrency('USD')" id="curr-usd" class="w-1/2 text-[10px] font-bold py-1.5 rounded-full bg-white shadow-sm transition-all">USD</button>
                                <button onclick="setCurrency('INR')" id="curr-inr" class="w-1/2 text-[10px] font-bold py-1.5 rounded-full text-gray-500 hover:text-black transition-all">INR</button>
                            </div>
                        </div>
                        <div class="text-[8px] md:text-[10px] font-bold text-gray-400 ml-1 animate-pulse whitespace-nowrap" id="live-rate-display">● Live</div>
                    </div>
                    <div class="h-8 w-px bg-gray-200 mx-2"></div>
                    <button onclick="calculateWithEffect()" class="bg-black text-white px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-all shadow-md flex items-center gap-2" title="Run Scenario"><span>Run</span><svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></button>
                </div>
            </div>

            <div class="flex-grow grid lg:grid-cols-12 gap-0">
                <div class="lg:col-span-5 bg-white border-r border-gray-200 overflow-y-auto lg:h-[calc(100vh-140px)] p-6 md:p-8">
                    <div id="calc-inputs" class="calc-section space-y-8">
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">1. Unit Mix & Development</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label class="block text-xs font-bold mb-2">Unit Count</label><input type="range" id="in-units" min="5" max="50" value="10" oninput="calculate()"><div class="text-right text-xs font-mono mt-1"><span id="val-units">10</span> Keys</div></div>
                                <div><label class="block text-xs font-bold mb-2">Unit Area (Sq.Ft)</label><input type="range" id="in-area" min="400" max="2000" value="1200" step="50" oninput="calculate()"><div class="text-right text-xs font-mono mt-1"><span id="val-area">1200</span> sq.ft</div></div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-xl space-y-4 border border-gray-100">
                                <p class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Construction Cost Breakdown (Per Sq.Ft)</p>
                                <div><div class="flex justify-between text-xs mb-1"><span>Hard Costs</span><span class="font-mono" id="val-hard"></span></div><input type="range" id="in-hard" min="50" max="500" oninput="calculate()"></div>
                                <div><div class="flex justify-between text-xs mb-1"><span>Soft Costs</span><span class="font-mono" id="val-soft"></span></div><input type="range" id="in-soft" min="10" max="200" oninput="calculate()"></div>
                                <div><div class="flex justify-between text-xs mb-1"><span>FF&E / Furnishing</span><span class="font-mono" id="val-ffe"></span></div><input type="range" id="in-ffe" min="10" max="200" oninput="calculate()"></div>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">2. Land & Site Work</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Land Area (Acres)</span><span class="font-mono" id="val-land-area">2.0</span></div><input type="range" id="in-land-area" min="0.5" max="20" value="2" step="0.5" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Land Cost / Acre</span><span class="font-mono" id="val-land-cost"></span></div><input type="range" id="in-land-cost" min="10000" max="1000000" step="5000" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Site Infra / Utilities</span><span class="font-mono" id="val-infra"></span></div><input type="range" id="in-infra" min="50000" max="2000000" step="10000" oninput="calculate()"></div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">3. Optional Amenities</h3>
                            <div id="amenities-list" class="grid grid-cols-2 gap-3"></div>
                        </div>
                    </div>
                    
                    <div id="calc-financing" class="calc-section hidden space-y-8">
                        <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm mb-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">Capital Stack</h3>
                            <div class="flex h-6 rounded-full overflow-hidden mb-2 bg-gray-100">
                                <div id="bar-debt" class="bg-blue-600 h-full transition-all duration-500" style="width: 65%"></div>
                                <div id="bar-equity" class="bg-green-500 h-full transition-all duration-500" style="width: 35%"></div>
                            </div>
                            <div class="flex justify-between text-xs font-mono font-bold">
                                <span class="text-blue-600">Debt: <span id="disp-debt-amt">$0</span> (<span id="disp-debt-pct">0%</span>)</span>
                                <span class="text-green-600">Equity: <span id="disp-equity-amt">$0</span> (<span id="disp-equity-pct">0%</span>)</span>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                            <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-700">A. Land Purchase Financing</h3>
                                <span class="text-[10px] bg-gray-200 text-gray-600 px-2 py-1 rounded-full font-bold">Acquisition</span>
                            </div>
                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between text-xs font-bold mb-2"><span>Land LTV</span><span class="font-mono" id="val-land-ltv">50%</span></div>
                                    <input type="range" id="in-land-ltv" min="0" max="80" value="50" oninput="calculate()">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Interest Rate</span><span class="font-mono" id="val-land-rate">8.0%</span></div>
                                        <input type="range" id="in-land-rate" min="3" max="15" value="8" step="0.25" oninput="calculate()">
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Amortization (Yrs)</span><span class="font-mono" id="val-land-amort">20</span></div>
                                        <input type="range" id="in-land-amort" min="5" max="30" value="20" step="5" oninput="calculate()">
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="in-land-io" class="w-4 h-4 accent-black" onchange="calculate()">
                                    <label for="in-land-io" class="text-xs font-bold text-gray-600">Interest-Only Period (First 2 Years)</label>
                                </div>
                                <div class="pt-2 border-t border-gray-200 mt-2 space-y-1">
                                    <div class="flex justify-between text-xs text-gray-500"><span>Land Loan Amount</span><span class="font-mono font-bold text-gray-800" id="out-land-loan">$0</span></div>
                                    <div class="flex justify-between text-xs text-gray-500"><span>Annual Debt Service</span><span class="font-mono font-bold text-gray-800" id="out-land-ds">$0</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                            <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-blue-600">B. Construction & Permanent Loan</h3>
                                <span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-bold">Dev & Takeout</span>
                            </div>
                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between text-xs font-bold mb-2"><span>Construction LTV (on Cost)</span><span class="font-mono" id="val-const-ltc">65%</span></div>
                                    <input type="range" id="in-const-ltc" min="0" max="85" value="65" oninput="calculate()">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Const. Rate</span><span class="font-mono" id="val-const-rate">7.5%</span></div>
                                        <input type="range" id="in-const-rate" min="3" max="12" value="7.5" step="0.25" oninput="calculate()">
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Term (Months)</span><span class="font-mono" id="val-const-term">18</span></div>
                                        <input type="range" id="in-const-term" min="12" max="36" value="18" step="6" oninput="calculate()">
                                    </div>
                                </div>
                                <div class="pt-4 border-t border-gray-200">
                                    <p class="text-[10px] font-bold uppercase tracking-widest text-green-600 mb-3">Permanent Takeout Loan</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <div class="flex justify-between text-xs font-bold mb-2"><span>Perm Rate</span><span class="font-mono" id="val-perm-rate">6.5%</span></div>
                                            <input type="range" id="in-perm-rate" min="3" max="10" value="6.5" step="0.25" oninput="calculate()">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-xs font-bold mb-2"><span>Amortization</span><span class="font-mono" id="val-perm-amort">25</span></div>
                                            <input type="range" id="in-perm-amort" min="15" max="30" value="25" step="5" oninput="calculate()">
                                        </div>
                                    </div>
                                </div>
                                <div class="pt-2 border-t border-gray-200 mt-2 space-y-1">
                                    <div class="flex justify-between text-xs text-gray-500"><span>Construction Loan</span><span class="font-mono font-bold text-gray-800" id="out-const-loan">$0</span></div>
                                    <div class="flex justify-between text-xs text-gray-500"><span>Interest Reserve (Capitalized)</span><span class="font-mono font-bold text-gray-800" id="out-int-reserve">$0</span></div>
                                    <div class="flex justify-between text-xs text-blue-600 font-bold mt-1"><span>Stabilized Annual Debt Service</span><span class="font-mono" id="out-perm-ds">$0</span></div>
                                    <div class="flex justify-between text-xs text-gray-500 mt-1"><span>DSCR (Stabilized)</span><span class="font-mono font-bold" id="out-dscr">1.25x</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">C. Debt Repayment Timeline</h3>
                            <div class="relative h-40 w-full mb-4">
                                <canvas id="debtScheduleChart"></canvas>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-[10px] text-right">
                                    <thead>
                                        <tr class="text-gray-400 border-b border-gray-100">
                                            <th class="text-left py-1">Year</th>
                                            <th class="py-1">Land Bal</th>
                                            <th class="py-1">Perm Bal</th>
                                            <th class="py-1">Total Principal</th>
                                            <th class="py-1">Total Interest</th>
                                        </tr>
                                    </thead>
                                    <tbody id="debt-schedule-body" class="font-mono text-gray-600"></tbody>
                                </table>
                            </div>
                        </div>

                         <div class="space-y-6 pt-4 border-t border-gray-100">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">Closing Costs</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Legal & Admin</span><span class="font-mono" id="val-legal"></span></div><input type="range" id="in-legal" min="5000" max="200000" step="1000" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Permitting</span><span class="font-mono" id="val-permit"></span></div><input type="range" id="in-permit" min="5000" max="200000" step="1000" oninput="calculate()"></div>
                        </div>
                    </div>

                    <div id="calc-revenue" class="calc-section hidden space-y-8">
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">Top Line</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Target ADR</span><span class="font-mono" id="val-adr"></span></div><input type="range" id="in-adr" min="100" max="2000" step="10" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Stabilized Occupancy</span><span class="font-mono" id="val-occ">70%</span></div><input type="range" id="in-occ" min="30" max="95" value="70" step="1" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Exit Cap Rate (%)</span><span class="font-mono" id="val-cap">8.0%</span></div><input type="range" id="in-cap" min="3" max="15" value="8" step="0.25" oninput="calculate()"></div>
                        </div>
                        
                        <div class="space-y-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">Ancillary Revenue Services</h3>
                            <div id="ancillary-list" class="grid grid-cols-2 gap-3 mb-4"></div>
                            
                            <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                                <div class="flex justify-between items-center mb-3">
                                    <span class="text-xs font-bold uppercase text-gray-500">Total Ancillary Revenue</span>
                                    <span class="font-mono font-bold text-black" id="total-ancillary-revenue">$0</span>
                                </div>
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-xs font-bold uppercase text-gray-500">Contribution to Gross Rev</span>
                                    <span class="font-mono font-bold text-blue-600" id="ancillary-contribution">0%</span>
                                </div>
                                <div id="guardrail-warning" class="guardrail-warning"></div>
                                <details class="group mt-2">
                                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none text-xs text-gray-400 hover:text-black transition-colors">
                                        <span>Show Revenue Breakdown</span>
                                        <span class="transition group-open:rotate-180">
                                            <svg fill="none" height="16" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"><path d="M6 9l6 6 6-6"></path></svg>
                                        </span>
                                    </summary>
                                    <div class="text-[10px] text-gray-500 mt-3 space-y-2 border-t border-gray-200 pt-3" id="ancillary-breakdown">
                                        </div>
                                    <p class="text-[9px] text-gray-400 italic mt-3 text-center">Note: Ancillary revenue varies by seasonality & guest behavior.</p>
                                </details>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">Operations & Reserves</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>OpEx Ratio (% of Revenue)</span><span class="font-mono" id="val-opex">30%</span></div><input type="range" id="in-opex" min="15" max="60" value="30" step="1" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>FF&E Reserves (Annual)</span><span class="font-mono" id="val-reserve"></span></div><input type="range" id="in-reserve" min="10000" max="500000" step="5000" oninput="calculate()"></div>
                        </div>
                        
                        <div class="border-t border-gray-100 pt-8 mt-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">RevPAR Analysis</h3>
                            <div class="bg-black text-white p-6 rounded-2xl mb-4">
                                 <p class="text-4xl font-bold font-mono mb-1" id="disp-revpar">$0</p>
                                 <p class="text-xs opacity-50">Total Revenue Per Available Room (Daily)</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <p class="text-xs font-bold uppercase text-gray-400 mb-1">Gross Rev / Key</p>
                                    <p class="text-lg font-bold font-mono" id="disp-rev-key">$0</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <p class="text-xs font-bold uppercase text-gray-400 mb-1">OpEx / Key</p>
                                    <p class="text-lg font-bold font-mono text-red-500" id="disp-opex-key">$0</p>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-gray-200 mt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-bold">NOI Margin</span>
                                    <span class="text-sm font-mono font-bold text-green-600" id="disp-noi-margin">0%</span>
                                </div>
                                <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                                    <div class="bg-green-500 h-full rounded-full" id="bar-noi-margin" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="calc-projections" class="calc-section hidden">
                        <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-4 mb-4">5-Year Proforma</h3>
                        <div class="overflow-x-auto"><table class="w-full text-xs text-right"><thead><tr class="text-gray-400 border-b border-gray-100"><th class="text-left py-2">Metric</th><th class="py-2">Year 1</th><th class="py-2">Year 2</th><th class="py-2">Year 3</th><th class="py-2">Year 4</th><th class="py-2">Year 5</th></tr></thead><tbody id="proforma-body" class="font-mono"></tbody></table></div>
                        
                        <div class="grid grid-cols-2 gap-4 mt-8">
                             <div class="p-4 bg-gray-50 rounded-xl border border-gray-100">
                                <h4 class="text-[10px] font-bold uppercase text-gray-400 mb-2">Unlevered (Project)</h4>
                                <div class="flex justify-between items-center mb-1"><span class="text-xs font-medium">IRR</span><span class="font-mono text-sm font-bold" id="val-irr-unlev">0.0%</span></div>
                                <div class="flex justify-between items-center"><span class="text-xs font-medium">Multiple</span><span class="font-mono text-sm font-bold" id="val-em-unlev">0.0x</span></div>
                            </div>
                            <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                                <h4 class="text-[10px] font-bold uppercase text-blue-400 mb-2">Levered (Equity)</h4>
                                <div class="flex justify-between items-center mb-1"><span class="text-xs font-medium text-blue-900">IRR</span><span class="font-mono text-sm font-bold text-blue-700" id="val-irr">0.0%</span></div>
                                <div class="flex justify-between items-center"><span class="text-xs font-medium text-blue-900">Multiple</span><span class="font-mono text-sm font-bold text-blue-700" id="val-em">0.0x</span></div>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-black text-white rounded-xl text-center shadow-lg">
                            <p class="text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1">Investment Verdict</p>
                            <p class="text-sm font-medium leading-relaxed" id="investment-inference">Calculating...</p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 bg-gray-50 p-6 md:p-12 flex flex-col h-[calc(100vh-140px)] overflow-y-auto" id="results-panel">
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-[10px] uppercase font-bold text-gray-400">Total Project Cost</p><p class="text-lg font-bold font-mono mt-1" id="out-tpc">$0</p></div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-[10px] uppercase font-bold text-gray-400">NOI (Stabilized)</p><p class="text-lg font-bold font-mono mt-1 text-blue-600" id="out-noi">$0</p></div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-[10px] uppercase font-bold text-gray-400">Valuation</p><p class="text-lg font-bold font-mono mt-1 text-green-600" id="out-val">$0</p></div>
                        <div class="bg-black text-white p-4 rounded-xl shadow-sm"><p class="text-[10px] uppercase font-bold text-gray-400">Value Creation</p><p class="text-lg font-bold font-mono mt-1" id="out-value-creation">$0</p></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 flex-grow">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 flex flex-col"><h4 class="text-xs font-bold uppercase tracking-widest mb-4">Uses of Funds</h4><div class="flex-grow relative w-full h-48 md:h-56"><canvas id="costChart"></canvas></div></div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 flex flex-col"><h4 class="text-xs font-bold uppercase tracking-widest mb-4">Cash Flow vs Debt Service</h4><div class="flex-grow relative w-full h-48 md:h-56"><canvas id="cfChart"></canvas></div></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-200 text-sm text-gray-600 leading-relaxed mb-10 lg:mb-0"><p id="summary-text">Adjust inputs to generate analysis.</p></div>
                </div>

                <div class="lg:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 mobile-calc-footer z-50 flex justify-between items-center">
                    <div><p class="text-[10px] uppercase text-gray-400 font-bold">Total Cost</p><p class="font-mono font-bold text-sm" id="mob-cost">$0</p></div>
                    <div><p class="text-[10px] uppercase text-gray-400 font-bold">Valuation</p><p class="font-mono font-bold text-sm text-green-600" id="mob-val">$0</p></div>
                    <div><p class="text-[10px] uppercase text-gray-400 font-bold">Cash Flow</p><p class="font-mono font-bold text-sm text-blue-600" id="mob-cf">$0</p></div>
                </div>
            </div>
        </section>

    </main>

    <div id="export-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full shadow-2xl text-center">
            <h3 class="text-xl font-bold mb-2">Export Scenario</h3>
            <p class="text-sm text-gray-500 mb-6">Choose format for your financial model.</p>
            <div class="space-y-3">
                <button onclick="performExport('csv')" class="w-full py-3 rounded-xl border border-gray-200 font-bold hover:bg-gray-50 flex items-center justify-center gap-2">
                    <span>📄 Download CSV</span>
                </button>
            </div>
            <button onclick="closeExportModal()" class="mt-6 text-xs text-gray-400 hover:text-black">Cancel</button>
        </div>
    </div>

    <div id="plan-modal" class="fixed inset-0 z-[100] bg-[#111e30] pointer-events-none opacity-0 transition-opacity duration-700 flex flex-col items-center justify-center p-6 md:p-12">
        <div class="absolute inset-0 arch-grid-dark pointer-events-none z-0"></div>
        
        <div class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none z-0"></div>
        
        <div class="absolute top-0 left-0 w-full p-6 md:p-10 flex justify-start z-20">
            <button onclick="closePlanModal()" class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-gray-300 hover:text-white transition-colors bg-white/10 backdrop-blur-md px-4 py-2 rounded-full border border-white/20 shadow-sm">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Back to Projects
            </button>
        </div>
        <img id="plan-modal-img" src="" class="max-w-full max-h-[85vh] object-contain transition-all duration-500 scale-95 relative z-10" style="image-rendering: high-quality; image-rendering: -webkit-optimize-contrast;">
    </div>

    <script>
        const CURRENCY = { USD: { symbol: '$', rate: 1, locale: 'en-US' }, INR: { symbol: '₹', rate: 75, locale: 'en-IN' } };
        
        // --- CONFIG ---
        const AMENITIES_CONFIG = [
            { id: 'sauna', name: 'Sauna / Spa', USD: { def: 50000, max: 150000, step: 1000 }, INR: { def: 2500000, max: 10000000, step: 25000 } },
            { id: 'infpool', name: 'Infinity Pool', USD: { def: 150000, max: 300000, step: 1000 }, INR: { def: 7500000, max: 20000000, step: 50000 } },
            { id: 'plunge', name: 'Plunge Pool', USD: { def: 40000, max: 80000, step: 500 }, INR: { def: 2000000, max: 5000000, step: 20000 } },
            { id: 'bar', name: 'Bar / F&B', USD: { def: 100000, max: 250000, step: 1000 }, INR: { def: 5000000, max: 15000000, step: 50000 } },
            { id: 'pickle', name: 'Pickleball Crt', USD: { def: 30000, max: 60000, step: 500 }, INR: { def: 1500000, max: 4000000, step: 20000 } },
            { id: 'bike', name: 'Bike Rentals', USD: { def: 15000, max: 30000, step: 250 }, INR: { def: 500000, max: 2000000, step: 10000 } },
            { id: 'kayak', name: 'Kayaks', USD: { def: 10000, max: 25000, step: 250 }, INR: { def: 400000, max: 1500000, step: 10000 } },
            { id: 'event', name: 'Event Space', USD: { def: 200000, max: 500000, step: 5000 }, INR: { def: 10000000, max: 30000000, step: 100000 } }
        ];

        // Refined Ancillary Config with Adoption & Caps
        const ANCILLARY_CONFIG = [
            { id: 'fire', name: 'Firewood', type: 'convenience', adoption: 40, USD: { def: 20, max: 60, step: 1 }, INR: { def: 500, max: 2500, step: 50 } },
            { id: 'minibar', name: 'F&B Basket', type: 'convenience', adoption: 45, USD: { def: 45, max: 150, step: 1 }, INR: { def: 1500, max: 8000, step: 100 } },
            { id: 'sauna', name: 'Sauna Access', type: 'experiential', adoption: 25, USD: { def: 75, max: 300, step: 5 }, INR: { def: 3000, max: 15000, step: 250 } },
            { id: 'hike', name: 'Guided Hike', type: 'experiential', adoption: 20, USD: { def: 90, max: 400, step: 5 }, INR: { def: 4000, max: 20000, step: 250 } },
            { id: 'romance', name: 'Romance Package', type: 'occasional', adoption: 8, USD: { def: 150, max: 500, step: 10 }, INR: { def: 7500, max: 25000, step: 500 } },
            { id: 'bday', name: 'Birthday Package', type: 'occasional', adoption: 8, USD: { def: 125, max: 400, step: 10 }, INR: { def: 6000, max: 20000, step: 500 } },
            { id: 'vip', name: 'VIP Package', type: 'premium', adoption: 5, USD: { def: 350, max: 1500, step: 25 }, INR: { def: 18000, max: 75000, step: 1000 } },
            { id: 'chef', name: 'Private Chef', type: 'premium', adoption: 5, USD: { def: 250, max: 1000, step: 25 }, INR: { def: 12000, max: 60000, step: 500 } },
            { id: 'early', name: 'Early Check-in', type: 'occasional', adoption: 12, USD: { def: 50, max: 200, step: 5 }, INR: { def: 2000, max: 8000, step: 250 } },
            { id: 'pet', name: 'Pet Fee', type: 'occasional', adoption: 12, USD: { def: 75, max: 250, step: 5 }, INR: { def: 3000, max: 10000, step: 250 } }
        ];

        const benchmarks = {
            USA: [{ name: "Live Oak Lake", loc: "Waco, TX", keys: 7, adr: "$450", occ: "85%", feat: "Scarcity Model", url: "https://liveoaklake.com/" }, { name: "Onera", loc: "Texas Hill Country", keys: 20, adr: "$550", occ: "78%", feat: "Unit Density", url: "https://stayonera.com/" }, { name: "Bolt Farm", loc: "Tennessee", keys: 15, adr: "$695", occ: "92%", feat: "Social Virality", url: "https://www.boltfarmtreehouse.com/" }],
            IND: [{ name: "The Machan", loc: "Lonavala", keys: 30, adr: "₹22k", occ: "80%", feat: "Eco-Engineering", url: "https://www.themachan.com/" }, { name: "Evolve Back", loc: "Coorg", keys: 45, adr: "₹35k", occ: "75%", feat: "Heritage Luxury", url: "https://www.evolveback.com/coorg/" }, { name: "Ayatana", loc: "Coorg", keys: 50, adr: "₹28k", occ: "82%", feat: "Landscape Integration", url: "https://www.ayatanacoorg.com/" }]
        };
        const defaults = { hardCost: 200, softCost: 50, ffe: 40, landCost: 50000, infra: 200000, legal: 15000, permit: 10000, adr: 250, reserve: 20000 };
        let currentCurr = 'USD'; let charts = {}; let currentSlide = 0; const galleryState = { 'gallery-mountain': 0, 'gallery-lake': 0 };
        const monetaryInputs = ['in-hard', 'in-soft', 'in-ffe', 'in-land-cost', 'in-infra', 'in-legal', 'in-permit', 'in-adr', 'in-reserve'];
        let activeScenario = null;
        let exportSlot = null;

        // Plan Slideshow Variables
        let planIdx = 0;
        let planPlaying = true;
        let planTimer;
        
        const playSvg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`;
        const pauseSvg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>`;

        // --- Typology Preloading & State ---
        const typologyImages = {
            A: { interior: 'images/interior.png', view: 'images/view.png' },
            B: { interior: 'images/interior2.png', view: 'images/view2.png' },
            C: { interior: 'images/interior3.png', view: 'images/view3.png' }
        };
        let currentTypology = 'A';

        // Preload images into browser memory to ensure zero layout shift or flickering on swap
        Object.values(typologyImages).forEach(srcs => {
            const imgInt = new Image(); imgInt.src = srcs.interior;
            const imgView = new Image(); imgView.src = srcs.view;
        });

        function switchTypology(type) {
            if (type === currentTypology) return;
            
            // Update Active Button Styles
            ['A', 'B', 'C'].forEach(t => {
                const btn = document.getElementById(`btn-type-${t.toLowerCase()}`);
                if (!btn) return;
                
                if (t === type) {
                    btn.classList.add('bg-black', 'text-white');
                    btn.classList.remove('text-gray-500', 'hover:text-black');
                } else {
                    btn.classList.remove('bg-black', 'text-white');
                    btn.classList.add('text-gray-500', 'hover:text-black');
                }
            });

            // Instantly Swap Image Sources (Preloaded so it's smooth and maintains scaling/zoom events)
            const interiorImg = document.getElementById('anatomy-interior-img');
            const viewImg = document.getElementById('anatomy-view-img');
            
            if (interiorImg) interiorImg.src = typologyImages[type].interior;
            if (viewImg) viewImg.src = typologyImages[type].view;
            
            currentTypology = type;
        }

        function attemptPlayMusic() {
            const audio = document.getElementById('bg-music');
            const conceptsTab = document.getElementById('tab-concepts');
            
            // Only try to play if the user is on the concepts tab
            if (audio && conceptsTab && !conceptsTab.classList.contains('hidden')) {
                // Explicitly ensure audio is unmuted before playing
                audio.muted = false;
                
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(e => {
                        console.log("Browser autoplay policy prevented immediate playback. Awaiting first micro-interaction.");
                        
                        // Force play on the absolute first microscopic interaction anywhere on the window
                        const forcePlay = () => {
                            if (!conceptsTab.classList.contains('hidden')) {
                                audio.play().catch(()=>{});
                            }
                            ['click', 'touchstart', 'scroll', 'keydown', 'mousemove', 'pointerdown', 'wheel'].forEach(evt => {
                                window.removeEventListener(evt, forcePlay, true);
                            });
                        };
                        
                        // Bind to window with capture: true to ensure it intercepts instantly on any action
                        ['click', 'touchstart', 'scroll', 'keydown', 'mousemove', 'pointerdown', 'wheel'].forEach(evt => {
                            window.addEventListener(evt, forcePlay, { once: true, passive: true, capture: true });
                        });
                    });
                }
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            renderBenchmarks('USA'); 
            initCalculatorUI(); 
            initCharts();
            updateScenarioUI();
            
            fetchLiveRate().then(() => {
               updateInput('in-hard', defaults.hardCost, 50, 500, 10);
               updateInput('in-soft', defaults.softCost, 10, 200, 5);
               updateInput('in-ffe', defaults.ffe, 10, 200, 5);
               updateInput('in-land-cost', defaults.landCost, 10000, 1000000, 5000);
               updateInput('in-infra', defaults.infra, 50000, 2000000, 10000);
               updateInput('in-legal', defaults.legal, 5000, 200000, 1000);
               updateInput('in-permit', defaults.permit, 5000, 200000, 1000);
               updateInput('in-adr', defaults.adr, 50, 2000, 10);
               updateInput('in-reserve', defaults.reserve, 5000, 200000, 1000);
               calculate();
            });
            
            startInternalGalleries(); 
            startPlanSlideshow();
            
            // Force scroll to top on reload so gallery is perfectly framed
            window.scrollTo(0, 0);
            
            switchTab('concepts'); 
            attemptPlayMusic();
            
            document.querySelectorAll('.reveal-on-scroll').forEach(el => {
               if(typeof IntersectionObserver !== 'undefined') {
                   const obs = new IntersectionObserver((entries) => {
                       entries.forEach(entry => {
                           if(entry.isIntersecting) {
                               entry.target.classList.add('visible');
                               obs.unobserve(entry.target);
                           }
                       });
                   });
                   obs.observe(el);
               } else {
                   el.classList.add('visible');
               }
            });

            // Subnav Observer
            const subnavObserverOptions = {
                root: null,
                rootMargin: '-25% 0px -65% 0px',
                threshold: 0
            };

            const subnavObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        
                        document.querySelectorAll('.subnav-btn').forEach(btn => {
                            if (btn.dataset.section === id) {
                                btn.classList.add('bg-white/20', 'text-white', 'shadow-sm');
                                btn.classList.remove('text-white/60', 'bg-transparent', 'hover:text-white');
                            } else {
                                btn.classList.remove('bg-white/20', 'text-white', 'shadow-sm');
                                btn.classList.add('text-white/60', 'bg-transparent', 'hover:text-white');
                            }
                        });

                        const audio = document.getElementById('bg-music');
                        const conceptsTab = document.getElementById('tab-concepts');
                        if (conceptsTab && !conceptsTab.classList.contains('hidden')) {
                            if (id === 'otlo-intro' && audio) {
                                attemptPlayMusic();
                            } else if (audio) {
                                audio.pause();
                            }
                        }

                        if (id === 'otlo-spatial') {
                            resetPlanSlideshow();
                        }
                    }
                });
            }, subnavObserverOptions);

            ['otlo-intro', 'otlo-meaning', 'otlo-spatial', 'otlo-360', 'otlo-anatomy', 'otlo-amenities'].forEach(id => {
                const el = document.getElementById(id);
                if (el) subnavObserver.observe(el);
            });

            // SEPARATE Observer specifically for Anatomy Animation to ensure it reliably triggers
            if(typeof IntersectionObserver !== 'undefined') {
                const anatomyObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if(entry.isIntersecting) {
                            setTimeout(() => { setExplodeState(true); }, 600);
                        } else {
                            setExplodeState(false);
                        }
                    });
                }, { threshold: 0.8 }); // Trigger only when 80% of anatomy section is fully visible
                
                const anatomyEl = document.getElementById('otlo-anatomy');
                if(anatomyEl) anatomyObserver.observe(anatomyEl);
            }
            
            window.toggleMobileMenu = function() { const menu = document.getElementById('mobile-menu'); menu.classList.toggle('hidden'); }
        });

        async function fetchLiveRate() {
            try {
                const response = await fetch('https://open.er-api.com/v6/latest/USD');
                const data = await response.json();
                if(data && data.rates && data.rates.INR) {
                    CURRENCY.INR.rate = data.rates.INR;
                    if(document.getElementById('live-rate-display')) {
                        document.getElementById('live-rate-display').innerHTML = `● Live: 1 USD = ₹${data.rates.INR.toFixed(2)}`;
                        document.getElementById('live-rate-display').classList.add('text-green-500');
                    }
                }
            } catch (e) {
                console.log('Using fallback rate');
                if(document.getElementById('live-rate-display')) {
                   document.getElementById('live-rate-display').innerHTML = `● Est: 1 USD = ₹${CURRENCY.INR.rate}`;
                }
            }
        }

        function initCharts() {
            const commonOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: function(context) { return context.dataset.label + ': ' + format(context.raw); } } } } };
            
            charts.growth = new Chart(document.getElementById('growthChart').getContext('2d'), { type: 'line', data: { labels: ['2025', '2027', '2029', '2031', '2033', '2035'], datasets: [{ label: 'Micro-Resort Demand', data: [100, 130, 170, 220, 280, 350], borderColor: '#000', borderWidth: 3, pointBackgroundColor: '#fff', tension: 0.4 }, { label: 'Traditional Hotel', data: [100, 105, 110, 115, 120, 125], borderColor: '#d1d5db', borderWidth: 2, borderDash: [5, 5], tension: 0.4 }] }, options: { ...commonOptions, scales: { y: { display: false } } } });

            charts.revpar = new Chart(document.getElementById('revparChart').getContext('2d'), { type: 'bar', data: { labels: ['Standard Hotel', 'Boutique', 'Micro-Resort'], datasets: [{ label: 'RevPAR Potential', data: [120, 200, 350], backgroundColor: ['#333', '#666', '#00C9FF'], borderRadius: 6 }] }, options: { ...commonOptions, scales: { y: { ticks: { callback: function(value) { return format(value); }, color: '#fff' }, grid: { color: '#333' } }, x: { ticks: { color: '#fff' } } } } });
            
            charts.cost = new Chart(document.getElementById('costChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Land', 'Units', 'Infra/Amenities', 'Closing', 'Construction Interest'], datasets: [{ data: [1,1,1,1,1], backgroundColor: ['#e5e7eb', '#1d1d1f', '#3b82f6', '#9ca3af', '#f59e0b'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' }, tooltip: { callbacks: { label: function(context) { return context.label + ': ' + format(context.raw); } } } }, cutout: '70%' } });
            charts.cf = new Chart(document.getElementById('cfChart').getContext('2d'), { type: 'bar', data: { labels: ['Y1', 'Y2', 'Y3', 'Y4', 'Y5'], datasets: [{ label: 'Debt Service', data: [0,0,0,0,0], backgroundColor: '#ef4444' }, { label: 'Cash Flow', data: [0,0,0,0,0], backgroundColor: '#22c55e' }] }, options: { ...commonOptions, scales: { x: { stacked: true }, y: { stacked: true, display: false } } } });
            charts.comp = new Chart(document.getElementById('compositionChart').getContext('2d'), { type: 'bar', data: { labels: ['Traditional', 'Boutique', 'Micro-Resort'], datasets: [ { label: 'Room', data: [75, 65, 45], backgroundColor: '#d1d5db' }, { label: 'F&B', data: [20, 25, 25], backgroundColor: '#4b5563' }, { label: 'Experience & Wellness', data: [5, 10, 30], backgroundColor: '#22c55e' } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true, grid: { display: false } }, y: { stacked: true, display: false } }, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, usePointStyle: true } }, tooltip: { callbacks: { label: function(context) { return context.dataset.label + ': ' + context.raw + '%'; } } } } } });
            
            charts.debt = new Chart(document.getElementById('debtScheduleChart').getContext('2d'), { type: 'bar', data: { labels: ['Y1', 'Y2', 'Y3', 'Y4', 'Y5'], datasets: [{ label: 'Land Balance', data: [0,0,0,0,0], backgroundColor: '#94a3b8' }, { label: 'Perm Loan Balance', data: [0,0,0,0,0], backgroundColor: '#3b82f6' }] }, options: { ...commonOptions, scales: { x: { stacked: true }, y: { stacked: true, display: false } } } });
        }

        function updatePhilosophyCharts() {
            if(!charts.revpar) return;
            const rate = CURRENCY[currentCurr].rate;
            charts.revpar.data.datasets[0].data = [120 * rate, 200 * rate, 350 * rate];
            charts.revpar.update();
        }

        function switchTab(tabId) {
            window.scrollTo({ top: 0, behavior: 'instant' });
            
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            const targetTab = document.getElementById(`tab-${tabId}`);
            if(targetTab) targetTab.classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target) {
                    btn.classList.remove('text-black', 'text-stone-800');
                    btn.classList.add('text-gray-500');
                }
            });
            
            const activeBtn = document.querySelector(`[data-target="${tabId}"]`);
            if(activeBtn) { 
                if (tabId === 'concepts') {
                    activeBtn.classList.add('text-black'); 
                    activeBtn.classList.remove('text-gray-500');
                } else {
                    activeBtn.classList.add('text-black'); 
                    activeBtn.classList.remove('text-gray-500'); 
                }
            }
            
            if(tabId === 'concepts') {
                attemptPlayMusic();
            } else {
                const audio = document.getElementById('bg-music');
                if(audio) audio.pause();
            }
            
            setTimeout(() => { 
                if(tabId === 'calculator') { charts.cost?.resize(); charts.cf?.resize(); charts.debt?.resize(); } 
                if(tabId === 'philosophy') { charts.growth?.resize(); charts.revpar?.resize(); charts.comp?.resize(); } 
            }, 150);
        }

        function scrollToId(id) { switchTab(id); document.getElementById(`tab-${id}`).scrollIntoView({ behavior: 'smooth' }); }
        
        function scrollToConceptSection(id) {
            const el = document.getElementById(id);
            if(el) {
                const isMobile = window.innerWidth < 768;
                const headerOffset = isMobile ? 100 : 110; 
                const elementPosition = el.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
          
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        }

        // Accordion Toggle Logic
        function toggleAccordion(id) {
            const el = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);
            if (!el || !icon) return;

            if (el.style.maxHeight && el.style.maxHeight !== '0px') {
                el.style.maxHeight = '0px';
                icon.style.transform = 'rotate(0deg)';
                icon.classList.remove('bg-black', 'text-white');
            } else {
                el.style.maxHeight = el.scrollHeight + "px";
                icon.style.transform = 'rotate(180deg)';
                icon.classList.add('bg-black', 'text-white');
            }
        }
        
        function calculateWithEffect() { calculate(); const panel = document.getElementById('results-panel'); if(panel) { panel.classList.remove('flash-update'); void panel.offsetWidth; panel.classList.add('flash-update'); } }

        function calculate() {
            const rate = CURRENCY[currentCurr].rate;
            const units = getVal('in-units') || 10; const unitArea = getVal('in-area') || 1200;
            const hardCost = getVal('in-hard') || 200; const softCost = getVal('in-soft') || 50; const ffe = getVal('in-ffe') || 40;
            const landArea = getVal('in-land-area') || 2; const landCostPerAcre = getVal('in-land-cost') || 50000; const infraCost = getVal('in-infra') || 200000;
            const adr = getVal('in-adr') || 250; const occ = (getVal('in-occ') || 70) / 100; const opexRatio = (getVal('in-opex') || 30) / 100;
            const capRate = (getVal('in-cap') || 8) / 100;
            const closingCosts = (getVal('in-legal') || 15000) + (getVal('in-permit') || 10000);
            const reserve = getVal('in-reserve') || 20000;
            
            const landLTV = getVal('in-land-ltv') / 100;
            const landRate = getVal('in-land-rate') / 100;
            const landAmort = getVal('in-land-amort') || 20;
            const landIoEl = document.getElementById('in-land-io');
            const landIO = landIoEl ? landIoEl.checked : false;

            const constLTC = getVal('in-const-ltc') / 100;
            const constRate = getVal('in-const-rate') / 100;
            const constTermMonths = getVal('in-const-term') || 18;
            
            const permRate = getVal('in-perm-rate') / 100;
            const permAmort = getVal('in-perm-amort') || 25;
            
            let amenityCost = 0;
            const amenityCards = document.querySelectorAll('.select-card[data-type="amenity"]');
            amenityCards.forEach(card => {
                if(card.classList.contains('active')) {
                    const id = card.dataset.id;
                    amenityCost += parseFloat(document.getElementById(`cost-${id}`).value);
                }
            });
            
            const annualOccupiedNights = units * 365 * occ;
            let totalAncillaryRevenue = 0;
            let ancillaryBreakdownHTML = '';
            let guardrailWarnings = [];

            const ancCards = document.querySelectorAll('.select-card[data-type="ancillary"]');
            ancCards.forEach(card => {
                if(card.classList.contains('active')) {
                    const id = card.dataset.id;
                    const config = ANCILLARY_CONFIG.find(c => c.id === id);
                    if(config) {
                        const fee = parseFloat(document.getElementById(`rev-${id}`).value);
                        const optInPct = parseFloat(document.getElementById(`opt-${id}`).value) / 100;
                        const itemRevenue = fee * annualOccupiedNights * optInPct;
                        totalAncillaryRevenue += itemRevenue;

                        ancillaryBreakdownHTML += `
                            <div class="flex justify-between">
                                <span>${config.name} <span class="text-gray-300">($${fee} @ ${(optInPct*100).toFixed(0)}%)</span></span>
                                <span>${format(itemRevenue)}</span>
                            </div>
                        `;
                    }
                }
            });

            const totalLandCost = landArea * landCostPerAcre;
            const landLoanAmount = totalLandCost * landLTV;
            
            let annualLandDS = 0;
            if (landLoanAmount > 0) {
                if (landIO) {
                    annualLandDS = landLoanAmount * landRate;
                } else {
                    const monthlyRate = landRate / 12;
                    const numPayments = landAmort * 12;
                    const monthlyPayment = landLoanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
                    annualLandDS = monthlyPayment * 12;
                }
            }

            const totalUnitCost = units * unitArea * (hardCost + softCost + ffe);
            const devBaseCost = totalUnitCost + infraCost + amenityCost + closingCosts; 
            
            const utilFactor = 0.60;
            const constLoanBase = devBaseCost * constLTC;
            const constYears = constTermMonths / 12;
            const interestReserve = (constLoanBase * constRate * constYears * utilFactor) / (1 - (constRate * constYears * utilFactor));
            const constLoanTotal = constLoanBase + interestReserve; 
            const totalProjectCost = totalLandCost + devBaseCost + interestReserve;

            const permLoanAmount = constLoanTotal; 
            
            const monthlyPermRate = permRate / 12;
            const numPermPayments = permAmort * 12;
            const monthlyPermPayment = permLoanAmount * (monthlyPermRate * Math.pow(1 + monthlyPermRate, numPermPayments)) / (Math.pow(1 + monthlyPermRate, numPermPayments) - 1);
            const annualPermDS = monthlyPermPayment * 12;

            const roomRev = units * adr * 365 * occ; 
            const grossRev = roomRev + totalAncillaryRevenue;
            
            if (grossRev > 0) {
                const roomShare = totalAncillaryRevenue / roomRev;
                if (roomShare > 0.25) guardrailWarnings.push(`⚠️ Ancillary revenue exceeds 25% of room revenue. This may be flagged by lenders.`);
            }
            
            const opex = grossRev * opexRatio; 
            const noi = grossRev - opex - reserve; 
            const revPar = (grossRev / units) / 365; 
            const valuation = noi / capRate;
            const valueCreation = valuation - totalProjectCost;
            
            const totalAnnualDS = annualLandDS + annualPermDS;
            const dscr = totalAnnualDS > 0 ? noi / totalAnnualDS : 0;
            const cashFlow = noi - totalAnnualDS;

            setTxt('val-land-ltv', (landLTV*100).toFixed(0)+'%');
            setTxt('val-land-rate', (landRate*100).toFixed(2)+'%');
            setTxt('val-land-amort', landAmort);
            setTxt('out-land-loan', format(landLoanAmount));
            setTxt('out-land-ds', format(annualLandDS));

            setTxt('val-const-ltc', (constLTC*100).toFixed(0)+'%');
            setTxt('val-const-rate', (constRate*100).toFixed(2)+'%');
            setTxt('val-const-term', constTermMonths);
            setTxt('val-perm-rate', (permRate*100).toFixed(2)+'%');
            setTxt('val-perm-amort', permAmort);
            setTxt('out-const-loan', format(constLoanTotal));
            setTxt('out-int-reserve', format(interestReserve));
            setTxt('out-perm-ds', format(annualPermDS));

            setTxt('out-dscr', dscr.toFixed(2)+'x');
            const dscrEl = document.getElementById('out-dscr');
            if (dscrEl) {
                if(dscr < 1.25) { dscrEl.classList.add('text-red-500'); dscrEl.classList.remove('text-green-600'); }
                else { dscrEl.classList.add('text-green-600'); dscrEl.classList.remove('text-red-500'); }
            }

            setTxt('val-units', units); setTxt('val-area', unitArea); setTxt('val-hard', format(hardCost)); setTxt('val-soft', format(softCost)); setTxt('val-ffe', format(ffe));
            setTxt('val-land-area', landArea); setTxt('val-land-cost', format(landCostPerAcre)); setTxt('val-infra', format(infraCost));
            setTxt('val-legal', format(getVal('in-legal'))); setTxt('val-permit', format(getVal('in-permit')));
            setTxt('val-adr', format(adr)); setTxt('val-occ', (occ*100).toFixed(0) + '%'); setTxt('val-opex', (opexRatio*100).toFixed(0) + '%');
            setTxt('val-cap', (capRate*100).toFixed(2) + '%'); setTxt('val-reserve', format(reserve));
            setTxt('out-tpc', format(totalProjectCost)); setTxt('out-noi', format(noi)); setTxt('out-val', format(valuation)); setTxt('out-value-creation', format(valueCreation)); setTxt('out-revpar', format(revPar));

            setTxt('disp-revpar', format(revPar));
            setTxt('disp-rev-key', format(grossRev/units));
            setTxt('disp-opex-key', format((opex+reserve)/units));
            
            const noiMargin = grossRev > 0 ? (noi/grossRev)*100 : 0;
            if (document.getElementById('disp-noi-margin')) document.getElementById('disp-noi-margin').innerText = noiMargin.toFixed(1)+'%';
            if (document.getElementById('bar-noi-margin')) document.getElementById('bar-noi-margin').style.width = noiMargin+'%';
            
            setTxt('mob-cost', format(totalProjectCost)); setTxt('mob-val', format(valuation)); setTxt('mob-cf', format(cashFlow));

            const summaryEl = document.getElementById('summary-text');
            if(summaryEl) summaryEl.innerHTML = `Project requires <strong>${format(totalProjectCost - landLoanAmount - constLoanTotal)}</strong> equity. Generates <strong>${format(cashFlow)}</strong> annual cash flow (stabilized). DSCR: <strong>${dscr.toFixed(2)}x</strong>.`;
            
            setTxt('total-ancillary-revenue', format(totalAncillaryRevenue));
            const breakEl = document.getElementById('ancillary-breakdown');
            if(breakEl) breakEl.innerHTML = ancillaryBreakdownHTML || '<span class="italic text-gray-300">No services selected</span>';
            const contribution = grossRev > 0 ? (totalAncillaryRevenue / grossRev * 100).toFixed(1) : 0;
            setTxt('ancillary-contribution', contribution + '%');
            
            const warningEl = document.getElementById('guardrail-warning');
            if(warningEl) {
                if (guardrailWarnings.length > 0) {
                    warningEl.innerHTML = guardrailWarnings.join('<br>');
                    warningEl.classList.add('active');
                } else {
                    warningEl.classList.remove('active');
                }
            }

            const totalDebt = landLoanAmount + constLoanTotal;
            const equityAmount = totalProjectCost - totalDebt;
            const debtPct = totalProjectCost > 0 ? (totalDebt / totalProjectCost) * 100 : 0;
            const equityPct = 100 - debtPct;
            
            if(document.getElementById('bar-debt')) document.getElementById('bar-debt').style.width = debtPct + '%';
            if(document.getElementById('bar-equity')) document.getElementById('bar-equity').style.width = equityPct + '%';
            setTxt('disp-debt-amt', format(totalDebt));
            setTxt('disp-debt-pct', debtPct.toFixed(0)+'%');
            setTxt('disp-equity-amt', format(equityAmount));
            setTxt('disp-equity-pct', equityPct.toFixed(0)+'%');

            let landBal = landLoanAmount;
            let permBal = permLoanAmount;
            let debtScheduleHTML = '';
            let landBals = [];
            let permBals = [];

            for (let i = 1; i <= 5; i++) {
                let annualLandPrincipal = 0;
                let annualLandInterest = 0;
                
                if (landIO && i <= 2) {
                    annualLandInterest = landBal * landRate;
                } else {
                    let tempBal = landBal;
                    const monthlyRate = landRate / 12;
                    const remTerm = landAmort * 12 - (landIO ? 0 : (i-1)*12);
                    const monthlyPmt = remTerm > 0 ? (tempBal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -remTerm)) : 0; 
                    for(let m=0; m<12; m++) {
                        let ipmt = tempBal * monthlyRate;
                        let ppmt = monthlyPmt - ipmt;
                        annualLandInterest += ipmt;
                        annualLandPrincipal += ppmt;
                        tempBal -= ppmt;
                    }
                    if(!landIO) landBal = tempBal; 
                }

                let annualPermPrincipal = 0;
                let annualPermInterest = 0;
                let tempPermBal = permBal;
                const monthlyPermRate = permRate / 12;
                const monthlyPermPmt = annualPermDS / 12; 
                
                for(let m=0; m<12; m++) {
                    let ipmt = tempPermBal * monthlyPermRate;
                    let ppmt = monthlyPermPmt - ipmt;
                    annualPermInterest += ipmt;
                    annualPermPrincipal += ppmt;
                    tempPermBal -= ppmt;
                }
                permBal = tempPermBal;

                landBals.push(landBal);
                permBals.push(permBal);

                debtScheduleHTML += `
                    <tr class="border-b border-gray-100">
                        <td class="text-left py-1 text-gray-500">Year ${i}</td>
                        <td class="py-1">${format(landBal)}</td>
                        <td class="py-1">${format(permBal)}</td>
                        <td class="py-1 text-gray-400">${format(annualLandPrincipal + annualPermPrincipal)}</td>
                        <td class="py-1 text-gray-400">${format(annualLandInterest + annualPermInterest)}</td>
                    </tr>
                `;
            }
            const debtTable = document.getElementById('debt-schedule-body');
            if(debtTable) debtTable.innerHTML = debtScheduleHTML;

            if(charts.debt) {
                charts.debt.data.datasets[0].data = landBals;
                charts.debt.data.datasets[1].data = permBals;
                charts.debt.update();
            }

            const exitValuation = (noi * Math.pow(1.03, 4)) / capRate;
            const remainingLoanBal = landBal + permBal; 
            
            updateProforma(grossRev, opex+reserve, totalAnnualDS, equityAmount, exitValuation, remainingLoanBal, totalProjectCost);
            updateCharts(totalLandCost, totalUnitCost, infraCost+amenityCost, closingCosts, cashFlow, totalAnnualDS, interestReserve);
        }

        function getVal(id) { const el = document.getElementById(id); return el ? parseFloat(el.value) : 0; }
        function setTxt(id, val) { const el = document.getElementById(id); if(el) el.innerText = val; }
        function format(num) {
            if (isNaN(num)) return "0";
            const sym = CURRENCY[currentCurr].symbol;
            if (currentCurr === 'INR') { if (num >= 10000000) return sym + (num / 10000000).toFixed(2) + 'Cr'; if (num >= 100000) return sym + (num / 100000).toFixed(2) + 'L'; } 
            else { if (num >= 1000000000) return sym + (num / 1000000000).toFixed(2) + 'B'; if (num >= 1000000) return sym + (num / 1000000).toFixed(2) + 'M'; }
            if (num >= 1000) return sym + (num / 1000).toFixed(0) + 'k';
            return sym + num.toFixed(0);
        }

        function setCurrency(curr) {
            if(curr === currentCurr) return; 
            const oldRate = CURRENCY[currentCurr].rate; const newRate = CURRENCY[curr].rate; const conversionFactor = newRate / oldRate;
            currentCurr = curr; 
            const cUsd = document.getElementById('curr-usd');
            const cInr = document.getElementById('curr-inr');
            if(cUsd) cUsd.className = curr === 'USD' ? 'w-1/2 text-[10px] font-bold py-1.5 rounded-full bg-white shadow-sm transition-all' : 'w-1/2 text-[10px] font-bold py-1.5 rounded-full text-gray-500 hover:text-black transition-all';
            if(cInr) cInr.className = curr === 'INR' ? 'w-1/2 text-[10px] font-bold py-1.5 rounded-full bg-white shadow-sm transition-all' : 'w-1/2 text-[10px] font-bold py-1.5 rounded-full text-gray-500 hover:text-black transition-all';
            
            monetaryInputs.forEach(id => { const el = document.getElementById(id); if(el) { const newVal = parseFloat(el.value) * conversionFactor; const newMin = parseFloat(el.min) * conversionFactor; const newMax = parseFloat(el.max) * conversionFactor; const newStep = parseFloat(el.step) * conversionFactor; updateInput(id, newVal, newMin, newMax, newStep); } });
            
            AMENITIES_CONFIG.forEach(am => { 
                const id = `cost-${am.id}`; 
                const el = document.getElementById(id); 
                if(el) { 
                    const conf = am[curr];
                    const newVal = parseFloat(el.value) * conversionFactor; 
                    updateInput(id, newVal, 0, conf.max, conf.step); 
                    setTxt(`disp-cost-${am.id}`, format(parseFloat(el.value))); 
                } 
            });
            
            const res = document.getElementById('in-reserve'); 
            if(res) {
                 const newVal = parseFloat(res.value) * conversionFactor; 
                 updateInput('in-reserve', newVal, 0, 500000 * (newRate/75), 5000 * (newRate/75));
            }

             ANCILLARY_CONFIG.forEach(am => { 
                 const id = `rev-${am.id}`; 
                 const el = document.getElementById(id); 
                 if(el) {
                     const conf = am[curr];
                     const newVal = parseFloat(el.value) * conversionFactor; 
                     updateInput(id, newVal, 0, conf.max, conf.step);
                     setTxt(`disp-rev-${am.id}`, 'Fee: ' + format(parseFloat(el.value)));
                 }
             });
            
            calculate(); updatePhilosophyCharts();
        }

        function updateInput(id, val, min, max, step) { const el = document.getElementById(id); if(el) { el.min = min; el.max = max; el.step = step; el.value = val; } }

        function triggerExportOptions(slot) {
            exportSlot = slot;
            const modal = document.getElementById('export-modal');
            if(modal) modal.classList.remove('hidden');
        }

        function closeExportModal() {
            const modal = document.getElementById('export-modal');
            if(modal) modal.classList.add('hidden');
        }

        function performExport(type) {
            if (type === 'csv') {
                exportToCSV(exportSlot);
            } 
            closeExportModal();
        }
        
        function exportToCSV(slot) {
            let scenarioName = slot ? `Scenario_${slot}` : "Current_State";
            const date = new Date().toLocaleDateString();
            
            const getTxtOrEmpty = (id) => { const el = document.getElementById(id); return el ? el.innerText.replace(/,/g, '') : ''; };
            const getValOrEmpty = (id) => { const el = document.getElementById(id); return el ? el.value : ''; };
            const getCheckOrNo = (id) => { const el = document.getElementById(id); return el && el.checked ? "Yes" : "No"; };

            let rows = [
                ["ArchDoor Capital - Investment Model Export"],
                ["Date", date],
                ["Scenario", scenarioName],
                ["Currency", currentCurr],
                []
            ];

            rows.push(["--- INVESTMENT SUMMARY ---"]);
            rows.push(["Total Project Cost", getTxtOrEmpty("out-tpc")]);
            rows.push(["Stabilized NOI", getTxtOrEmpty("out-noi")]);
            rows.push(["Valuation (Exit)", getTxtOrEmpty("out-val")]);
            rows.push(["Value Creation", getTxtOrEmpty("out-value-creation")]);
            rows.push(["Levered IRR", getTxtOrEmpty("val-irr")]);
            rows.push(["Equity Multiple", getTxtOrEmpty("val-em")]);
            rows.push(["Unlevered IRR", getTxtOrEmpty("val-irr-unlev")]);
            rows.push(["Unlevered Multiple", getTxtOrEmpty("val-em-unlev")]);
            rows.push(["Stabilized DSCR", getTxtOrEmpty("out-dscr")]);
            rows.push([]);

            rows.push(["--- DEVELOPMENT INPUTS ---"]);
            rows.push(["Unit Count", getValOrEmpty("in-units")]);
            rows.push(["Unit Area (sq.ft)", getValOrEmpty("in-area")]);
            rows.push(["Hard Costs (/sq.ft)", getValOrEmpty("in-hard")]);
            rows.push(["Soft Costs (/sq.ft)", getValOrEmpty("in-soft")]);
            rows.push(["FF&E (/sq.ft)", getValOrEmpty("in-ffe")]);
            rows.push(["Land Area (Acres)", getValOrEmpty("in-land-area")]);
            rows.push(["Land Cost (/Acre)", getValOrEmpty("in-land-cost")]);
            rows.push(["Site Infrastructure", getValOrEmpty("in-infra")]);
            rows.push(["Legal & Admin", getValOrEmpty("in-legal")]);
            rows.push(["Permitting", getValOrEmpty("in-permit")]);
            rows.push([]);

            rows.push(["--- SELECTED AMENITIES ---"]);
            rows.push(["Amenity", "Status", "Budget"]);
            AMENITIES_CONFIG.forEach(am => {
                const card = document.querySelector(`.select-card[data-type="amenity"][data-id="${am.id}"]`);
                if(card) {
                    const isActive = card.classList.contains('active') ? "Selected" : "Not Selected";
                    const costEl = document.getElementById(`cost-${am.id}`);
                    const cost = costEl ? costEl.value : 0;
                    rows.push([am.name, isActive, isActive === "Selected" ? cost : 0]);
                }
            });
            rows.push([]);

            rows.push(["--- FINANCING STRUCTURE ---"]);
            rows.push(["A. Land Loan"]);
            rows.push(["LTV", getValOrEmpty("in-land-ltv") + "%"]);
            rows.push(["Interest Rate", getValOrEmpty("in-land-rate") + "%"]);
            rows.push(["Amortization", getValOrEmpty("in-land-amort") + " Years"]);
            rows.push(["Interest Only Period", getCheckOrNo("in-land-io")]);
            rows.push(["Loan Amount", getTxtOrEmpty("out-land-loan")]);
            rows.push(["Annual Debt Service", getTxtOrEmpty("out-land-ds")]);
            
            rows.push(["B. Construction Loan"]);
            rows.push(["LTC", getValOrEmpty("in-const-ltc") + "%"]);
            rows.push(["Interest Rate", getValOrEmpty("in-const-rate") + "%"]);
            rows.push(["Term", getValOrEmpty("in-const-term") + " Months"]);
            rows.push(["Loan Amount (Total)", getTxtOrEmpty("out-const-loan")]);
            rows.push(["Interest Reserve", getTxtOrEmpty("out-int-reserve")]);

            rows.push(["C. Permanent Loan"]);
            rows.push(["Interest Rate", getValOrEmpty("in-perm-rate") + "%"]);
            rows.push(["Amortization", getValOrEmpty("in-perm-amort") + " Years"]);
            rows.push(["Annual Debt Service", getTxtOrEmpty("out-perm-ds")]);
            
            rows.push(["D. Capital Stack"]);
            rows.push(["Total Debt", getTxtOrEmpty("disp-debt-amt")]);
            rows.push(["Debt %", getTxtOrEmpty("disp-debt-pct")]);
            rows.push(["Total Equity", getTxtOrEmpty("disp-equity-amt")]);
            rows.push(["Equity %", getTxtOrEmpty("disp-equity-pct")]);
            rows.push([]);

            rows.push(["--- REVENUE & OPERATIONS ---"]);
            rows.push(["Target ADR", getValOrEmpty("in-adr")]);
            rows.push(["Stabilized Occupancy", getValOrEmpty("in-occ") + "%"]);
            rows.push(["OpEx Ratio", getValOrEmpty("in-opex") + "%"]);
            rows.push(["Annual FF&E Reserve", getValOrEmpty("in-reserve")]);
            rows.push(["Exit Cap Rate", getValOrEmpty("in-cap") + "%"]);
            rows.push(["RevPAR", getTxtOrEmpty("out-revpar")]);
            rows.push(["Total Ancillary Revenue", getTxtOrEmpty("total-ancillary-revenue")]);
            rows.push(["Ancillary % of Gross", getTxtOrEmpty("ancillary-contribution")]);
            rows.push([]);

            rows.push(["--- ANCILLARY SERVICES ---"]);
            rows.push(["Service", "Status", "Fee", "Opt-In %"]);
            ANCILLARY_CONFIG.forEach(am => {
                const card = document.querySelector(`.select-card[data-type="ancillary"][data-id="${am.id}"]`);
                if(card) {
                    const isActive = card.classList.contains('active') ? "Active" : "Inactive";
                    const fee = getValOrEmpty(`rev-${am.id}`);
                    const opt = getValOrEmpty(`opt-${am.id}`);
                    rows.push([am.name, isActive, fee, isActive === "Active" ? opt + "%" : "-"]);
                }
            });
            rows.push([]);

            rows.push(["--- 5-YEAR PRO FORMA ---"]);
            const tableBody = document.getElementById("proforma-body");
            const headerRow = ["Metric", "Year 1", "Year 2", "Year 3", "Year 4", "Year 5"];
            rows.push(headerRow);

            if(tableBody) {
                const trs = tableBody.querySelectorAll("tr");
                trs.forEach(tr => {
                    const cells = tr.querySelectorAll("td");
                    let rowData = [];
                    cells.forEach(td => rowData.push(td.innerText.replace(/,/g, '').replace(/[()]/g, ''))); 
                    if(rowData.length > 0) rows.push(rowData);
                });
            }
            
            let csvContent = rows.map(e => e.join(",")).join("\n");
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `ArchDoor_${scenarioName}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function saveCustom(slot) { 
            const data = { 
                curr: currentCurr, 
                inputs: {}, 
                amenities: {},
                ancillary: {}
            }; 
            document.querySelectorAll('#calc-inputs input[type="range"], #calc-financing input, #calc-financing input[type="checkbox"], #calc-revenue input').forEach(el => { 
                if(el.id) data.inputs[el.id] = el.type === 'checkbox' ? el.checked : el.value; 
            }); 
            AMENITIES_CONFIG.forEach(am => { 
                const card = document.querySelector(`.select-card[data-type="amenity"][data-id="${am.id}"]`);
                if(card) {
                    data.amenities[am.id] = { 
                        active: card.classList.contains('active'), 
                        cost: getVal(`cost-${am.id}`)
                    }; 
                }
            });
             ANCILLARY_CONFIG.forEach(am => { 
                const card = document.querySelector(`.select-card[data-type="ancillary"][data-id="${am.id}"]`);
                if(card) {
                    data.ancillary[am.id] = { 
                        active: card.classList.contains('active'),
                        val: getVal(`rev-${am.id}`),
                        opt: getVal(`opt-${am.id}`)
                    }; 
                }
            });
            localStorage.setItem(`archdoor_scenario_${slot}`, JSON.stringify(data)); 
            updateScenarioUI();
            activeScenario = slot;
            const btn = document.getElementById(`btn-save-${slot}`);
            if(btn) {
                btn.classList.remove('text-gray-400'); btn.classList.add('text-green-500');
                setTimeout(() => { btn.classList.remove('text-green-500'); btn.classList.add('text-gray-400'); }, 1000);
            }
        }

        function loadCustom(slot) { 
            const raw = localStorage.getItem(`archdoor_scenario_${slot}`); if(!raw) return; const data = JSON.parse(raw); 
            if(data.curr !== currentCurr) setCurrency(data.curr); 
            for (const [id, val] of Object.entries(data.inputs)) { 
                const el = document.getElementById(id); 
                if(el) { 
                    if(el.type === 'checkbox') { el.checked = val; } 
                    else { el.value = val; } 
                } 
            } 
            
            for (const [id, config] of Object.entries(data.amenities)) { 
                const card = document.querySelector(`.select-card[data-type="amenity"][data-id="${id}"]`);
                if(card) { if(config.active) card.classList.add('active'); else card.classList.remove('active'); }
                const costEl = document.getElementById(`cost-${id}`);
                if(costEl) costEl.value = config.cost; 
                setTxt(`disp-cost-${id}`, format(parseFloat(config.cost))); 
            } 
            
            if(data.ancillary) {
                 for (const [id, config] of Object.entries(data.ancillary)) { 
                    const card = document.querySelector(`.select-card[data-type="ancillary"][data-id="${id}"]`);
                    if(card) { 
                        if(config.active) card.classList.add('active'); else card.classList.remove('active'); 
                        const revEl = document.getElementById(`rev-${id}`);
                        if(revEl) revEl.value = config.val;
                        setTxt(`disp-rev-${id}`, 'Fee: ' + format(parseFloat(config.val)));
                        
                        if(config.opt) {
                            const optEl = document.getElementById(`opt-${id}`);
                            if(optEl) optEl.value = config.opt;
                            setTxt(`disp-opt-${id}`, 'Opt-In: ' + config.opt + '%');
                        }
                    }
                }
            }
            activeScenario = slot; updateScenarioUI(); calculateWithEffect(); 
        }

        function updateScenarioUI() { 
            for(let i=1; i<=3; i++) { 
                const hasData = localStorage.getItem(`archdoor_scenario_${i}`); 
                const loadBtn = document.getElementById(`btn-load-${i}`); 
                if(loadBtn) {
                    loadBtn.classList.remove('active', 'has-data');
                    if(hasData) loadBtn.classList.add('has-data');
                    if(activeScenario === i) loadBtn.classList.add('active');
                }
            } 
        }

        function initCalculatorUI() {
            const amList = document.getElementById('amenities-list');
            if(amList) {
                amList.innerHTML = AMENITIES_CONFIG.map(am => `
                    <div class="select-card p-4 rounded-xl relative overflow-hidden" data-type="amenity" data-id="${am.id}" onclick="toggleCard(event, this)">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-xs font-bold amenity-title">${am.name}</span>
                        </div>
                        <input type="range" id="cost-${am.id}" value="${am[currentCurr].def}" min="0" max="${am[currentCurr].max}" step="${am[currentCurr].step}" oninput="calculate()" onclick="event.stopPropagation()">
                        <div class="text-right text-[10px] text-gray-500 font-mono mt-1 amenity-subtext" id="disp-cost-${am.id}">Budget</div>
                    </div>
                `).join('');
            }
            
            const ancList = document.getElementById('ancillary-list');
            if(ancList) {
                ancList.innerHTML = ANCILLARY_CONFIG.map(am => `
                    <div class="select-card p-4 rounded-xl relative overflow-hidden" data-type="ancillary" data-id="${am.id}" onclick="toggleCard(event, this)">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold amenity-title">${am.name}</span>
                            <span class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">${am.type}</span>
                        </div>
                        <div class="mb-3">
                             <div class="flex justify-between items-center mb-1">
                                <span class="text-[9px] uppercase font-bold text-gray-400">Fee</span>
                                <span class="text-[10px] font-mono text-gray-600" id="disp-rev-${am.id}">Fee: $${am[currentCurr].def}</span>
                             </div>
                             <input type="range" id="rev-${am.id}" value="${am[currentCurr].def}" min="0" max="${am[currentCurr].max}" step="${am[currentCurr].step}" oninput="calculate()" onclick="event.stopPropagation()">
                        </div>
                        <div class="opt-in-control">
                             <div class="flex justify-between items-center mb-1">
                                <span class="text-[9px] uppercase font-bold text-white/80">Opt-In %</span>
                                <span class="text-[10px] font-mono font-bold text-white" id="disp-opt-${am.id}">Opt-In: ${am.adoption}%</span>
                             </div>
                             <input type="range" id="opt-${am.id}" value="${am.adoption}" min="0" max="100" step="1" oninput="calculate()" onclick="event.stopPropagation()">
                        </div>
                    </div>
                `).join('');
            }
            
            AMENITIES_CONFIG.forEach(am => {
                const el = document.getElementById(`cost-${am.id}`);
                if(el) {
                    el.addEventListener('input', (e) => { setTxt(`disp-cost-${am.id}`, format(parseFloat(e.target.value))); });
                    setTxt(`disp-cost-${am.id}`, format(am[currentCurr].def));
                }
            });
            
            ANCILLARY_CONFIG.forEach(am => {
                const revEl = document.getElementById(`rev-${am.id}`);
                if(revEl) {
                    revEl.addEventListener('input', (e) => { setTxt(`disp-rev-${am.id}`, 'Fee: ' + format(parseFloat(e.target.value))); });
                }
                const optEl = document.getElementById(`opt-${am.id}`);
                if(optEl) {
                    optEl.addEventListener('input', (e) => { setTxt(`disp-opt-${am.id}`, 'Opt-In: ' + e.target.value + '%'); });
                }
            });
        }
        
        function toggleCard(e, card) {
            if(e && e.target && e.target.type === 'range') return;
            card.classList.toggle('active');
            calculate();
        }

        function switchCalcTab(tabName) { 
            document.querySelectorAll('.calc-section').forEach(el => el.classList.add('hidden')); 
            const target = document.getElementById(`calc-${tabName}`);
            if(target) target.classList.remove('hidden'); 
            document.querySelectorAll('.calc-tab-btn').forEach(el => el.classList.remove('active')); 
            const btn = document.querySelector(`[data-tab="${tabName}"]`);
            if(btn) btn.classList.add('active'); 
        }
        
        function updateProforma(gross, opex, totalDebt, equity, exitVal, loanBal, totalCost) {
            const growth = 1.03; let cashFlows = []; 
            let unlevCashFlows = []; 
            
            for(let i=1; i<=5; i++) { 
                const g = Math.pow(growth, i-1); 
                const noiYr = (gross * g) - (opex * g);
                const yrCF = noiYr - totalDebt;
                cashFlows.push(yrCF);
                unlevCashFlows.push(noiYr);
            }
            
            const buildRow = (label, startVal, factor) => { let html = `<tr class="border-b border-gray-100"><td class="text-left py-2 text-gray-500">${label}</td>`; for(let i=0; i<5; i++) html += `<td class="py-2">${format(startVal * Math.pow(growth, i) * factor)}</td>`; html += '</tr>'; return html; }; 
            
            const body = document.getElementById('proforma-body');
            if(body) {
                body.innerHTML = buildRow('Gross Revenue', gross, 1) + buildRow('OpEx', opex, 1) + buildRow('NOI', gross - opex, 1) + 
                    `<tr class="border-b border-gray-100"><td class="text-left py-2 text-gray-500">Debt Service</td>${Array(5).fill(`<td class="py-2 text-red-400">(${format(totalDebt)})</td>`).join('')}</tr>` + 
                    `<tr class="font-bold bg-gray-50"><td class="text-left py-2">Cash Flow</td>${cashFlows.map(cf => `<td class="py-2 text-green-600">${format(cf)}</td>`).join('')}</tr>`;
            }
            
            const totalReturn = cashFlows.reduce((a,b)=>a+b, 0) + (exitVal - loanBal); 
            const em = (totalReturn + equity) / equity; 
            const irrEstimate = ((Math.pow(em, 1/5) - 1)*100).toFixed(1);
            
            const totalReturnUnlev = unlevCashFlows.reduce((a,b)=>a+b, 0) + exitVal;
            const emUnlev = totalReturnUnlev / totalCost;
            const irrUnlevEstimate = ((Math.pow(emUnlev, 1/5) - 1)*100).toFixed(1);
            
            setTxt('val-em', isNaN(em) ? '0.0x' : em.toFixed(2) + 'x'); 
            setTxt('val-irr', isNaN(em) ? '0.0%' : irrEstimate + '%'); 
            
            setTxt('val-em-unlev', isNaN(emUnlev) ? '0.0x' : emUnlev.toFixed(2) + 'x');
            setTxt('val-irr-unlev', isNaN(emUnlev) ? '0.0%' : irrUnlevEstimate + '%');
            
            const irrVal = parseFloat(irrEstimate);
            let verdict = "Analyzing...";
            if(irrVal > 25) verdict = "Exceptional (Top Tier)";
            else if(irrVal > 18) verdict = "Strong (Institutional Grade)";
            else if(irrVal > 12) verdict = "Moderate (Value-Add Required)";
            else verdict = "Below Market (Re-evaluate)";
            
            setTxt('investment-inference', `Based on a Levered IRR of ${irrEstimate}%, this project represents a "${verdict}" investment opportunity.`);
        }
        
        function updateCharts(land, units, infra, closing, cf, debt, intReserve) { 
            if(!charts.cost) return; 
            charts.cost.data.datasets[0].data = [land, units, infra, closing, intReserve]; 
            charts.cost.update(); 
            const growth = 1.03; 
            if(charts.cf) {
                charts.cf.data.datasets[0].data = Array(5).fill(debt); 
                charts.cf.data.datasets[1].data = Array(5).fill(0).map((_, i) => cf * Math.pow(growth, i)); 
                charts.cf.update(); 
            }
        }

        function renderBenchmarks(region) { 
            const data = benchmarks[region]; 
            if(!data) return;
            const btnClassActive = "px-10 py-3 rounded-full text-sm font-bold uppercase tracking-widest transition-all shadow-sm bg-black text-white"; 
            const btnClassInactive = "px-10 py-3 rounded-full text-sm font-bold uppercase tracking-widest transition-all text-gray-500 hover:text-black"; 
            
            const btnUsa = document.getElementById('btn-usa');
            const btnInd = document.getElementById('btn-ind');
            const grid = document.getElementById('benchmark-grid');
            
            if(btnUsa) btnUsa.className = region === 'USA' ? btnClassActive : btnClassInactive; 
            if(btnInd) btnInd.className = region === 'IND' ? btnClassActive : btnClassInactive; 
            
            if(grid) {
                grid.innerHTML = data.map(item => `<a href="${item.url}" target="_blank" class="block p-8 bg-white border border-gray-100 rounded-[2rem] hover:shadow-xl hover:border-gray-200 transition-all group relative overflow-hidden"><div class="absolute top-0 left-0 w-2 h-full brand-gradient opacity-0 group-hover:opacity-100 transition-opacity"></div><div class="flex justify-between items-start mb-8"><div><h3 class="text-2xl font-bold tracking-tight text-black mb-1 group-hover:text-blue-600 transition-colors">${item.name}</h3><p class="text-xs font-semibold text-gray-400 uppercase tracking-widest">${item.loc}</p></div><div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-sm font-bold text-gray-400 group-hover:bg-black group-hover:text-white transition-colors">↗</div></div><div class="grid grid-cols-2 gap-y-8 gap-x-6 border-t border-gray-100 pt-8"><div><span class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Target ADR</span><span class="block text-xl font-bold brand-gradient-text">${item.adr}</span></div><div><span class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Occupancy</span><span class="block text-xl font-bold text-black">${item.occ}</span></div></div></a>`).join(''); 
            }
        }
        
        function filterBenchmarks(r) { renderBenchmarks(r); }
        
        function moveCarousel(dir) { 
            const track = document.getElementById('carousel-track'); 
            if(!track) return;
            currentSlide += dir; 
            if (currentSlide < 0) currentSlide = 1; 
            if (currentSlide > 1) currentSlide = 0; 
            track.style.transform = `translateX(-${currentSlide * 100}%)`; 
        }

        function toggleMute() { 
            const audio = document.getElementById('bg-music'); 
            if(!audio) return;
            audio.muted = !audio.muted; 
            const svg = document.getElementById('sound-icon-svg');
            if(svg) {
                if(audio.muted) {
                    svg.innerHTML = '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line>';
                } else {
                    svg.innerHTML = '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>';
                }
            }
        }

        function cycleInternalImage(galleryId, dir) { 
            const container = document.getElementById(galleryId); 
            if(!container) return;
            const images = container.querySelectorAll('img'); 
            if(!images.length) return;
            let idx = galleryState[galleryId] || 0; 
            if(images[idx]) {
                images[idx].classList.remove('active'); 
                images[idx].classList.add('inactive'); 
            }
            idx += dir; 
            if (idx >= images.length) idx = 0; 
            if (idx < 0) idx = images.length - 1; 
            if(images[idx]) {
                images[idx].classList.remove('inactive'); 
                images[idx].classList.add('active'); 
            }
            galleryState[galleryId] = idx; 
        }
        
        function startInternalGalleries() { 
            // Reduced from 7000ms to 4500ms so the gallery feels active immediately
            const slideDuration = 4500;
            setInterval(() => { 
                const isProject1 = currentSlide === 0;
                const activeGalleryId = isProject1 ? 'gallery-mountain' : 'gallery-lake';
                
                const container = document.getElementById(activeGalleryId);
                if (!container) return;

                const images = container.querySelectorAll('img');
                const currentIndex = galleryState[activeGalleryId] || 0;

                if (currentIndex >= images.length - 1) {
                    cycleInternalImage(activeGalleryId, 1);
                    moveCarousel(1);
                } else {
                    cycleInternalImage(activeGalleryId, 1);
                }
            }, slideDuration); 
        }

        function cyclePlan(dir) {
            const container = document.getElementById('plan-gallery');
            if(!container) return;
            const images = container.querySelectorAll('.plan-image');
            if(!images.length) return;
            
            if(images[planIdx]) {
                images[planIdx].classList.remove('active');
                images[planIdx].classList.add('inactive');
            }
            
            planIdx += dir;
            if(planIdx >= images.length) planIdx = 0;
            if(planIdx < 0) planIdx = images.length - 1;
            
            if(images[planIdx]) {
                images[planIdx].classList.remove('inactive');
                images[planIdx].classList.add('active');
            }

            const modalImg = document.getElementById('plan-modal-img');
            const modal = document.getElementById('plan-modal');
            if (modalImg && modal && !modal.classList.contains('pointer-events-none')) {
                modalImg.src = images[planIdx].src;
            }
        }

        function resetPlanSlideshow() {
            const container = document.getElementById('plan-gallery');
            if(!container) return;
            const images = container.querySelectorAll('.plan-image');
            if(!images.length) return;
            
            images.forEach((img, idx) => {
                if (idx === 0) {
                    img.classList.remove('inactive');
                    img.classList.add('active');
                } else {
                    img.classList.remove('active');
                    img.classList.add('inactive');
                }
            });
            
            planIdx = 0;
            
            if(planPlaying) {
                clearInterval(planTimer);
                planTimer = setInterval(() => cyclePlan(1), 5500);
            }
        }

        function startPlanSlideshow() {
            if(planTimer) clearInterval(planTimer);
            planTimer = setInterval(() => cyclePlan(1), 5500); 
        }

        function togglePlanPlay() {
            planPlaying = !planPlaying;
            const btn = document.getElementById('btn-play-pause');
            if(!btn) return;
            if(planPlaying) {
                btn.innerHTML = pauseSvg;
                startPlanSlideshow();
            } else {
                btn.innerHTML = playSvg;
                clearInterval(planTimer);
            }
        }

        function openPlanModal() {
            const modal = document.getElementById('plan-modal');
            const modalImg = document.getElementById('plan-modal-img');
            const container = document.getElementById('plan-gallery');
            if(!modal || !modalImg || !container) return;

            const images = container.querySelectorAll('.plan-image');
            if(images[planIdx]) modalImg.src = images[planIdx].src;
            
            modal.classList.remove('pointer-events-none', 'opacity-0');
            modal.classList.add('pointer-events-auto', 'opacity-100');
            setTimeout(() => { modalImg.classList.remove('scale-95'); modalImg.classList.add('scale-100'); }, 50);
            
            if(planPlaying) togglePlanPlay();
        }

        function closePlanModal() {
            const modal = document.getElementById('plan-modal');
            const modalImg = document.getElementById('plan-modal-img');
            if(!modal || !modalImg) return;
            
            modal.classList.remove('pointer-events-auto', 'opacity-100');
            modal.classList.add('pointer-events-none', 'opacity-0');
            modalImg.classList.remove('scale-100');
            modalImg.classList.add('scale-95');
        }

        // --- Custom Vanilla JS 360 Viewer ---
        const Experience360 = {
            frames: 51,
            currentFrame: 1,
            isPlaying: true,
            view: 'exterior', // 'exterior' | 'interior'
            images: { exterior: [], interior: [] },
            loaded: { exterior: 0, interior: 0 },
            canvas: null,
            ctx: null,
            lastDrawTime: 0,
            fps: 7, // Reduced from 12 for an even slower, smoother rotation
            dragStartX: 0,
            isDragging: false,
            hasInitialized: false,

            init() {
                if (this.hasInitialized) return;
                this.canvas = document.getElementById('experience-360-canvas');
                if (!this.canvas) return;
                
                this.ctx = this.canvas.getContext('2d');
                // Lock exact native resolution
                this.canvas.width = 1458;
                this.canvas.height = 774;

                this.preload('exterior');
                this.preload('interior');
                this.bindEvents();
                this.loop();
                this.hasInitialized = true;
            },

            preload(type) {
                const folder = type === 'exterior' ? '360e' : '360i';
                for (let i = 1; i <= this.frames; i++) {
                    const img = new Image();
                    const paddedIndex = String(i).padStart(2, '0');
                    img.src = `${folder}/Image${paddedIndex}.png`;
                    img.onload = () => {
                        this.loaded[type]++;
                        // Draw immediately if it's the active view and first image to load
                        if (this.view === type && this.loaded[type] === 1) {
                            this.drawFrame();
                        }
                        // Hide loader once all active view frames are fully loaded
                        if (this.view === type && this.loaded[type] === this.frames) {
                            const loader = document.getElementById('experience-360-loader');
                            if (loader) {
                                loader.style.opacity = '0';
                                setTimeout(() => loader.style.display = 'none', 500);
                            }
                        }
                    };
                    this.images[type].push(img);
                }
            },

            drawFrame() {
                if (!this.canvas) return;
                const imgArray = this.images[this.view];
                const img = imgArray[this.currentFrame - 1];
                
                if (img && img.complete) {
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.ctx.drawImage(img, 0, 0, this.canvas.width, this.canvas.height);
                    
                    const slider = document.getElementById('experience-360-slider');
                    if (slider) slider.value = this.currentFrame;
                }
            },

            nextFrame() {
                this.currentFrame--;
                if (this.currentFrame < 1) this.currentFrame = this.frames;
                this.drawFrame();
            },

            loop(timestamp) {
                if (this.isPlaying) {
                    if (timestamp - this.lastDrawTime > (1000 / this.fps)) {
                        this.nextFrame();
                        this.lastDrawTime = timestamp;
                    }
                }
                requestAnimationFrame((ts) => this.loop(ts));
            },

            togglePlay() {
                this.isPlaying = !this.isPlaying;
                this.updatePlayBtn();
            },

            updatePlayBtn() {
                const btn = document.getElementById('btn-360-play');
                if (!btn) return;
                if (this.isPlaying) {
                    btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>`;
                } else {
                    btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`;
                }
            },

            setView(newView) {
                if (this.view === newView) return;
                
                const btnExt = document.getElementById('btn-360-ext');
                const btnInt = document.getElementById('btn-360-int');
                
                if (newView === 'interior') {
                    if(btnInt) { btnInt.classList.add('bg-black', 'text-white'); btnInt.classList.remove('text-gray-500', 'hover:text-black'); }
                    if(btnExt) { btnExt.classList.remove('bg-black', 'text-white'); btnExt.classList.add('text-gray-500', 'hover:text-black'); }
                } else {
                    if(btnExt) { btnExt.classList.add('bg-black', 'text-white'); btnExt.classList.remove('text-gray-500', 'hover:text-black'); }
                    if(btnInt) { btnInt.classList.remove('bg-black', 'text-white'); btnInt.classList.add('text-gray-500', 'hover:text-black'); }
                }

                // Smooth fade transition
                this.canvas.style.opacity = 0;
                setTimeout(() => {
                    this.view = newView;
                    this.drawFrame();
                    this.canvas.style.opacity = 1;
                }, 150);
            },

            bindEvents() {
                const container = document.getElementById('experience-360-interaction');
                const slider = document.getElementById('experience-360-slider');
                if (!container || !slider) return;

                // Sync Slider
                slider.addEventListener('input', (e) => {
                    this.isPlaying = false;
                    this.updatePlayBtn();
                    this.currentFrame = parseInt(e.target.value);
                    this.drawFrame();
                });

                // Drag Logic
                const startDrag = (x) => {
                    this.isDragging = true;
                    this.dragStartX = x;
                    this.isPlaying = false;
                    this.updatePlayBtn();
                    container.classList.add('cursor-grabbing');
                };

                const doDrag = (x) => {
                    if (!this.isDragging) return;
                    const delta = x - this.dragStartX;
                    const sensitivity = 15; // drag sensitivity (pixels per frame)
                    
                    if (Math.abs(delta) > sensitivity) {
                        const framesToMove = Math.floor(delta / sensitivity);
                        this.currentFrame += framesToMove;
                        
                        // Wrap frame index
                        while(this.currentFrame > this.frames) this.currentFrame -= this.frames;
                        while(this.currentFrame < 1) this.currentFrame += this.frames;
                        
                        this.drawFrame();
                        this.dragStartX = x;
                    }
                };

                const endDrag = () => {
                    this.isDragging = false;
                    container.classList.remove('cursor-grabbing');
                };

                // Mouse Events
                container.addEventListener('mousedown', e => { e.preventDefault(); startDrag(e.clientX); });
                window.addEventListener('mousemove', e => doDrag(e.clientX));
                window.addEventListener('mouseup', endDrag);

                // Touch Events
                container.addEventListener('touchstart', e => startDrag(e.touches[0].clientX), {passive: true});
                window.addEventListener('touchmove', e => doDrag(e.touches[0].clientX), {passive: true});
                window.addEventListener('touchend', endDrag);
            }
        };

        // Initialize 360 Viewer automatically when it enters the viewport
        document.addEventListener("DOMContentLoaded", function() {
            if(typeof IntersectionObserver !== 'undefined') {
                const observer360 = new IntersectionObserver((entries) => {
                    if(entries[0].isIntersecting) {
                        Experience360.init();
                        observer360.disconnect();
                    }
                }, { rootMargin: "600px" }); 
                
                const section360 = document.getElementById('otlo-360');
                if(section360) observer360.observe(section360);
            } else {
                Experience360.init();
            }
        });

        let isExploded = false;

        function setExplodeState(explode) {
            const stage = document.getElementById('explode-stage');
            const highlight = document.getElementById('explode-highlight');
            const btnCol = document.getElementById('btn-col');
            const btnExp = document.getElementById('btn-exp');
            
            if(!stage || !highlight || !btnCol || !btnExp) return;

            isExploded = explode;
            
            if (explode) {
                stage.classList.add('is-exploded');
                highlight.style.transform = 'translateX(40px)';
                
                btnExp.classList.replace('text-gray-400', 'text-white');
                btnExp.classList.remove('hover:text-black');
                btnCol.classList.replace('text-white', 'text-gray-400');
                btnCol.classList.add('hover:text-black');
            } else {
                stage.classList.remove('is-exploded');
                stage.classList.remove('is-focused'); 
                
                highlight.style.transform = 'translateX(0)';
                
                btnCol.classList.replace('text-gray-400', 'text-white');
                btnCol.classList.remove('hover:text-black');
                btnExp.classList.replace('text-white', 'text-gray-400');
                btnExp.classList.add('hover:text-black');
            }
        }

        function toggleExplodeFocus() {
            if (!isExploded) return;
            const stage = document.getElementById('explode-stage');
            if(!stage) return;
            
            if (stage.classList.contains('is-focused')) {
                stage.classList.remove('is-focused');
            } else {
                stage.classList.add('is-focused');
            }
        }
    </script>
</body>
</html>