<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ArchDoor Ventures | Interactive Investment Platform</title>
    <link rel="icon" href="logo/logo.png" type="image/png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f7; color: #1d1d1f; -webkit-font-smoothing: antialiased; }
        .brand-gradient { background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%); }
        .brand-gradient-text { background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Navigation Glass Effect */
        .nav-glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
        
        /* Sliders */
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; background: #e5e5e5; border-radius: 4px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: #1d1d1f; border-radius: 50%; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.2); border: 2px solid #fff; transition: transform 0.2s; }
        input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }

        /* AMENITIES CARD STYLES */
        .select-card { 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            border: 2px solid #e5e7eb; 
            background-color: white; 
            cursor: pointer;
            position: relative;
        }
        .select-card:hover { transform: translateY(-1px); border-color: #d1d5db; }
        
        .select-card .amenity-title { color: #1f2937; }
        .select-card .amenity-subtext { color: #6b7280; }

        /* ACTIVE STATE */
        .select-card.active { 
            background-color: #22c55e; /* Green-500 */
            border-color: #22c55e; 
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        .select-card.active .amenity-title { color: white; }
        .select-card.active .amenity-subtext { color: rgba(255,255,255,0.8); }
        
        /* Slider inside Active Card */
        .select-card.active input[type="range"] { background: rgba(255,255,255,0.3); }
        .select-card.active input[type="range"]::-webkit-slider-thumb { background: white; border-color: white; box-shadow: none; }

        /* Opt-In Control Visibility */
        .select-card .opt-in-control { display: none; }
        .select-card.active .opt-in-control { display: block; animation: fadeIn 0.3s ease; }

        /* Carousel */
        .carousel-track { 
            display: flex; 
            /* Updated transition: Cinematic 3s duration with ultra-smooth easing */
            transition: transform 3s cubic-bezier(0.19, 1, 0.22, 1); 
        }
        .carousel-slide { min-width: 100%; transition: opacity 0.6s ease; position: relative; }
        
        /* Gallery Images - Slower Fade */
        .gallery-image { 
            position: absolute; 
            inset: 0; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            /* Updated fade: 2.5s for very subtle cross-dissolve */
            transition: opacity 2.5s ease-in-out; 
        }
        .gallery-image.active { opacity: 1; z-index: 10; }
        .gallery-image.inactive { opacity: 0; z-index: 0; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes textReveal { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-text-reveal { animation: textReveal 1s ease-out forwards; }
        .flash-update { animation: flash 0.4s ease-out; }
        @keyframes flash { 0% { background-color: rgba(34, 197, 94, 0.1); } 100% { background-color: transparent; } }

        /* Reveal on Scroll */
        .reveal-on-scroll { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .reveal-on-scroll.visible { opacity: 1; transform: translateY(0); }

        /* Utils */
        .calc-tab-btn.active { color: #000; border-bottom: 2px solid #000; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Scenario Button Styles */
        .scenario-dot { width: 24px; height: 24px; border-radius: 50%; border: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; transition: all 0.2s; background: white; color: #9ca3af; }
        .scenario-dot:hover { border-color: #000; color: #000; }
        .scenario-dot.active { background: #22c55e; color: white; border-color: #22c55e; } 
        .scenario-dot.has-data { border-color: #9ca3af; color: #000; } 
        
        /* Mobile Menu */
        #mobile-menu { transition: opacity 0.3s ease, transform 0.3s ease; }
        #mobile-menu.hidden { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        #mobile-menu:not(.hidden) { opacity: 1; pointer-events: auto; transform: translateY(0); }

        .mobile-calc-footer { box-shadow: 0 -4px 20px rgba(0,0,0,0.05); }

        /* Guardrail Warning Styles */
        .guardrail-warning { background-color: #fff1f2; border: 1px solid #fecdd3; color: #be123c; padding: 12px; border-radius: 8px; font-size: 11px; margin-top: 12px; display: none; }
        .guardrail-warning.active { display: block; animation: fadeIn 0.3s ease-in; }

        /* Architectural Patterns (New for Philosophy) */
        .arch-grid {
            background-image: linear-gradient(to right, #e5e7eb 1px, transparent 1px),
                              linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* PRINT STYLES */
        .print-only-header { display: none; }
        @media print {
            @page { margin: 0.5cm; }
            body { background-color: white; color: black; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            nav, #bg-music, .fixed.bottom-6, #tab-philosophy, #tab-benchmarks, #tab-concepts, .mobile-calc-footer, #export-modal, button, .toggle-wrapper { display: none !important; }
            #tab-calculator { display: block !important; height: auto !important; overflow: visible !important; min-height: 0 !important; }
            .print-only-header { display: block !important; margin-bottom: 20px; border-bottom: 4px solid black; padding-bottom: 20px; }
            .grid { display: block !important; }
            .lg\:col-span-5 { display: none !important; }
            .lg\:col-span-7 { width: 100% !important; border: none !important; padding: 0 !important; overflow: visible !important; height: auto !important; }
            #results-panel { height: auto !important; overflow: visible !important; }
            #results-panel > .grid { display: grid !important; grid-template-columns: 1fr 1fr 1fr 1fr !important; gap: 10px; page-break-inside: avoid; }
            .bg-white { box-shadow: none !important; border: 1px solid #eee !important; margin-bottom: 20px; break-inside: avoid; }
            .bg-gray-50 { background-color: #fff !important; border: 1px solid #eee !important; }
            canvas { max-width: 100% !important; max-height: 300px !important; margin-bottom: 20px; }
            h1, h2, h3, h4, p, span { color: black !important; }
            .bg-black { background-color: #111 !important; color: white !important; }
            .bg-black p, .bg-black span { color: white !important; }
        }
    </style>
</head>
<body class="antialiased selection:bg-black selection:text-white overflow-x-hidden text-gray-900 pb-24 lg:pb-0">

    <audio id="bg-music" loop><source src="music/borealis.mp3" type="audio/mpeg"></audio>

    <!-- NAVIGATION -->
    <nav class="fixed top-0 w-full z-50 nav-glass transition-all duration-300">
        <div class="max-w-screen-2xl mx-auto px-4 md:px-6 h-16 md:h-20 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="switchTab('philosophy')">
                <img src="logo/logo.png" alt="ArchDoor Logo" class="w-8 h-8 object-contain">
                <div class="text-base md:text-lg font-bold tracking-tight uppercase">ArchDoor Ventures</div>
            </div>
            
            <!-- Desktop Links -->
            <div class="hidden md:flex gap-8 lg:gap-10 text-xs font-semibold uppercase tracking-widest text-gray-500">
                <button onclick="switchTab('philosophy')" class="hover:text-black transition-colors nav-btn text-black" data-target="philosophy">Philosophy</button>
                <button onclick="switchTab('benchmarks')" class="hover:text-black transition-colors nav-btn" data-target="benchmarks">Benchmarks</button>
                <button onclick="switchTab('concepts')" class="hover:text-black transition-colors nav-btn" data-target="concepts">Concept</button>
                <button onclick="switchTab('calculator')" class="hover:text-black transition-colors nav-btn" data-target="calculator">Investor Engine</button>
            </div>

            <!-- Run Button (Desktop) -->
            <div class="hidden md:block">
                <button onclick="scrollToId('calculator')" class="bg-black text-white px-6 py-2.5 rounded-full text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-all shadow-lg transform hover:scale-105">Calculate ROI</button>
            </div>

            <!-- Mobile Hamburger -->
            <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-black focus:outline-none">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <!-- Mobile Dropdown -->
        <div id="mobile-menu" class="hidden absolute top-16 left-0 w-full bg-white/98 backdrop-blur-xl border-b border-gray-100 shadow-2xl md:hidden flex-col p-6 space-y-4 text-center z-40">
            <button onclick="switchTab('philosophy'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800 border-b border-gray-100">Philosophy</button>
            <button onclick="switchTab('benchmarks'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800 border-b border-gray-100">Benchmarks</button>
            <button onclick="switchTab('concepts'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800 border-b border-gray-100">Concept</button>
            <button onclick="switchTab('calculator'); toggleMobileMenu()" class="block w-full py-4 text-sm font-bold uppercase tracking-widest text-gray-800">Investor Engine</button>
            <button onclick="scrollToId('calculator'); toggleMobileMenu()" class="w-full bg-black text-white px-6 py-4 rounded-xl text-sm font-bold uppercase tracking-widest shadow-lg mt-2">Run Calculator</button>
        </div>
    </nav>

    <main class="pt-16 md:pt-20">

        <!-- TAB 1: PHILOSOPHY -->
        <section id="tab-philosophy" class="tab-content min-h-screen animate-fade-in flex flex-col bg-white">
            
            <!-- Hero Section with Architectural Grid -->
            <div class="relative w-full border-b border-gray-200">
                <div class="absolute inset-0 arch-grid opacity-30 pointer-events-none"></div>
                <div class="absolute inset-0 bg-gradient-to-b from-white/0 to-white/80 pointer-events-none"></div>
                
                <div class="relative max-w-screen-xl mx-auto px-6 text-center pt-20 md:pt-32 pb-16 md:pb-24 z-10">
                    <h1 class="text-5xl md:text-8xl lg:text-[10rem] font-bold tracking-tighter leading-none mb-8 text-black opacity-0 animate-fade-in" style="animation-delay: 0.1s">
                        DESIGN IS <br><span class="brand-gradient-text">LEVERAGE.</span>
                    </h1>
                    <div class="w-20 h-1 bg-black mx-auto mb-8 opacity-0 animate-fade-in" style="animation-delay: 0.3s"></div>
                    <p class="text-lg md:text-3xl max-w-4xl mx-auto font-light leading-relaxed text-gray-600 mb-12 opacity-0 animate-fade-in" style="animation-delay: 0.4s">
                        We align <strong class="text-black font-semibold">architectural innovation</strong> with <strong class="text-black font-semibold">institutional capital</strong> to develop assets that define the next era of hospitality.
                    </p>
                </div>
            </div>

            <!-- Stats Bar - Architectural Rhythm -->
            <div class="w-full border-b border-gray-200 bg-white">
                <div class="max-w-6xl mx-auto px-6 py-12">
                    <div class="grid grid-cols-2 md:grid-cols-4 divide-x divide-gray-100 reveal-on-scroll">
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">14.2%</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">Eco-Tourism CAGR</p>
                        </div>
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">$1.2T</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">Wellness Economy (2025)</p>
                        </div>
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">45%</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">ADR Premium</p>
                        </div>
                        <div class="text-center px-4 group">
                            <p class="text-3xl md:text-5xl font-bold tracking-tighter text-black group-hover:text-blue-600 transition-colors duration-500">High</p>
                            <div class="h-px w-8 bg-gray-300 mx-auto my-3"></div>
                            <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">Barrier to Entry (Design)</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="w-full bg-gray-50/50 py-20 md:py-32">
                <div class="max-w-7xl mx-auto px-6">
                    <!-- Design Ecosystem -->
                    <div class="grid lg:grid-cols-2 gap-16 md:gap-24 mb-24 md:mb-32 reveal-on-scroll items-start">
                        
                        <!-- Left Content -->
                        <div class="space-y-10 sticky top-24">
                            <div>
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-6 h-px bg-blue-600"></div>
                                    <h3 class="text-xs font-bold uppercase tracking-widest text-blue-600">Design as Value Creation</h3>
                                </div>
                                <h2 class="text-4xl md:text-6xl font-bold mb-6 text-black tracking-tight leading-tight">Architecture as the<br>Anchor Amenity</h2>
                                <p class="text-gray-600 leading-relaxed text-lg font-light border-l-2 border-gray-200 pl-6">
                                    In the micro-resort model, the architecture isn't just shelter‚Äîit's the product. We leverage <strong>biophilic principles</strong> and <strong>site-specific modularity</strong> to turn challenging terrain into high-yield inventory.
                                </p>
                            </div>
                            <ul class="space-y-6">
                                <li class="group flex items-start gap-4 p-4 hover:bg-white hover:shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-100">
                                    <span class="w-3 h-3 mt-1.5 border border-black bg-transparent group-hover:bg-black transition-colors duration-300 shrink-0"></span>
                                    <div>
                                        <strong class="block text-black mb-1 text-sm uppercase tracking-wider">Modular & Adaptive</strong>
                                        <span class="text-gray-500 font-light">Prefabricated units reduce construction timelines by 40%.</span>
                                    </div>
                                </li>
                                <li class="group flex items-start gap-4 p-4 hover:bg-white hover:shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-100">
                                    <span class="w-3 h-3 mt-1.5 border border-black bg-transparent group-hover:bg-black transition-colors duration-300 shrink-0"></span>
                                    <div>
                                        <strong class="block text-black mb-1 text-sm uppercase tracking-wider">Experiential Layouts</strong>
                                        <span class="text-gray-500 font-light">Floor plans optimized for wellness and social connection.</span>
                                    </div>
                                </li>
                                <li class="group flex items-start gap-4 p-4 hover:bg-white hover:shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-100">
                                    <span class="w-3 h-3 mt-1.5 border border-black bg-transparent group-hover:bg-black transition-colors duration-300 shrink-0"></span>
                                    <div>
                                        <strong class="block text-black mb-1 text-sm uppercase tracking-wider">Sustainable Luxury</strong>
                                        <span class="text-gray-500 font-light">Passive solar design and off-grid capabilities.</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Right Content - Value Creation Cycle -->
                        <div class="bg-white p-10 md:p-12 rounded-[2rem] shadow-xl shadow-gray-100/50 border border-gray-100 relative">
                            <div class="absolute inset-0 arch-grid opacity-10 pointer-events-none rounded-[2rem]"></div>
                            <div class="relative z-10">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-10 text-center">The Value Creation Cycle</h3>
                                <div class="relative">
                                    <!-- Connecting Line -->
                                    <div class="absolute left-[23px] top-4 bottom-4 w-px bg-gradient-to-b from-gray-200 via-gray-300 to-gray-200"></div>
                                    
                                    <div class="space-y-12">
                                        <!-- Item 1 -->
                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 22h20M2 22V2l20 20"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Distinctive Design</h4>
                                                <p class="text-sm text-gray-500 font-light">Architecture as the primary marketing asset.</p>
                                            </div>
                                        </div>

                                        <!-- Item 2 -->
                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Viral Visibility</h4>
                                                <p class="text-sm text-gray-500 font-light">Organic reach reduces marketing CAC significantly.</p>
                                            </div>
                                        </div>

                                        <!-- Item 3 -->
                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Pricing Power</h4>
                                                <p class="text-sm text-gray-500 font-light">Scarcity drives 45% ADR premiums vs. market.</p>
                                            </div>
                                        </div>

                                        <!-- Item 4 -->
                                        <div class="flex gap-8 group">
                                            <div class="relative z-10 w-12 h-12 rounded-full bg-white border border-black text-black flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                                            </div>
                                            <div class="pt-2">
                                                <h4 class="font-bold text-base mb-1 group-hover:translate-x-1 transition-transform duration-300">Asset Valuation</h4>
                                                <p class="text-sm text-gray-500 font-light">Superior NOI yields higher exit multiples.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Comparison -->
                    <div class="mb-24 md:mb-32 reveal-on-scroll">
                        <div class="text-center mb-16">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-purple-600 mb-3">Market Positioning</h3>
                            <h2 class="text-4xl md:text-5xl font-bold">Defining the Asset Class</h2>
                        </div>
                        <div class="overflow-hidden rounded-3xl border border-gray-200 bg-white shadow-sm">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-50 text-xs font-bold uppercase text-gray-500 tracking-wider">
                                    <tr>
                                        <th class="px-8 py-6">Metric</th>
                                        <th class="px-8 py-6 font-medium">Traditional Hotel</th>
                                        <th class="px-8 py-6 font-medium">Boutique Hotel</th>
                                        <th class="px-8 py-6 bg-black text-white text-base tracking-widest">Micro-Resort</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Guest Experience</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Standardized</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Curated</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">Hyper-Immersive</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Capital Intensity</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">High ($300k+/key)</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Medium ($200k+/key)</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">Optimized ($100-200k/key)</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Staffing Model</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Heavy (0.75 FTE/Key)</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">Medium (0.5 FTE/Key)</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">Lean (0.2 FTE/Key)</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">Development Speed</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">24-36 Months</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">18-24 Months</td>
                                        <td class="px-8 py-6 font-bold text-black border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">6-12 Months</td>
                                    </tr>
                                    <tr class="group hover:bg-gray-50 transition-colors">
                                        <td class="px-8 py-6 font-bold text-gray-900">GOP Margin</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">25-35%</td>
                                        <td class="px-8 py-6 text-gray-500 font-light">30-40%</td>
                                        <td class="px-8 py-6 font-bold text-green-600 border-x border-gray-100 bg-gray-50/50 group-hover:bg-white transition-colors text-base shadow-[inset_0_0_20px_rgba(0,0,0,0.02)]">50-65%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Financial Outlook -->
                    <div class="reveal-on-scroll pb-20 mb-20">
                        <!-- Top Row: Text & Growth Chart -->
                        <div class="grid lg:grid-cols-2 gap-12 md:gap-20 mb-12 items-center">
                            <div>
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-6 h-px bg-green-600"></div>
                                    <h3 class="text-xs font-bold uppercase tracking-widest text-green-600">The Future of Hospitality (2025-2035)</h3>
                                </div>
                                <h2 class="text-3xl md:text-5xl font-bold mb-6">Diversified Revenue Streams</h2>
                                <p class="text-gray-600 leading-relaxed text-lg font-light">Unlike traditional hotels that rely heavily on room revenue, micro-resorts unlock significant wallet share through on-site experiences. Our model targets a <strong>50/50 split</strong> between Room Revenue and Experience Revenue.</p>
                            </div>
                             <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 flex flex-col group hover:shadow-md transition-all duration-500 h-full">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">Asset Appreciation Potential (5-Year)</h3>
                                <div class="relative h-64 w-full flex-grow"><canvas id="growthChart"></canvas></div>
                            </div>
                        </div>

                        <!-- Bottom Row: Aligned Charts -->
                        <div class="grid lg:grid-cols-2 gap-8 md:gap-12">
                            <div class="bg-white p-8 rounded-[2rem] border border-gray-200 shadow-lg relative overflow-hidden group flex flex-col h-full">
                                <div class="absolute inset-0 arch-grid opacity-5 pointer-events-none"></div>
                                <h4 class="text-xs font-bold uppercase text-gray-400 mb-6 tracking-widest">Revenue Composition Comparison</h4>
                                <div class="relative h-64 w-full flex-grow">
                                    <canvas id="compositionChart"></canvas>
                                </div>
                            </div>

                            <div class="bg-black text-white p-8 rounded-[2rem] shadow-2xl flex flex-col relative overflow-hidden group h-full justify-between">
                                <div class="absolute -right-10 -top-10 w-40 h-40 bg-gray-800 rounded-full blur-3xl opacity-20 group-hover:opacity-40 transition-opacity duration-700"></div>
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 relative z-10">Daily Revenue Potential (RevPAR)</h3>
                                <div class="relative h-64 w-full flex-grow z-10"><canvas id="revparChart"></canvas></div>
                                <p class="text-[10px] text-gray-500 mt-6 text-center relative z-10 uppercase tracking-widest">Reflects Ancillary Revenue Uplift ‚Ä¢ Currency: <span id="chart-currency-label">USD</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB 2: BENCHMARKS -->
        <section id="tab-benchmarks" class="tab-content hidden min-h-screen bg-gray-50 relative">
            <div class="absolute inset-0 arch-grid opacity-20 pointer-events-none"></div>
            <div class="py-8 md:py-12 px-6 border-b border-gray-200 bg-white sticky top-16 md:top-20 z-10 shadow-sm md:shadow-none">
                <div class="max-w-7xl mx-auto text-center">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1 block">Market Analysis</span>
                    <h1 class="text-3xl md:text-5xl font-bold tracking-tighter mb-4 text-black">BENCHMARKS.</h1>
                    <div class="mt-2 inline-flex bg-gray-100 p-1 rounded-full">
                        <button onclick="filterBenchmarks('USA')" id="btn-usa" class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest transition-all shadow-sm bg-white text-black">USA</button>
                        <button onclick="filterBenchmarks('IND')" id="btn-ind" class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest transition-all text-gray-500 hover:text-black">India</button>
                    </div>
                </div>
            </div>
            <div class="max-w-7xl mx-auto px-4 md:px-6 py-8 md:py-12"><div id="benchmark-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div></div>
        </section>

        <!-- TAB 3: CONCEPT -->
        <section id="tab-concepts" class="tab-content hidden min-h-screen bg-black overflow-hidden relative">
            <div class="absolute top-20 md:top-24 right-4 md:right-6 z-40">
                <button onclick="toggleMute()" id="mute-btn" class="bg-white/10 backdrop-blur-md border border-white/20 text-white rounded-full px-3 md:px-4 py-1.5 md:py-2 text-[10px] md:text-xs font-bold uppercase tracking-widest hover:bg-white/20 transition-colors flex items-center gap-2"><span>Sound</span> <span id="sound-icon">üîä</span></button>
            </div>
            <div class="relative w-full h-[calc(100vh-64px)] md:h-screen overflow-hidden">
                <div class="carousel-track h-full" id="carousel-track">
                    <!-- Project 1 -->
                    <div class="carousel-slide min-w-full h-full relative group">
                        <div class="absolute inset-0 z-0 bg-gray-900" id="gallery-mountain">
                            <!-- Mountain Day -->
                            <img src="images/msd.png" class="gallery-image active" data-index="0">
                            <!-- Mountain Night -->
                            <img src="images/msn.png" class="gallery-image inactive" data-index="1">
                            <!-- Cabin Day -->
                            <img src="images/mcd.png" class="gallery-image inactive" data-index="2">
                            <!-- Cabin Night -->
                            <img src="images/mcn.png" class="gallery-image inactive" data-index="3">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent z-20"></div>
                        </div>
                        <div class="absolute bottom-24 md:bottom-32 right-6 md:right-10 z-30 flex gap-2">
                            <button onclick="cycleInternalImage('gallery-mountain', -1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">‚Üê</button>
                            <button onclick="cycleInternalImage('gallery-mountain', 1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">‚Üí</button>
                        </div>
                        <div class="absolute bottom-0 left-0 w-full pl-6 md:pl-40 pr-6 md:pr-10 pb-20 pt-10 md:py-20 z-30 flex flex-col justify-end animate-text-reveal pointer-events-none">
                            <div class="max-w-4xl pointer-events-auto">
                                <h4 class="text-blue-400 font-bold uppercase tracking-widest mb-1 text-[10px] md:text-xs">Pipeline Concept</h4>
                                <h2 class="text-3xl md:text-6xl font-bold text-white mb-3 tracking-tighter">ALPINE ESCAPE</h2>
                                <p class="text-white/90 text-xs md:text-base leading-relaxed font-light mb-4 md:mb-6 max-w-xl line-clamp-3 md:line-clamp-none">A high-altitude sanctuary designed to blend seamlessly into the mountain treeline. Features cantilevered sky cabins, panoramic glazing, and Nordic Spa amenities.</p>
                                <div class="border-t border-white/20 pt-3 md:pt-4">
                                    <p class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">Key Experiences</p>
                                    <div class="flex flex-wrap gap-2 md:gap-3 text-[10px] md:text-xs text-white font-medium">
                                        <span class="bg-white/10 px-2 py-1 rounded-full backdrop-blur-sm">Nordic Spa</span><span class="bg-white/10 px-2 py-1 rounded-full backdrop-blur-sm">Infinity Pool</span><span class="bg-white/10 px-2 py-1 rounded-full backdrop-blur-sm">Sky Cabins</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Project 2 -->
                    <div class="carousel-slide min-w-full h-full relative group">
                        <div class="absolute inset-0 z-0 bg-gray-900" id="gallery-lake">
                            <!-- Lake Day -->
                            <img src="images/lsd.png" class="gallery-image active" data-index="0">
                            <!-- Lake Night (New) -->
                            <img src="images/lsn.png" class="gallery-image inactive" data-index="1">
                            <!-- Lake Cabin -->
                            <img src="images/lcd.png" class="gallery-image inactive" data-index="2">
                            <!-- Lake Night -->
                            <img src="images/lcn.png" class="gallery-image inactive" data-index="3">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent z-20"></div>
                        </div>
                        <div class="absolute bottom-24 md:bottom-32 right-6 md:right-10 z-30 flex gap-2">
                            <button onclick="cycleInternalImage('gallery-lake', -1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">‚Üê</button>
                            <button onclick="cycleInternalImage('gallery-lake', 1)" class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-white/30 text-white flex items-center justify-center hover:bg-white/20">‚Üí</button>
                        </div>
                        <div class="absolute bottom-0 left-0 w-full pl-6 md:pl-40 pr-6 md:pr-10 pb-20 pt-10 md:py-20 z-30 flex flex-col justify-end animate-text-reveal pointer-events-none">
                            <div class="max-w-4xl pointer-events-auto">
                                <h4 class="text-green-400 font-bold uppercase tracking-widest mb-1 text-[10px] md:text-xs">Pipeline Concept</h4>
                                <h2 class="text-3xl md:text-6xl font-bold text-white mb-3 tracking-tighter">LAKESIDE HAVEN</h2>
                                <p class="text-white/90 text-xs md:text-base leading-relaxed font-light mb-4 md:mb-6 max-w-xl line-clamp-3 md:line-clamp-none">Amphibious architecture meeting serene waters. Focuses on relaxation, water-based activities, and sustainable vernacular construction.</p>
                                <div class="border-t border-white/20 pt-3 md:pt-4">
                                    <p class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">Key Experiences</p>
                                    <div class="flex flex-wrap gap-2 md:gap-3 text-[10px] md:text-xs text-white font-medium">
                                        <span class="bg-white/10 px-2 py-1 rounded-full backdrop-blur-sm">Lakeside Sauna</span><span class="bg-white/10 px-2 py-1 rounded-full backdrop-blur-sm">Floating Suites</span><span class="bg-white/10 px-2 py-1 rounded-full backdrop-blur-sm">Kayak Club</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Main Nav Arrows -->
                <button onclick="moveCarousel(-1)" class="absolute left-2 md:left-6 top-1/2 -translate-y-1/2 z-40 w-10 h-10 md:w-16 md:h-16 rounded-full bg-white/10 backdrop-blur-lg border border-white/20 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300 group"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg></button>
                <button onclick="moveCarousel(1)" class="absolute right-2 md:right-6 top-1/2 -translate-y-1/2 z-40 w-10 h-10 md:w-16 md:h-16 rounded-full bg-white/10 backdrop-blur-lg border border-white/20 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300 group"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg></button>
            </div>
        </section>

        <!-- TAB 4: INVESTOR CALCULATOR -->
        <section id="tab-calculator" class="tab-content hidden min-h-screen bg-gray-50 flex flex-col print-header">
            <div class="bg-white border-b border-gray-200 px-4 md:px-6 py-4 flex flex-col md:flex-row justify-between items-start md:items-center sticky top-16 md:top-20 z-40 shadow-sm">
                <!-- Calc Tabs -->
                <div class="flex items-center gap-6 overflow-x-auto w-full md:w-auto pb-2 md:pb-0 no-scrollbar">
                    <button onclick="switchCalcTab('inputs')" class="calc-tab-btn active text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="inputs">Project Inputs</button>
                    <button onclick="switchCalcTab('financing')" class="calc-tab-btn text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="financing">Financing</button>
                    <button onclick="switchCalcTab('revenue')" class="calc-tab-btn text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="revenue">Revenue & Ops</button>
                    <button onclick="switchCalcTab('projections')" class="calc-tab-btn text-xs md:text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-black transition-colors whitespace-nowrap" data-tab="projections">Projections</button>
                </div>
                
                <div class="flex items-center gap-3 mt-4 md:mt-0 w-full md:w-auto justify-between md:justify-end">
                    <!-- Scenario Manager -->
                    <div class="flex items-center gap-3 mr-2 bg-gray-50 px-3 py-1.5 rounded-full border border-gray-200">
                        <span class="text-[9px] uppercase font-bold text-gray-400 hidden sm:inline">Scenarios</span>
                        <div class="flex items-center gap-2">
                            <!-- Scenario 1 -->
                            <div class="flex items-center gap-1 group relative">
                                <button onclick="triggerExportOptions(1)" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform mr-1" title="Export">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button onclick="loadCustom(1)" id="btn-load-1" class="scenario-dot" title="Load Scenario 1">1</button>
                                <button onclick="saveCustom(1)" id="btn-save-1" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                            </div>
                            
                            <!-- DIVIDER -->
                            <div class="w-px h-3 bg-gray-300 mx-1"></div>

                            <!-- Scenario 2 -->
                            <div class="flex items-center gap-1 group relative">
                                <button onclick="triggerExportOptions(2)" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform mr-1" title="Export">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button onclick="loadCustom(2)" id="btn-load-2" class="scenario-dot" title="Load Scenario 2">2</button>
                                <button onclick="saveCustom(2)" id="btn-save-2" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                            </div>

                            <!-- DIVIDER -->
                            <div class="w-px h-3 bg-gray-300 mx-1"></div>

                            <!-- Scenario 3 -->
                            <div class="flex items-center gap-1 group relative">
                                <button onclick="triggerExportOptions(3)" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform mr-1" title="Export">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button onclick="loadCustom(3)" id="btn-load-3" class="scenario-dot" title="Load Scenario 3">3</button>
                                <button onclick="saveCustom(3)" id="btn-save-3" class="text-[10px] text-gray-400 hover:text-black hover:scale-110 transition-transform"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="triggerExportOptions(null)" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-widest hover:bg-gray-300 transition-all shadow-sm flex items-center gap-1" title="Export Current"><span>Export</span></button>

                    <div class="flex items-center gap-3">
                        <div class="relative inline-block w-28 align-middle select-none transition duration-200 ease-in">
                            <div class="flex bg-gray-200 rounded-full p-1">
                                <button onclick="setCurrency('USD')" id="curr-usd" class="w-1/2 text-[10px] font-bold py-1.5 rounded-full bg-white shadow-sm transition-all">USD</button>
                                <button onclick="setCurrency('INR')" id="curr-inr" class="w-1/2 text-[10px] font-bold py-1.5 rounded-full text-gray-500 hover:text-black transition-all">INR</button>
                            </div>
                        </div>
                        <div class="text-[8px] md:text-[10px] font-bold text-gray-400 ml-1 animate-pulse whitespace-nowrap" id="live-rate-display">‚óè Live</div>
                    </div>
                    <div class="h-8 w-px bg-gray-200 mx-2"></div>
                    <button onclick="calculateWithEffect()" class="bg-black text-white px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-all shadow-md flex items-center gap-2" title="Run Scenario"><span>Run</span><svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></button>
                </div>
            </div>

            <!-- EXPORT MODAL -->
            <div id="export-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
                <div class="bg-white rounded-2xl p-8 max-w-sm w-full shadow-2xl text-center">
                    <h3 class="text-xl font-bold mb-2">Export Scenario</h3>
                    <p class="text-sm text-gray-500 mb-6">Choose format for your financial model.</p>
                    <div class="space-y-3">
                        <button onclick="performExport('csv')" class="w-full py-3 rounded-xl border border-gray-200 font-bold hover:bg-gray-50 flex items-center justify-center gap-2">
                            <span>üìÑ Download CSV</span>
                        </button>
                    </div>
                    <button onclick="closeExportModal()" class="mt-6 text-xs text-gray-400 hover:text-black">Cancel</button>
                </div>
            </div>

            <div class="flex-grow grid lg:grid-cols-12 gap-0">
                <!-- Left Panel -->
                <div class="lg:col-span-5 bg-white border-r border-gray-200 overflow-y-auto lg:h-[calc(100vh-140px)] p-6 md:p-8">
                    <div id="calc-inputs" class="calc-section space-y-8">
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">1. Unit Mix & Development</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label class="block text-xs font-bold mb-2">Unit Count</label><input type="range" id="in-units" min="5" max="50" value="10" oninput="calculate()"><div class="text-right text-xs font-mono mt-1"><span id="val-units">10</span> Keys</div></div>
                                <div><label class="block text-xs font-bold mb-2">Unit Area (Sq.Ft)</label><input type="range" id="in-area" min="400" max="2000" value="1200" step="50" oninput="calculate()"><div class="text-right text-xs font-mono mt-1"><span id="val-area">1200</span> sq.ft</div></div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-xl space-y-4 border border-gray-100">
                                <p class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Construction Cost Breakdown (Per Sq.Ft)</p>
                                <div><div class="flex justify-between text-xs mb-1"><span>Hard Costs</span><span class="font-mono" id="val-hard"></span></div><input type="range" id="in-hard" min="50" max="500" oninput="calculate()"></div>
                                <div><div class="flex justify-between text-xs mb-1"><span>Soft Costs</span><span class="font-mono" id="val-soft"></span></div><input type="range" id="in-soft" min="10" max="200" oninput="calculate()"></div>
                                <div><div class="flex justify-between text-xs mb-1"><span>FF&E / Furnishing</span><span class="font-mono" id="val-ffe"></span></div><input type="range" id="in-ffe" min="10" max="200" oninput="calculate()"></div>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">2. Land & Site Work</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Land Area (Acres)</span><span class="font-mono" id="val-land-area">2.0</span></div><input type="range" id="in-land-area" min="0.5" max="20" value="2" step="0.5" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Land Cost / Acre</span><span class="font-mono" id="val-land-cost"></span></div><input type="range" id="in-land-cost" min="10000" max="1000000" step="5000" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Site Infra / Utilities</span><span class="font-mono" id="val-infra"></span></div><input type="range" id="in-infra" min="50000" max="2000000" step="10000" oninput="calculate()"></div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">3. Optional Amenities</h3>
                            <div id="amenities-list" class="grid grid-cols-2 gap-3"></div>
                        </div>
                    </div>
                    
                    <div id="calc-financing" class="calc-section hidden space-y-8">
                        <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm mb-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">Capital Stack</h3>
                            <div class="flex h-6 rounded-full overflow-hidden mb-2 bg-gray-100">
                                <div id="bar-debt" class="bg-blue-600 h-full transition-all duration-500" style="width: 65%"></div>
                                <div id="bar-equity" class="bg-green-500 h-full transition-all duration-500" style="width: 35%"></div>
                            </div>
                            <div class="flex justify-between text-xs font-mono font-bold">
                                <span class="text-blue-600">Debt: <span id="disp-debt-amt">$0</span> (<span id="disp-debt-pct">0%</span>)</span>
                                <span class="text-green-600">Equity: <span id="disp-equity-amt">$0</span> (<span id="disp-equity-pct">0%</span>)</span>
                            </div>
                        </div>

                        <!-- 1. LAND PURCHASE FINANCING MODULE -->
                        <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                            <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-700">A. Land Purchase Financing</h3>
                                <span class="text-[10px] bg-gray-200 text-gray-600 px-2 py-1 rounded-full font-bold">Acquisition</span>
                            </div>
                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between text-xs font-bold mb-2"><span>Land LTV</span><span class="font-mono" id="val-land-ltv">50%</span></div>
                                    <input type="range" id="in-land-ltv" min="0" max="80" value="50" oninput="calculate()">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Interest Rate</span><span class="font-mono" id="val-land-rate">8.0%</span></div>
                                        <input type="range" id="in-land-rate" min="3" max="15" value="8" step="0.25" oninput="calculate()">
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Amortization (Yrs)</span><span class="font-mono" id="val-land-amort">20</span></div>
                                        <input type="range" id="in-land-amort" min="5" max="30" value="20" step="5" oninput="calculate()">
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="in-land-io" class="w-4 h-4 accent-black" onchange="calculate()">
                                    <label for="in-land-io" class="text-xs font-bold text-gray-600">Interest-Only Period (First 2 Years)</label>
                                </div>
                                <div class="pt-2 border-t border-gray-200 mt-2 space-y-1">
                                    <div class="flex justify-between text-xs text-gray-500"><span>Land Loan Amount</span><span class="font-mono font-bold text-gray-800" id="out-land-loan">$0</span></div>
                                    <div class="flex justify-between text-xs text-gray-500"><span>Annual Debt Service</span><span class="font-mono font-bold text-gray-800" id="out-land-ds">$0</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. CONSTRUCTION / PERMANENT LOAN MODULE -->
                        <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                            <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-blue-600">B. Construction & Permanent Loan</h3>
                                <span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-bold">Dev & Takeout</span>
                            </div>
                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between text-xs font-bold mb-2"><span>Construction LTV (on Cost)</span><span class="font-mono" id="val-const-ltc">65%</span></div>
                                    <input type="range" id="in-const-ltc" min="0" max="85" value="65" oninput="calculate()">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Const. Rate</span><span class="font-mono" id="val-const-rate">7.5%</span></div>
                                        <input type="range" id="in-const-rate" min="3" max="12" value="7.5" step="0.25" oninput="calculate()">
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs font-bold mb-2"><span>Term (Months)</span><span class="font-mono" id="val-const-term">18</span></div>
                                        <input type="range" id="in-const-term" min="12" max="36" value="18" step="6" oninput="calculate()">
                                    </div>
                                </div>
                                <div class="pt-4 border-t border-gray-200">
                                    <p class="text-[10px] font-bold uppercase tracking-widest text-green-600 mb-3">Permanent Takeout Loan</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <div class="flex justify-between text-xs font-bold mb-2"><span>Perm Rate</span><span class="font-mono" id="val-perm-rate">6.5%</span></div>
                                            <input type="range" id="in-perm-rate" min="3" max="10" value="6.5" step="0.25" oninput="calculate()">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-xs font-bold mb-2"><span>Amortization</span><span class="font-mono" id="val-perm-amort">25</span></div>
                                            <input type="range" id="in-perm-amort" min="15" max="30" value="25" step="5" oninput="calculate()">
                                        </div>
                                    </div>
                                </div>
                                <div class="pt-2 border-t border-gray-200 mt-2 space-y-1">
                                    <div class="flex justify-between text-xs text-gray-500"><span>Construction Loan</span><span class="font-mono font-bold text-gray-800" id="out-const-loan">$0</span></div>
                                    <div class="flex justify-between text-xs text-gray-500"><span>Interest Reserve (Capitalized)</span><span class="font-mono font-bold text-gray-800" id="out-int-reserve">$0</span></div>
                                    <div class="flex justify-between text-xs text-blue-600 font-bold mt-1"><span>Stabilized Annual Debt Service</span><span class="font-mono" id="out-perm-ds">$0</span></div>
                                    <div class="flex justify-between text-xs text-gray-500 mt-1"><span>DSCR (Stabilized)</span><span class="font-mono font-bold" id="out-dscr">1.25x</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- 3. DEBT REPAYMENT TIMELINE -->
                        <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">C. Debt Repayment Timeline</h3>
                            <div class="relative h-40 w-full mb-4">
                                <canvas id="debtScheduleChart"></canvas>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-[10px] text-right">
                                    <thead>
                                        <tr class="text-gray-400 border-b border-gray-100">
                                            <th class="text-left py-1">Year</th>
                                            <th class="py-1">Land Bal</th>
                                            <th class="py-1">Perm Bal</th>
                                            <th class="py-1">Total Principal</th>
                                            <th class="py-1">Total Interest</th>
                                        </tr>
                                    </thead>
                                    <tbody id="debt-schedule-body" class="font-mono text-gray-600"></tbody>
                                </table>
                            </div>
                        </div>

                         <div class="space-y-6 pt-4 border-t border-gray-100">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">Closing Costs</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Legal & Admin</span><span class="font-mono" id="val-legal"></span></div><input type="range" id="in-legal" min="5000" max="200000" step="1000" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Permitting</span><span class="font-mono" id="val-permit"></span></div><input type="range" id="in-permit" min="5000" max="200000" step="1000" oninput="calculate()"></div>
                        </div>
                    </div>

                    <div id="calc-revenue" class="calc-section hidden space-y-8">
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">Top Line</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Target ADR</span><span class="font-mono" id="val-adr"></span></div><input type="range" id="in-adr" min="100" max="2000" step="10" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Stabilized Occupancy</span><span class="font-mono" id="val-occ">70%</span></div><input type="range" id="in-occ" min="30" max="95" value="70" step="1" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>Exit Cap Rate (%)</span><span class="font-mono" id="val-cap">8.0%</span></div><input type="range" id="in-cap" min="3" max="15" value="8" step="0.25" oninput="calculate()"></div>
                        </div>
                        
                        <!-- ANCILLARY REVENUE STREAMS -->
                        <div class="space-y-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">Ancillary Revenue Services</h3>
                            <div id="ancillary-list" class="grid grid-cols-2 gap-3 mb-4"></div>
                            
                            <!-- Ancillary Summary & Breakdown -->
                            <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                                <div class="flex justify-between items-center mb-3">
                                    <span class="text-xs font-bold uppercase text-gray-500">Total Ancillary Revenue</span>
                                    <span class="font-mono font-bold text-black" id="total-ancillary-revenue">$0</span>
                                </div>
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-xs font-bold uppercase text-gray-500">Contribution to Gross Rev</span>
                                    <span class="font-mono font-bold text-blue-600" id="ancillary-contribution">0%</span>
                                </div>
                                <div id="guardrail-warning" class="guardrail-warning"></div>
                                <details class="group mt-2">
                                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none text-xs text-gray-400 hover:text-black transition-colors">
                                        <span>Show Revenue Breakdown</span>
                                        <span class="transition group-open:rotate-180">
                                            <svg fill="none" height="16" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"><path d="M6 9l6 6 6-6"></path></svg>
                                        </span>
                                    </summary>
                                    <div class="text-[10px] text-gray-500 mt-3 space-y-2 border-t border-gray-200 pt-3" id="ancillary-breakdown">
                                        <!-- Breakdown Items Injected Here -->
                                    </div>
                                    <p class="text-[9px] text-gray-400 italic mt-3 text-center">Note: Ancillary revenue varies by seasonality & guest behavior.</p>
                                </details>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-2">Operations & Reserves</h3>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>OpEx Ratio (% of Revenue)</span><span class="font-mono" id="val-opex">30%</span></div><input type="range" id="in-opex" min="15" max="60" value="30" step="1" oninput="calculate()"></div>
                            <div><div class="flex justify-between text-xs font-bold mb-2"><span>FF&E Reserves (Annual)</span><span class="font-mono" id="val-reserve"></span></div><input type="range" id="in-reserve" min="10000" max="500000" step="5000" oninput="calculate()"></div>
                        </div>
                        
                        <!-- RevPAR Analysis Dashboard -->
                        <div class="border-t border-gray-100 pt-8 mt-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">RevPAR Analysis</h3>
                            <div class="bg-black text-white p-6 rounded-2xl mb-4">
                                 <p class="text-4xl font-bold font-mono mb-1" id="disp-revpar">$0</p>
                                 <p class="text-xs opacity-50">Total Revenue Per Available Room (Daily)</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <p class="text-xs font-bold uppercase text-gray-400 mb-1">Gross Rev / Key</p>
                                    <p class="text-lg font-bold font-mono" id="disp-rev-key">$0</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <p class="text-xs font-bold uppercase text-gray-400 mb-1">OpEx / Key</p>
                                    <p class="text-lg font-bold font-mono text-red-500" id="disp-opex-key">$0</p>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-gray-200 mt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-bold">NOI Margin</span>
                                    <span class="text-sm font-mono font-bold text-green-600" id="disp-noi-margin">0%</span>
                                </div>
                                <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                                    <div class="bg-green-500 h-full rounded-full" id="bar-noi-margin" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="calc-projections" class="calc-section hidden">
                        <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-gray-100 pb-4 mb-4">5-Year Proforma</h3>
                        <div class="overflow-x-auto"><table class="w-full text-xs text-right"><thead><tr class="text-gray-400 border-b border-gray-100"><th class="text-left py-2">Metric</th><th class="py-2">Year 1</th><th class="py-2">Year 2</th><th class="py-2">Year 3</th><th class="py-2">Year 4</th><th class="py-2">Year 5</th></tr></thead><tbody id="proforma-body" class="font-mono"></tbody></table></div>
                        
                        <div class="grid grid-cols-2 gap-4 mt-8">
                             <div class="p-4 bg-gray-50 rounded-xl border border-gray-100">
                                <h4 class="text-[10px] font-bold uppercase text-gray-400 mb-2">Unlevered (Project)</h4>
                                <div class="flex justify-between items-center mb-1"><span class="text-xs font-medium">IRR</span><span class="font-mono text-sm font-bold" id="val-irr-unlev">0.0%</span></div>
                                <div class="flex justify-between items-center"><span class="text-xs font-medium">Multiple</span><span class="font-mono text-sm font-bold" id="val-em-unlev">0.0x</span></div>
                            </div>
                            <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                                <h4 class="text-[10px] font-bold uppercase text-blue-400 mb-2">Levered (Equity)</h4>
                                <div class="flex justify-between items-center mb-1"><span class="text-xs font-medium text-blue-900">IRR</span><span class="font-mono text-sm font-bold text-blue-700" id="val-irr">0.0%</span></div>
                                <div class="flex justify-between items-center"><span class="text-xs font-medium text-blue-900">Multiple</span><span class="font-mono text-sm font-bold text-blue-700" id="val-em">0.0x</span></div>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-black text-white rounded-xl text-center shadow-lg">
                            <p class="text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1">Investment Verdict</p>
                            <p class="text-sm font-medium leading-relaxed" id="investment-inference">Calculating...</p>
                        </div>
                    </div>
                </div>

                <!-- Right Panel -->
                <div class="lg:col-span-7 bg-gray-50 p-6 md:p-12 flex flex-col h-[calc(100vh-140px)] overflow-y-auto" id="results-panel">
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-[10px] uppercase font-bold text-gray-400">Total Project Cost</p><p class="text-lg font-bold font-mono mt-1" id="out-tpc">$0</p></div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-[10px] uppercase font-bold text-gray-400">NOI (Stabilized)</p><p class="text-lg font-bold font-mono mt-1 text-blue-600" id="out-noi">$0</p></div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-[10px] uppercase font-bold text-gray-400">Valuation</p><p class="text-lg font-bold font-mono mt-1 text-green-600" id="out-val">$0</p></div>
                        <div class="bg-black text-white p-4 rounded-xl shadow-sm"><p class="text-[10px] uppercase font-bold text-gray-400">Value Creation</p><p class="text-lg font-bold font-mono mt-1" id="out-value-creation">$0</p></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 flex-grow">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 flex flex-col"><h4 class="text-xs font-bold uppercase tracking-widest mb-4">Uses of Funds</h4><div class="flex-grow relative w-full h-48 md:h-56"><canvas id="costChart"></canvas></div></div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 flex flex-col"><h4 class="text-xs font-bold uppercase tracking-widest mb-4">Cash Flow vs Debt Service</h4><div class="flex-grow relative w-full h-48 md:h-56"><canvas id="cfChart"></canvas></div></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-200 text-sm text-gray-600 leading-relaxed mb-10 lg:mb-0"><p id="summary-text">Adjust inputs to generate analysis.</p></div>
                </div>

                <!-- Sticky Mobile Footer -->
                <div class="lg:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 mobile-calc-footer z-50 flex justify-between items-center">
                    <div><p class="text-[10px] uppercase text-gray-400 font-bold">Total Cost</p><p class="font-mono font-bold text-sm" id="mob-cost">$0</p></div>
                    <div><p class="text-[10px] uppercase text-gray-400 font-bold">Valuation</p><p class="font-mono font-bold text-sm text-green-600" id="mob-val">$0</p></div>
                    <div><p class="text-[10px] uppercase text-gray-400 font-bold">Cash Flow</p><p class="font-mono font-bold text-sm text-blue-600" id="mob-cf">$0</p></div>
                </div>
            </div>
        </section>

    </main>

    <!-- EXPORT MODAL -->
    <div id="export-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full shadow-2xl text-center">
            <h3 class="text-xl font-bold mb-2">Export Scenario</h3>
            <p class="text-sm text-gray-500 mb-6">Choose format for your financial model.</p>
            <div class="space-y-3">
                <button onclick="performExport('csv')" class="w-full py-3 rounded-xl border border-gray-200 font-bold hover:bg-gray-50 flex items-center justify-center gap-2">
                    <span>üìÑ Download CSV</span>
                </button>
            </div>
            <button onclick="closeExportModal()" class="mt-6 text-xs text-gray-400 hover:text-black">Cancel</button>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        const CURRENCY = { USD: { symbol: '$', rate: 1, locale: 'en-US' }, INR: { symbol: '‚Çπ', rate: 75, locale: 'en-IN' } };
        
        // --- CONFIG ---
        const AMENITIES_CONFIG = [
            { 
                id: 'sauna', name: 'Sauna / Spa', 
                USD: { def: 50000, max: 150000, step: 1000 }, 
                INR: { def: 2500000, max: 10000000, step: 25000 } 
            },
            { 
                id: 'infpool', name: 'Infinity Pool', 
                USD: { def: 150000, max: 300000, step: 1000 }, 
                INR: { def: 7500000, max: 20000000, step: 50000 } 
            },
            { 
                id: 'plunge', name: 'Plunge Pool', 
                USD: { def: 40000, max: 80000, step: 500 }, 
                INR: { def: 2000000, max: 5000000, step: 20000 } 
            },
            { 
                id: 'bar', name: 'Bar / F&B', 
                USD: { def: 100000, max: 250000, step: 1000 }, 
                INR: { def: 5000000, max: 15000000, step: 50000 } 
            },
            { 
                id: 'pickle', name: 'Pickleball Crt', 
                USD: { def: 30000, max: 60000, step: 500 }, 
                INR: { def: 1500000, max: 4000000, step: 20000 } 
            },
            { 
                id: 'bike', name: 'Bike Rentals', 
                USD: { def: 15000, max: 30000, step: 250 }, 
                INR: { def: 500000, max: 2000000, step: 10000 } 
            },
            { 
                id: 'kayak', name: 'Kayaks', 
                USD: { def: 10000, max: 25000, step: 250 }, 
                INR: { def: 400000, max: 1500000, step: 10000 } 
            },
            { 
                id: 'event', name: 'Event Space', 
                USD: { def: 200000, max: 500000, step: 5000 }, 
                INR: { def: 10000000, max: 30000000, step: 100000 } 
            }
        ];

        // Refined Ancillary Config with Adoption & Caps
        const ANCILLARY_CONFIG = [
            { 
                id: 'fire', name: 'Firewood', type: 'convenience', adoption: 40,
                USD: { def: 20, max: 60, step: 1 },
                INR: { def: 500, max: 2500, step: 50 }
            },
            { 
                id: 'minibar', name: 'F&B Basket', type: 'convenience', adoption: 45,
                USD: { def: 45, max: 150, step: 1 },
                INR: { def: 1500, max: 8000, step: 100 }
            },
            { 
                id: 'sauna', name: 'Sauna Access', type: 'experiential', adoption: 25,
                USD: { def: 75, max: 300, step: 5 },
                INR: { def: 3000, max: 15000, step: 250 }
            },
            { 
                id: 'hike', name: 'Guided Hike', type: 'experiential', adoption: 20,
                USD: { def: 90, max: 400, step: 5 },
                INR: { def: 4000, max: 20000, step: 250 }
            },
            { 
                id: 'romance', name: 'Romance Package', type: 'occasional', adoption: 8,
                USD: { def: 150, max: 500, step: 10 },
                INR: { def: 7500, max: 25000, step: 500 }
            },
            { 
                id: 'bday', name: 'Birthday Package', type: 'occasional', adoption: 8,
                USD: { def: 125, max: 400, step: 10 },
                INR: { def: 6000, max: 20000, step: 500 }
            },
            { 
                id: 'vip', name: 'VIP Package', type: 'premium', adoption: 5,
                USD: { def: 350, max: 1500, step: 25 },
                INR: { def: 18000, max: 75000, step: 1000 }
            },
            { 
                id: 'chef', name: 'Private Chef', type: 'premium', adoption: 5,
                USD: { def: 250, max: 1000, step: 25 },
                INR: { def: 12000, max: 60000, step: 500 }
            },
            { 
                id: 'early', name: 'Early Check-in', type: 'occasional', adoption: 12,
                USD: { def: 50, max: 200, step: 5 },
                INR: { def: 2000, max: 8000, step: 250 }
            },
            { 
                id: 'pet', name: 'Pet Fee', type: 'occasional', adoption: 12,
                USD: { def: 75, max: 250, step: 5 },
                INR: { def: 3000, max: 10000, step: 250 }
            }
        ];

        const benchmarks = {
            USA: [{ name: "Live Oak Lake", loc: "Waco, TX", keys: 7, adr: "$450", occ: "85%", feat: "Scarcity Model", url: "https://liveoaklake.com/" }, { name: "Onera", loc: "Texas Hill Country", keys: 20, adr: "$550", occ: "78%", feat: "Unit Density", url: "https://stayonera.com/" }, { name: "Bolt Farm", loc: "Tennessee", keys: 15, adr: "$695", occ: "92%", feat: "Social Virality", url: "https://www.boltfarmtreehouse.com/" }],
            IND: [{ name: "The Machan", loc: "Lonavala", keys: 30, adr: "‚Çπ22k", occ: "80%", feat: "Eco-Engineering", url: "https://www.themachan.com/" }, { name: "Evolve Back", loc: "Coorg", keys: 45, adr: "‚Çπ35k", occ: "75%", feat: "Heritage Luxury", url: "https://www.evolveback.com/coorg/" }, { name: "Ayatana", loc: "Coorg", keys: 50, adr: "‚Çπ28k", occ: "82%", feat: "Landscape Integration", url: "https://www.ayatanacoorg.com/" }]
        };
        const defaults = { hardCost: 200, softCost: 50, ffe: 40, landCost: 50000, infra: 200000, legal: 15000, permit: 10000, adr: 250, reserve: 20000 };
        let currentCurr = 'USD'; let charts = {}; let currentSlide = 0; const galleryState = { 'gallery-mountain': 0, 'gallery-lake': 0 };
        const monetaryInputs = ['in-hard', 'in-soft', 'in-ffe', 'in-land-cost', 'in-infra', 'in-legal', 'in-permit', 'in-adr', 'in-reserve'];
        let activeScenario = null;
        let exportSlot = null;

        window.onload = function() {
            renderBenchmarks('USA'); initCalculatorUI(); initCharts();
            updateScenarioUI();
            
            fetchLiveRate().then(() => {
               updateInput('in-hard', defaults.hardCost, 50, 500, 10);
               updateInput('in-soft', defaults.softCost, 10, 200, 5);
               updateInput('in-ffe', defaults.ffe, 10, 200, 5);
               updateInput('in-land-cost', defaults.landCost, 10000, 1000000, 5000);
               updateInput('in-infra', defaults.infra, 50000, 2000000, 10000);
               updateInput('in-legal', defaults.legal, 5000, 200000, 1000);
               updateInput('in-permit', defaults.permit, 5000, 200000, 1000);
               updateInput('in-adr', defaults.adr, 50, 2000, 10);
               updateInput('in-reserve', defaults.reserve, 5000, 200000, 1000);
               calculate();
            });
            
            startInternalGalleries(); switchTab('philosophy');
            
            document.querySelectorAll('.reveal-on-scroll').forEach(el => {
               if(typeof IntersectionObserver !== 'undefined') {
                   const obs = new IntersectionObserver((entries) => {
                       entries.forEach(entry => {
                           if(entry.isIntersecting) {
                               entry.target.classList.add('visible');
                               obs.unobserve(entry.target);
                           }
                       });
                   });
                   obs.observe(el);
               } else {
                   el.classList.add('visible');
               }
            });
            
            window.toggleMobileMenu = function() { const menu = document.getElementById('mobile-menu'); menu.classList.toggle('hidden'); }
        };

        async function fetchLiveRate() {
            try {
                const response = await fetch('https://open.er-api.com/v6/latest/USD');
                const data = await response.json();
                if(data && data.rates && data.rates.INR) {
                    CURRENCY.INR.rate = data.rates.INR;
                    if(document.getElementById('live-rate-display')) {
                        document.getElementById('live-rate-display').innerHTML = `‚óè Live: 1 USD = ‚Çπ${data.rates.INR.toFixed(2)}`;
                        document.getElementById('live-rate-display').classList.add('text-green-500');
                    }
                }
            } catch (e) {
                console.log('Using fallback rate');
                if(document.getElementById('live-rate-display')) {
                   document.getElementById('live-rate-display').innerHTML = `‚óè Est: 1 USD = ‚Çπ${CURRENCY.INR.rate}`;
                }
            }
        }

        // ... (Charts) ...
        function initCharts() {
            const commonOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: function(context) { return context.dataset.label + ': ' + format(context.raw); } } } } };
            
            charts.growth = new Chart(document.getElementById('growthChart').getContext('2d'), { type: 'line', data: { labels: ['2025', '2027', '2029', '2031', '2033', '2035'], datasets: [{ label: 'Micro-Resort Demand', data: [100, 130, 170, 220, 280, 350], borderColor: '#000', borderWidth: 3, pointBackgroundColor: '#fff', tension: 0.4 }, { label: 'Traditional Hotel', data: [100, 105, 110, 115, 120, 125], borderColor: '#d1d5db', borderWidth: 2, borderDash: [5, 5], tension: 0.4 }] }, options: { ...commonOptions, scales: { y: { display: false } } } });

            charts.revpar = new Chart(document.getElementById('revparChart').getContext('2d'), { type: 'bar', data: { labels: ['Standard Hotel', 'Boutique', 'Micro-Resort'], datasets: [{ label: 'RevPAR Potential', data: [120, 200, 350], backgroundColor: ['#333', '#666', '#00C9FF'], borderRadius: 6 }] }, options: { ...commonOptions, scales: { y: { ticks: { callback: function(value) { return format(value); }, color: '#fff' }, grid: { color: '#333' } }, x: { ticks: { color: '#fff' } } } } });
            
            charts.cost = new Chart(document.getElementById('costChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Land', 'Units', 'Infra/Amenities', 'Closing', 'Construction Interest'], datasets: [{ data: [1,1,1,1,1], backgroundColor: ['#e5e7eb', '#1d1d1f', '#3b82f6', '#9ca3af', '#f59e0b'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' }, tooltip: { callbacks: { label: function(context) { return context.label + ': ' + format(context.raw); } } } }, cutout: '70%' } });
            charts.cf = new Chart(document.getElementById('cfChart').getContext('2d'), { type: 'bar', data: { labels: ['Y1', 'Y2', 'Y3', 'Y4', 'Y5'], datasets: [{ label: 'Debt Service', data: [0,0,0,0,0], backgroundColor: '#ef4444' }, { label: 'Cash Flow', data: [0,0,0,0,0], backgroundColor: '#22c55e' }] }, options: { ...commonOptions, scales: { x: { stacked: true }, y: { stacked: true, display: false } } } });
            charts.comp = new Chart(document.getElementById('compositionChart').getContext('2d'), { type: 'bar', data: { labels: ['Traditional', 'Boutique', 'Micro-Resort'], datasets: [ { label: 'Room', data: [75, 65, 45], backgroundColor: '#d1d5db' }, { label: 'F&B', data: [20, 25, 25], backgroundColor: '#4b5563' }, { label: 'Experience & Wellness', data: [5, 10, 30], backgroundColor: '#22c55e' } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true, grid: { display: false } }, y: { stacked: true, display: false } }, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, usePointStyle: true } }, tooltip: { callbacks: { label: function(context) { return context.dataset.label + ': ' + context.raw + '%'; } } } } } });
            
            // NEW: Debt Schedule Chart
            charts.debt = new Chart(document.getElementById('debtScheduleChart').getContext('2d'), { type: 'bar', data: { labels: ['Y1', 'Y2', 'Y3', 'Y4', 'Y5'], datasets: [{ label: 'Land Balance', data: [0,0,0,0,0], backgroundColor: '#94a3b8' }, { label: 'Perm Loan Balance', data: [0,0,0,0,0], backgroundColor: '#3b82f6' }] }, options: { ...commonOptions, scales: { x: { stacked: true }, y: { stacked: true, display: false } } } });
        }

        function updatePhilosophyCharts() {
            if(!charts.revpar) return;
            const rate = CURRENCY[currentCurr].rate;
            charts.revpar.data.datasets[0].data = [120 * rate, 200 * rate, 350 * rate];
            charts.revpar.update();
        }

        // ... (Standard UI Logic) ...
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('text-black'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.add('text-gray-500'));
            const activeBtn = document.querySelector(`[data-target="${tabId}"]`);
            if(activeBtn) { activeBtn.classList.add('text-black'); activeBtn.classList.remove('text-gray-500'); }
            const audio = document.getElementById('bg-music');
            if(tabId === 'concepts') audio.play().catch(() => {}); else audio.pause();
            setTimeout(() => { if(tabId === 'calculator') { charts.cost?.resize(); charts.cf?.resize(); charts.debt?.resize(); } if(tabId === 'philosophy') { charts.growth?.resize(); charts.revpar?.resize(); charts.comp?.resize(); } }, 50);
        }
        function scrollToId(id) { switchTab(id); document.getElementById(`tab-${id}`).scrollIntoView({ behavior: 'smooth' }); }
        function calculateWithEffect() { calculate(); const panel = document.getElementById('results-panel'); panel.classList.remove('flash-update'); void panel.offsetWidth; panel.classList.add('flash-update'); }

        function calculate() {
            const rate = CURRENCY[currentCurr].rate;
            const units = getVal('in-units') || 10; const unitArea = getVal('in-area') || 1200;
            const hardCost = getVal('in-hard') || 200; const softCost = getVal('in-soft') || 50; const ffe = getVal('in-ffe') || 40;
            const landArea = getVal('in-land-area') || 2; const landCostPerAcre = getVal('in-land-cost') || 50000; const infraCost = getVal('in-infra') || 200000;
            const adr = getVal('in-adr') || 250; const occ = (getVal('in-occ') || 70) / 100; const opexRatio = (getVal('in-opex') || 30) / 100;
            const leverage = (getVal('in-leverage') || 65) / 100; const interestRate = (getVal('in-rate') || 7) / 100; const term = getVal('in-term') || 10;
            const capRate = (getVal('in-cap') || 8) / 100;
            const isLTC = document.querySelector('input[name="finance-type"]:checked')?.value === 'LTC';
            const closingCosts = (getVal('in-legal') || 15000) + (getVal('in-permit') || 10000);
            const reserve = getVal('in-reserve') || 20000;
            
            // --- NEW DEBT INPUTS ---
            const landLTV = getVal('in-land-ltv') / 100;
            const landRate = getVal('in-land-rate') / 100;
            const landAmort = getVal('in-land-amort');
            const landIO = document.getElementById('in-land-io').checked;

            const constLTC = getVal('in-const-ltc') / 100;
            const constRate = getVal('in-const-rate') / 100;
            const constTermMonths = getVal('in-const-term');
            
            const permRate = getVal('in-perm-rate') / 100;
            const permAmort = getVal('in-perm-amort');
            
            let amenityCost = 0;
            const amenityCards = document.querySelectorAll('.select-card[data-type="amenity"]');
            amenityCards.forEach(card => {
                if(card.classList.contains('active')) {
                    const id = card.dataset.id;
                    amenityCost += parseFloat(document.getElementById(`cost-${id}`).value);
                }
            });
            
            // --- ANCILLARY REVENUE CALCULATION ---
            const annualOccupiedNights = units * 365 * occ;
            let totalAncillaryRevenue = 0;
            let ancillaryBreakdownHTML = '';
            let guardrailWarnings = [];

            const ancCards = document.querySelectorAll('.select-card[data-type="ancillary"]');
            ancCards.forEach(card => {
                if(card.classList.contains('active')) {
                    const id = card.dataset.id;
                    const config = ANCILLARY_CONFIG.find(c => c.id === id);
                    if(config) {
                        const fee = parseFloat(document.getElementById(`rev-${id}`).value);
                        const optInPct = parseFloat(document.getElementById(`opt-${id}`).value) / 100;
                        const itemRevenue = fee * annualOccupiedNights * optInPct;
                        totalAncillaryRevenue += itemRevenue;

                        ancillaryBreakdownHTML += `
                            <div class="flex justify-between">
                                <span>${config.name} <span class="text-gray-300">($${fee} @ ${(optInPct*100).toFixed(0)}%)</span></span>
                                <span>${format(itemRevenue)}</span>
                            </div>
                        `;
                    }
                }
            });

            // --- COST & LOAN CALCULATIONS ---
            
            // 1. Land Loan Logic
            const totalLandCost = landArea * landCostPerAcre;
            const landLoanAmount = totalLandCost * landLTV;
            
            // Calculate Annual Land Debt Service
            let annualLandDS = 0;
            if (landLoanAmount > 0) {
                if (landIO) {
                    annualLandDS = landLoanAmount * landRate;
                } else {
                    const monthlyRate = landRate / 12;
                    const numPayments = landAmort * 12;
                    const monthlyPayment = landLoanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
                    annualLandDS = monthlyPayment * 12;
                }
            }

            // 2. Construction Loan Logic
            const totalUnitCost = units * unitArea * (hardCost + softCost + ffe);
            const devBaseCost = totalUnitCost + infraCost + amenityCost + closingCosts; // Excludes land
            
            // Interest Reserve Calculation (Capitalized)
            // Using average utilization of 60% over term
            const utilFactor = 0.60;
            const constLoanBase = devBaseCost * constLTC;
            // Solve for Total Loan where Total = Base + Interest Reserve
            // Reserve = Total * Rate * (Term/12) * Util
            const constYears = constTermMonths / 12;
            const interestReserve = (constLoanBase * constRate * constYears * utilFactor) / (1 - (constRate * constYears * utilFactor));
            const constLoanTotal = constLoanBase + interestReserve; // Gross Loan Amount
            const totalProjectCost = totalLandCost + devBaseCost + interestReserve;

            // 3. Permanent Loan Logic (Takeout)
            // Assumes Perm Loan refinances Construction Loan Total
            const permLoanAmount = constLoanTotal; 
            
            // Calculate Stabilized Perm Debt Service
            const monthlyPermRate = permRate / 12;
            const numPermPayments = permAmort * 12;
            const monthlyPermPayment = permLoanAmount * (monthlyPermRate * Math.pow(1 + monthlyPermRate, numPermPayments)) / (Math.pow(1 + monthlyPermRate, numPermPayments) - 1);
            const annualPermDS = monthlyPermPayment * 12;

            // --- OPERATING METRICS ---
            const roomRev = units * adr * 365 * occ; 
            const grossRev = roomRev + totalAncillaryRevenue;
            
            // Guardrails
            if (grossRev > 0) {
                const roomShare = totalAncillaryRevenue / roomRev;
                if (roomShare > 0.25) guardrailWarnings.push(`‚ö†Ô∏è Ancillary revenue exceeds 25% of room revenue. This may be flagged by lenders.`);
            }
            
            const opex = grossRev * opexRatio; 
            const noi = grossRev - opex - reserve; 
            const revPar = (grossRev / units) / 365; 
            const valuation = noi / capRate;
            const valueCreation = valuation - totalProjectCost;
            
            // Total Annual Debt Service (Stabilized) = Land DS + Perm DS
            // (Assuming Land Loan stays in place separate from Perm Loan which takes out Const Loan)
            const totalAnnualDS = annualLandDS + annualPermDS;
            const dscr = totalAnnualDS > 0 ? noi / totalAnnualDS : 0;
            const cashFlow = noi - totalAnnualDS;

            // --- UI UPDATES ---
            
            // Financing Module Outputs
            setTxt('val-land-ltv', (landLTV*100).toFixed(0)+'%');
            setTxt('val-land-rate', (landRate*100).toFixed(2)+'%');
            setTxt('val-land-amort', landAmort);
            setTxt('out-land-loan', format(landLoanAmount));
            setTxt('out-land-ds', format(annualLandDS));

            setTxt('val-const-ltc', (constLTC*100).toFixed(0)+'%');
            setTxt('val-const-rate', (constRate*100).toFixed(2)+'%');
            setTxt('val-const-term', constTermMonths);
            setTxt('val-perm-rate', (permRate*100).toFixed(2)+'%');
            setTxt('val-perm-amort', permAmort);
            setTxt('out-const-loan', format(constLoanTotal));
            setTxt('out-int-reserve', format(interestReserve));
            setTxt('out-perm-ds', format(annualPermDS));

            setTxt('out-dscr', dscr.toFixed(2)+'x');
            const dscrEl = document.getElementById('out-dscr');
            if (dscrEl) {
                if(dscr < 1.25) { dscrEl.classList.add('text-red-500'); dscrEl.classList.remove('text-green-600'); }
                else { dscrEl.classList.add('text-green-600'); dscrEl.classList.remove('text-red-500'); }
            }

            // General Outputs
            setTxt('val-units', units); setTxt('val-area', unitArea); setTxt('val-hard', format(hardCost)); setTxt('val-soft', format(softCost)); setTxt('val-ffe', format(ffe));
            setTxt('val-land-area', landArea); setTxt('val-land-cost', format(landCostPerAcre)); setTxt('val-infra', format(infraCost));
            setTxt('val-legal', format(getVal('in-legal'))); setTxt('val-permit', format(getVal('in-permit')));
            setTxt('val-adr', format(adr)); setTxt('val-occ', (occ*100).toFixed(0) + '%'); setTxt('val-opex', (opexRatio*100).toFixed(0) + '%');
            setTxt('val-cap', (capRate*100).toFixed(2) + '%'); setTxt('val-reserve', format(reserve));
            setTxt('out-tpc', format(totalProjectCost)); setTxt('out-noi', format(noi)); setTxt('out-val', format(valuation)); setTxt('out-value-creation', format(valueCreation)); setTxt('out-revpar', format(revPar));

            setTxt('disp-revpar', format(revPar));
            setTxt('disp-rev-key', format(grossRev/units));
            setTxt('disp-opex-key', format((opex+reserve)/units));
            
            const noiMargin = grossRev > 0 ? (noi/grossRev)*100 : 0;
            if (document.getElementById('disp-noi-margin')) document.getElementById('disp-noi-margin').innerText = noiMargin.toFixed(1)+'%';
            if (document.getElementById('bar-noi-margin')) document.getElementById('bar-noi-margin').style.width = noiMargin+'%';
            
            // Mobile Stats
            setTxt('mob-cost', format(totalProjectCost)); setTxt('mob-val', format(valuation)); setTxt('mob-cf', format(cashFlow));

            document.getElementById('summary-text').innerHTML = `Project requires <strong>${format(totalProjectCost - landLoanAmount - constLoanTotal)}</strong> equity. Generates <strong>${format(cashFlow)}</strong> annual cash flow (stabilized). DSCR: <strong>${dscr.toFixed(2)}x</strong>.`;
            
            // Ancillary Summary
            document.getElementById('total-ancillary-revenue').innerText = format(totalAncillaryRevenue);
            document.getElementById('ancillary-breakdown').innerHTML = ancillaryBreakdownHTML || '<span class="italic text-gray-300">No services selected</span>';
            const contribution = grossRev > 0 ? (totalAncillaryRevenue / grossRev * 100).toFixed(1) : 0;
            document.getElementById('ancillary-contribution').innerText = contribution + '%';
            
            const warningEl = document.getElementById('guardrail-warning');
            if (guardrailWarnings.length > 0) {
                warningEl.innerHTML = guardrailWarnings.join('<br>');
                warningEl.classList.add('active');
            } else {
                warningEl.classList.remove('active');
            }

            // Update Bars
            const totalDebt = landLoanAmount + constLoanTotal;
            const equityAmount = totalProjectCost - totalDebt;
            const debtPct = (totalDebt / totalProjectCost) * 100;
            const equityPct = 100 - debtPct;
            
            document.getElementById('bar-debt').style.width = debtPct + '%';
            document.getElementById('bar-equity').style.width = equityPct + '%';
            setTxt('disp-debt-amt', format(totalDebt));
            setTxt('disp-debt-pct', debtPct.toFixed(0)+'%');
            setTxt('disp-equity-amt', format(equityAmount));
            setTxt('disp-equity-pct', equityPct.toFixed(0)+'%');

            // --- DEBT SCHEDULE CALCULATION ---
            let landBal = landLoanAmount;
            let permBal = permLoanAmount;
            let debtScheduleHTML = '';
            let landBals = [];
            let permBals = [];

            for (let i = 1; i <= 5; i++) {
                // Land Loan Amortization (Annual approximation for timeline)
                let annualLandPrincipal = 0;
                let annualLandInterest = 0;
                
                if (landIO && i <= 2) {
                    annualLandInterest = landBal * landRate;
                } else {
                    // Standard amortization logic for year i
                    // Simplified: Recalculate balance reduction based on remaining term? 
                    // Better: Simulate monthly reduction x 12
                    let tempBal = landBal;
                    const monthlyRate = landRate / 12;
                    const monthlyPmt = (tempBal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -(landAmort * 12 - (landIO ? 0 : (i-1)*12)))); // approx remaining
                    // Actually, simpler to just iterate monthly
                    for(let m=0; m<12; m++) {
                        let ipmt = tempBal * monthlyRate;
                        let ppmt = monthlyPmt - ipmt;
                        annualLandInterest += ipmt;
                        annualLandPrincipal += ppmt;
                        tempBal -= ppmt;
                    }
                    if(!landIO) landBal = tempBal; // Update outer balance
                }

                // Perm Loan Amortization
                let annualPermPrincipal = 0;
                let annualPermInterest = 0;
                let tempPermBal = permBal;
                const monthlyPermRate = permRate / 12;
                // Payment is fixed based on initial amt
                const monthlyPermPmt = annualPermDS / 12; 
                
                for(let m=0; m<12; m++) {
                    let ipmt = tempPermBal * monthlyPermRate;
                    let ppmt = monthlyPermPmt - ipmt;
                    annualPermInterest += ipmt;
                    annualPermPrincipal += ppmt;
                    tempPermBal -= ppmt;
                }
                permBal = tempPermBal;

                landBals.push(landBal);
                permBals.push(permBal);

                debtScheduleHTML += `
                    <tr class="border-b border-gray-100">
                        <td class="text-left py-1 text-gray-500">Year ${i}</td>
                        <td class="py-1">${format(landBal)}</td>
                        <td class="py-1">${format(permBal)}</td>
                        <td class="py-1 text-gray-400">${format(annualLandPrincipal + annualPermPrincipal)}</td>
                        <td class="py-1 text-gray-400">${format(annualLandInterest + annualPermInterest)}</td>
                    </tr>
                `;
            }
            document.getElementById('debt-schedule-body').innerHTML = debtScheduleHTML;

            // Update Debt Chart
            if(charts.debt) {
                charts.debt.data.datasets[0].data = landBals;
                charts.debt.data.datasets[1].data = permBals;
                charts.debt.update();
            }

            // Pro Forma & Other Charts
            const exitValuation = (noi * Math.pow(1.03, 4)) / capRate;
            const remainingLoanBal = landBal + permBal; // Balance at end of Year 5
            
            updateProforma(grossRev, opex+reserve, totalAnnualDS, equityAmount, exitValuation, remainingLoanBal, totalProjectCost);
            updateCharts(totalLandCost, totalUnitCost, infraCost+amenityCost, closingCosts, cashFlow, totalAnnualDS, interestReserve);
        }

        function getVal(id) { const el = document.getElementById(id); return el ? parseFloat(el.value) : 0; }
        function setTxt(id, val) { const el = document.getElementById(id); if(el) el.innerText = val; }
        function format(num) {
            if (isNaN(num)) return "0";
            const sym = CURRENCY[currentCurr].symbol;
            if (currentCurr === 'INR') { if (num >= 10000000) return sym + (num / 10000000).toFixed(2) + 'Cr'; if (num >= 100000) return sym + (num / 100000).toFixed(2) + 'L'; } 
            else { if (num >= 1000000000) return sym + (num / 1000000000).toFixed(2) + 'B'; if (num >= 1000000) return sym + (num / 1000000).toFixed(2) + 'M'; }
            if (num >= 1000) return sym + (num / 1000).toFixed(0) + 'k';
            return sym + num.toFixed(0);
        }

        function setCurrency(curr) {
            if(curr === currentCurr) return; 
            const oldRate = CURRENCY[currentCurr].rate; const newRate = CURRENCY[curr].rate; const conversionFactor = newRate / oldRate;
            currentCurr = curr; 
            document.getElementById('curr-usd').className = curr === 'USD' ? 'w-1/2 text-[10px] font-bold py-1.5 rounded-full bg-white shadow-sm transition-all' : 'w-1/2 text-[10px] font-bold py-1.5 rounded-full text-gray-500 hover:text-black transition-all';
            document.getElementById('curr-inr').className = curr === 'INR' ? 'w-1/2 text-[10px] font-bold py-1.5 rounded-full bg-white shadow-sm transition-all' : 'w-1/2 text-[10px] font-bold py-1.5 rounded-full text-gray-500 hover:text-black transition-all';
            
            // Standard inputs conversion
            monetaryInputs.forEach(id => { const el = document.getElementById(id); if(el) { const newVal = parseFloat(el.value) * conversionFactor; const newMin = parseFloat(el.min) * conversionFactor; const newMax = parseFloat(el.max) * conversionFactor; const newStep = parseFloat(el.step) * conversionFactor; updateInput(id, newVal, newMin, newMax, newStep); } });
            
            // Update Amenities with specialized config
            AMENITIES_CONFIG.forEach(am => { 
                const id = `cost-${am.id}`; 
                const el = document.getElementById(id); 
                if(el) { 
                    const conf = am[curr];
                    const newVal = parseFloat(el.value) * conversionFactor; // Preserve relative value
                    updateInput(id, newVal, 0, conf.max, conf.step); 
                    document.getElementById(`disp-cost-${am.id}`).innerText = format(parseFloat(el.value)); 
                } 
            });
            
            // Reserves
            const res = document.getElementById('in-reserve'); 
            if(res) {
                 const newVal = parseFloat(res.value) * conversionFactor; 
                 updateInput('in-reserve', newVal, 0, 500000 * (newRate/75), 5000 * (newRate/75));
            }

            // Update Ancillary with specialized config
             ANCILLARY_CONFIG.forEach(am => { 
                 const id = `rev-${am.id}`; 
                 const el = document.getElementById(id); 
                 if(el) {
                     const conf = am[curr];
                     const newVal = parseFloat(el.value) * conversionFactor; // Preserve relative value
                     updateInput(id, newVal, 0, conf.max, conf.step);
                     document.getElementById(`disp-rev-${am.id}`).innerText = 'Fee: ' + format(parseFloat(el.value));
                 }
             });
            
            calculate(); updatePhilosophyCharts();
        }

        function updateInput(id, val, min, max, step) { const el = document.getElementById(id); if(el) { el.min = min; el.max = max; el.step = step; el.value = val; } }

        // --- EXPORT FUNCTIONS ---

        function triggerExportOptions(slot) {
            exportSlot = slot;
            // Open modal to let user choose format
            document.getElementById('export-modal').classList.remove('hidden');
        }

        function closeExportModal() {
            document.getElementById('export-modal').classList.add('hidden');
        }

        function performExport(type) {
            if (type === 'csv') {
                exportToCSV(exportSlot);
            } 
            // Removed PDF logic
            closeExportModal();
        }
        
        function exportToCSV(slot) {
            let scenarioName = slot ? `Scenario_${slot}` : "Current_State";
            const date = new Date().toLocaleDateString();
            
            // Helper to clean text
            const getTxt = (id) => {
                const el = document.getElementById(id);
                return el ? el.innerText.replace(/,/g, '') : '';
            };
            const getVal = (id) => {
                const el = document.getElementById(id);
                return el ? el.value : '';
            };
            const getCheck = (id) => {
                const el = document.getElementById(id);
                return el && el.checked ? "Yes" : "No";
            };

            let rows = [
                ["ArchDoor Capital - Investment Model Export"],
                ["Date", date],
                ["Scenario", scenarioName],
                ["Currency", currentCurr],
                []
            ];

            // --- SECTION 1: INVESTMENT SUMMARY ---
            rows.push(["--- INVESTMENT SUMMARY ---"]);
            rows.push(["Total Project Cost", getTxt("out-tpc")]);
            rows.push(["Stabilized NOI", getTxt("out-noi")]);
            rows.push(["Valuation (Exit)", getTxt("out-val")]);
            rows.push(["Value Creation", getTxt("out-value-creation")]);
            rows.push(["Levered IRR", getTxt("val-irr")]);
            rows.push(["Equity Multiple", getTxt("val-em")]);
            rows.push(["Unlevered IRR", getTxt("val-irr-unlev")]);
            rows.push(["Unlevered Multiple", getTxt("val-em-unlev")]);
            rows.push(["Stabilized DSCR", getTxt("out-dscr")]);
            rows.push([]);

            // --- SECTION 2: PROJECT INPUTS ---
            rows.push(["--- DEVELOPMENT INPUTS ---"]);
            rows.push(["Unit Count", getVal("in-units")]);
            rows.push(["Unit Area (sq.ft)", getVal("in-area")]);
            rows.push(["Hard Costs (/sq.ft)", getVal("in-hard")]);
            rows.push(["Soft Costs (/sq.ft)", getVal("in-soft")]);
            rows.push(["FF&E (/sq.ft)", getVal("in-ffe")]);
            rows.push(["Land Area (Acres)", getVal("in-land-area")]);
            rows.push(["Land Cost (/Acre)", getVal("in-land-cost")]);
            rows.push(["Site Infrastructure", getVal("in-infra")]);
            rows.push(["Legal & Admin", getVal("in-legal")]);
            rows.push(["Permitting", getVal("in-permit")]);
            rows.push([]);

            // Amenities
            rows.push(["--- SELECTED AMENITIES ---"]);
            rows.push(["Amenity", "Status", "Budget"]);
            AMENITIES_CONFIG.forEach(am => {
                const card = document.querySelector(`.select-card[data-type="amenity"][data-id="${am.id}"]`);
                const isActive = card.classList.contains('active') ? "Selected" : "Not Selected";
                const cost = document.getElementById(`cost-${am.id}`).value;
                rows.push([am.name, isActive, isActive === "Selected" ? cost : 0]);
            });
            rows.push([]);

            // --- SECTION 3: FINANCING ---
            rows.push(["--- FINANCING STRUCTURE ---"]);
            rows.push(["A. Land Loan"]);
            rows.push(["LTV", getVal("in-land-ltv") + "%"]);
            rows.push(["Interest Rate", getVal("in-land-rate") + "%"]);
            rows.push(["Amortization", getVal("in-land-amort") + " Years"]);
            rows.push(["Interest Only Period", getCheck("in-land-io")]);
            rows.push(["Loan Amount", getTxt("out-land-loan")]);
            rows.push(["Annual Debt Service", getTxt("out-land-ds")]);
            
            rows.push(["B. Construction Loan"]);
            rows.push(["LTC", getVal("in-const-ltc") + "%"]);
            rows.push(["Interest Rate", getVal("in-const-rate") + "%"]);
            rows.push(["Term", getVal("in-const-term") + " Months"]);
            rows.push(["Loan Amount (Total)", getTxt("out-const-loan")]);
            rows.push(["Interest Reserve", getTxt("out-int-reserve")]);

            rows.push(["C. Permanent Loan"]);
            rows.push(["Interest Rate", getVal("in-perm-rate") + "%"]);
            rows.push(["Amortization", getVal("in-perm-amort") + " Years"]);
            rows.push(["Annual Debt Service", getTxt("out-perm-ds")]);
            
            rows.push(["D. Capital Stack"]);
            rows.push(["Total Debt", getTxt("disp-debt-amt")]);
            rows.push(["Debt %", getTxt("disp-debt-pct")]);
            rows.push(["Total Equity", getTxt("disp-equity-amt")]);
            rows.push(["Equity %", getTxt("disp-equity-pct")]);
            rows.push([]);

            // --- SECTION 4: REVENUE & OPS ---
            rows.push(["--- REVENUE & OPERATIONS ---"]);
            rows.push(["Target ADR", getVal("in-adr")]);
            rows.push(["Stabilized Occupancy", getVal("in-occ") + "%"]);
            rows.push(["OpEx Ratio", getVal("in-opex") + "%"]);
            rows.push(["Annual FF&E Reserve", getVal("in-reserve")]);
            rows.push(["Exit Cap Rate", getVal("in-cap") + "%"]);
            rows.push(["RevPAR", getTxt("out-revpar")]);
            rows.push(["Total Ancillary Revenue", getTxt("total-ancillary-revenue")]);
            rows.push(["Ancillary % of Gross", getTxt("ancillary-contribution")]);
            rows.push([]);

            // Ancillary Details
            rows.push(["--- ANCILLARY SERVICES ---"]);
            rows.push(["Service", "Status", "Fee", "Opt-In %"]);
            ANCILLARY_CONFIG.forEach(am => {
                const card = document.querySelector(`.select-card[data-type="ancillary"][data-id="${am.id}"]`);
                const isActive = card.classList.contains('active') ? "Active" : "Inactive";
                const fee = document.getElementById(`rev-${am.id}`).value;
                const opt = document.getElementById(`opt-${am.id}`).value;
                rows.push([am.name, isActive, fee, isActive === "Active" ? opt + "%" : "-"]);
            });
            rows.push([]);

            // --- SECTION 5: 5-YEAR PRO FORMA ---
            rows.push(["--- 5-YEAR PRO FORMA ---"]);
            const tableBody = document.getElementById("proforma-body");
            const headerRow = ["Metric", "Year 1", "Year 2", "Year 3", "Year 4", "Year 5"];
            rows.push(headerRow);

            // Parse the HTML table rows
            if(tableBody) {
                const trs = tableBody.querySelectorAll("tr");
                trs.forEach(tr => {
                    const cells = tr.querySelectorAll("td");
                    let rowData = [];
                    // The label is in the first td
                    cells.forEach(td => rowData.push(td.innerText.replace(/,/g, '').replace(/[()]/g, ''))); 
                    // Note: cleaning parenthesis for debt/negative numbers for cleaner CSV, though some might prefer -
                    if(rowData.length > 0) rows.push(rowData);
                });
            }
            
            let csvContent = rows.map(e => e.join(",")).join("\n");
            
            // BLOB METHOD (More Robust)
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `ArchDoor_${scenarioName}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- SCENARIO SAVE/LOAD ---
        function saveCustom(slot) { 
            const data = { 
                curr: currentCurr, 
                inputs: {}, 
                amenities: {},
                ancillary: {}
            }; 
            document.querySelectorAll('#calc-inputs input[type="range"], #calc-financing input, #calc-financing input[type="checkbox"], #calc-revenue input').forEach(el => { 
                if(el.id) data.inputs[el.id] = el.type === 'checkbox' ? el.checked : el.value; 
            }); 
            AMENITIES_CONFIG.forEach(am => { 
                const card = document.querySelector(`.select-card[data-id="${am.id}"]`);
                data.amenities[am.id] = { 
                    active: card.classList.contains('active'), 
                    cost: document.getElementById(`cost-${am.id}`).value 
                }; 
            });
             ANCILLARY_CONFIG.forEach(am => { 
                const card = document.querySelector(`.select-card[data-type="ancillary"][data-id="${am.id}"]`);
                data.ancillary[am.id] = { 
                    active: card.classList.contains('active'),
                    val: document.getElementById(`rev-${am.id}`).value,
                    opt: document.getElementById(`opt-${am.id}`).value
                }; 
            });
            localStorage.setItem(`archdoor_scenario_${slot}`, JSON.stringify(data)); 
            updateScenarioUI();
            activeScenario = slot;
            const btn = document.getElementById(`btn-save-${slot}`);
            const origColor = btn.classList.contains('text-gray-400') ? 'text-gray-400' : 'text-green-500';
            btn.classList.remove('text-gray-400'); btn.classList.add('text-green-500');
            setTimeout(() => { btn.classList.remove('text-green-500'); btn.classList.add('text-gray-400'); }, 1000);
        }

        function loadCustom(slot) { 
            const raw = localStorage.getItem(`archdoor_scenario_${slot}`); if(!raw) return; const data = JSON.parse(raw); 
            if(data.curr !== currentCurr) setCurrency(data.curr); 
            for (const [id, val] of Object.entries(data.inputs)) { 
                const el = document.getElementById(id); 
                if(el) { 
                    if(el.type === 'checkbox') { el.checked = val; } 
                    else { el.value = val; } 
                } 
            } 
            
            // Amenities
            for (const [id, config] of Object.entries(data.amenities)) { 
                const card = document.querySelector(`.select-card[data-type="amenity"][data-id="${id}"]`);
                if(card) { if(config.active) card.classList.add('active'); else card.classList.remove('active'); }
                document.getElementById(`cost-${id}`).value = config.cost; 
                document.getElementById(`disp-cost-${id}`).innerText = format(parseFloat(config.cost)); 
            } 
            // Ancillary
            if(data.ancillary) {
                 for (const [id, config] of Object.entries(data.ancillary)) { 
                    const card = document.querySelector(`.select-card[data-type="ancillary"][data-id="${id}"]`);
                    if(card) { 
                        if(config.active) card.classList.add('active'); else card.classList.remove('active'); 
                        document.getElementById(`rev-${id}`).value = config.val;
                        document.getElementById(`disp-rev-${id}`).innerText = 'Fee: ' + format(parseFloat(config.val));
                        
                        if(config.opt) {
                            document.getElementById(`opt-${id}`).value = config.opt;
                            document.getElementById(`disp-opt-${id}`).innerText = 'Opt-In: ' + config.opt + '%';
                        }
                    }
                }
            }
            activeScenario = slot; updateScenarioUI(); calculateWithEffect(); 
        }

        function updateScenarioUI() { 
            for(let i=1; i<=3; i++) { 
                const hasData = localStorage.getItem(`archdoor_scenario_${i}`); 
                const loadBtn = document.getElementById(`btn-load-${i}`); 
                loadBtn.classList.remove('active', 'has-data');
                if(hasData) loadBtn.classList.add('has-data');
                if(activeScenario === i) loadBtn.classList.add('active');
            } 
        }

        function initCalculatorUI() {
            // Amenities
            document.getElementById('amenities-list').innerHTML = AMENITIES_CONFIG.map(am => `
                <div class="select-card p-4 rounded-xl relative overflow-hidden" data-type="amenity" data-id="${am.id}" onclick="toggleCard(this)">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-bold amenity-title">${am.name}</span>
                    </div>
                    <input type="range" id="cost-${am.id}" value="${am[currentCurr].def}" min="0" max="${am[currentCurr].max}" step="${am[currentCurr].step}" oninput="calculate()" onclick="event.stopPropagation()">
                    <div class="text-right text-[10px] text-gray-500 font-mono mt-1 amenity-subtext" id="disp-cost-${am.id}">Budget</div>
                </div>
            `).join('');
            
            // Ancillary
            document.getElementById('ancillary-list').innerHTML = ANCILLARY_CONFIG.map(am => `
                <div class="select-card p-4 rounded-xl relative overflow-hidden" data-type="ancillary" data-id="${am.id}" onclick="toggleCard(this)">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold amenity-title">${am.name}</span>
                        <span class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">${am.type}</span>
                    </div>
                    <div class="mb-3">
                         <div class="flex justify-between items-center mb-1">
                            <span class="text-[9px] uppercase font-bold text-gray-400">Fee</span>
                            <span class="text-[10px] font-mono text-gray-600" id="disp-rev-${am.id}">Fee: $${am[currentCurr].def}</span>
                         </div>
                         <input type="range" id="rev-${am.id}" value="${am[currentCurr].def}" min="0" max="${am[currentCurr].max}" step="${am[currentCurr].step}" oninput="calculate()" onclick="event.stopPropagation()">
                    </div>
                    <div class="opt-in-control">
                         <div class="flex justify-between items-center mb-1">
                            <span class="text-[9px] uppercase font-bold text-white/80">Opt-In %</span>
                            <span class="text-[10px] font-mono font-bold text-white" id="disp-opt-${am.id}">Opt-In: ${am.adoption}%</span>
                         </div>
                         <input type="range" id="opt-${am.id}" value="${am.adoption}" min="0" max="100" step="1" oninput="calculate()" onclick="event.stopPropagation()">
                    </div>
                </div>
            `).join('');
            
            AMENITIES_CONFIG.forEach(am => {
                document.getElementById(`cost-${am.id}`).addEventListener('input', (e) => { document.getElementById(`disp-cost-${am.id}`).innerText = format(parseFloat(e.target.value)); });
                document.getElementById(`disp-cost-${am.id}`).innerText = format(am[currentCurr].def);
            });
            
            ANCILLARY_CONFIG.forEach(am => {
                document.getElementById(`rev-${am.id}`).addEventListener('input', (e) => { document.getElementById(`disp-rev-${am.id}`).innerText = 'Fee: ' + format(parseFloat(e.target.value)); });
                
                document.getElementById(`opt-${am.id}`).addEventListener('input', (e) => { 
                    document.getElementById(`disp-opt-${am.id}`).innerText = 'Opt-In: ' + e.target.value + '%'; 
                });
            });
        }
        
        function toggleCard(card) {
            if(event.target.type === 'range') return;
            card.classList.toggle('active');
            calculate();
        }

        function switchCalcTab(tabName) { document.querySelectorAll('.calc-section').forEach(el => el.classList.add('hidden')); document.getElementById(`calc-${tabName}`).classList.remove('hidden'); document.querySelectorAll('.calc-tab-btn').forEach(el => el.classList.remove('active')); document.querySelector(`[data-tab="${tabName}"]`).classList.add('active'); }
        
        function updateProforma(gross, opex, totalDebt, equity, exitVal, loanBal, totalCost) {
            const growth = 1.03; let cashFlows = []; 
            let unlevCashFlows = []; 
            
            for(let i=1; i<=5; i++) { 
                const g = Math.pow(growth, i-1); 
                const noiYr = (gross * g) - (opex * g);
                const yrCF = noiYr - totalDebt; // Assumes fixed debt service for simplicity in Pro Forma view
                cashFlows.push(yrCF);
                unlevCashFlows.push(noiYr);
            }
            
            const buildRow = (label, startVal, factor) => { let html = `<tr class="border-b border-gray-100"><td class="text-left py-2 text-gray-500">${label}</td>`; for(let i=0; i<5; i++) html += `<td class="py-2">${format(startVal * Math.pow(growth, i) * factor)}</td>`; html += '</tr>'; return html; }; 
            
            document.getElementById('proforma-body').innerHTML = buildRow('Gross Revenue', gross, 1) + buildRow('OpEx', opex, 1) + buildRow('NOI', gross - opex, 1) + 
                `<tr class="border-b border-gray-100"><td class="text-left py-2 text-gray-500">Debt Service</td>${Array(5).fill(`<td class="py-2 text-red-400">(${format(totalDebt)})</td>`).join('')}</tr>` + 
                `<tr class="font-bold bg-gray-50"><td class="text-left py-2">Cash Flow</td>${cashFlows.map(cf => `<td class="py-2 text-green-600">${format(cf)}</td>`).join('')}</tr>`;
            
            // Levered (Equity) Metrics
            const totalReturn = cashFlows.reduce((a,b)=>a+b, 0) + (exitVal - loanBal); 
            const em = (totalReturn + equity) / equity; 
            const irrEstimate = ((Math.pow(em, 1/5) - 1)*100).toFixed(1);
            
            // Unlevered (Project) Metrics
            const totalReturnUnlev = unlevCashFlows.reduce((a,b)=>a+b, 0) + exitVal;
            const emUnlev = totalReturnUnlev / totalCost;
            const irrUnlevEstimate = ((Math.pow(emUnlev, 1/5) - 1)*100).toFixed(1);
            
            document.getElementById('val-em').innerText = isNaN(em) ? '0.0x' : em.toFixed(2) + 'x'; 
            document.getElementById('val-irr').innerText = isNaN(em) ? '0.0%' : irrEstimate + '%'; 
            
            document.getElementById('val-em-unlev').innerText = isNaN(emUnlev) ? '0.0x' : emUnlev.toFixed(2) + 'x';
            document.getElementById('val-irr-unlev').innerText = isNaN(emUnlev) ? '0.0%' : irrUnlevEstimate + '%';
            
            const irrVal = parseFloat(irrEstimate);
            let verdict = "Analyzing...";
            if(irrVal > 25) verdict = "Exceptional (Top Tier)";
            else if(irrVal > 18) verdict = "Strong (Institutional Grade)";
            else if(irrVal > 12) verdict = "Moderate (Value-Add Required)";
            else verdict = "Below Market (Re-evaluate)";
            
            document.getElementById('investment-inference').innerText = `Based on a Levered IRR of ${irrEstimate}%, this project represents a "${verdict}" investment opportunity.`;
        }
        
        function updateCharts(land, units, infra, closing, cf, debt, intReserve) { 
            if(!charts.cost) return; 
            charts.cost.data.datasets[0].data = [land, units, infra, closing, intReserve]; 
            charts.cost.update(); 
            const growth = 1.03; 
            charts.cf.data.datasets[0].data = Array(5).fill(debt); 
            charts.cf.data.datasets[1].data = Array(5).fill(0).map((_, i) => cf * Math.pow(growth, i)); 
            charts.cf.update(); 
        }
        function updatePhilosophyCharts() { if(!charts.revpar) return; const rate = CURRENCY[currentCurr].rate; charts.revpar.data.datasets[0].data = [120 * rate, 200 * rate, 350 * rate]; charts.revpar.update(); }
        function renderBenchmarks(region) { const data = benchmarks[region]; const btnClassActive = "px-10 py-3 rounded-full text-sm font-bold uppercase tracking-widest transition-all shadow-sm bg-black text-white"; const btnClassInactive = "px-10 py-3 rounded-full text-sm font-bold uppercase tracking-widest transition-all text-gray-500 hover:text-black"; document.getElementById('btn-usa').className = region === 'USA' ? btnClassActive : btnClassInactive; document.getElementById('btn-ind').className = region === 'IND' ? btnClassActive : btnClassInactive; document.getElementById('benchmark-grid').innerHTML = data.map(item => `<a href="${item.url}" target="_blank" class="block p-8 bg-white border border-gray-100 rounded-[2rem] hover:shadow-xl hover:border-gray-200 transition-all group relative overflow-hidden"><div class="absolute top-0 left-0 w-2 h-full brand-gradient opacity-0 group-hover:opacity-100 transition-opacity"></div><div class="flex justify-between items-start mb-8"><div><h3 class="text-2xl font-bold tracking-tight text-black mb-1 group-hover:text-blue-600 transition-colors">${item.name}</h3><p class="text-xs font-semibold text-gray-400 uppercase tracking-widest">${item.loc}</p></div><div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-sm font-bold text-gray-400 group-hover:bg-black group-hover:text-white transition-colors">‚Üó</div></div><div class="grid grid-cols-2 gap-y-8 gap-x-6 border-t border-gray-100 pt-8"><div><span class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Target ADR</span><span class="block text-xl font-bold brand-gradient-text">${item.adr}</span></div><div><span class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Occupancy</span><span class="block text-xl font-bold text-black">${item.occ}</span></div></div></a>`).join(''); }
        function filterBenchmarks(r) { renderBenchmarks(r); }
        function moveCarousel(dir) { const track = document.getElementById('carousel-track'); currentSlide += dir; if (currentSlide < 0) currentSlide = 1; if (currentSlide > 1) currentSlide = 0; track.style.transform = `translateX(-${currentSlide * 100}%)`; }
        function toggleMute() { const audio = document.getElementById('bg-music'); audio.muted = !audio.muted; document.getElementById('mute-btn').classList.toggle('opacity-50'); }
        function cycleInternalImage(galleryId, dir) { const container = document.getElementById(galleryId); const images = container.querySelectorAll('img'); let idx = galleryState[galleryId]; images[idx].classList.remove('active'); images[idx].classList.add('inactive'); idx += dir; if (idx >= images.length) idx = 0; if (idx < 0) idx = images.length - 1; images[idx].classList.remove('inactive'); images[idx].classList.add('active'); galleryState[galleryId] = idx; }
        
        function startInternalGalleries() { 
            // Updated Timing: 7000ms to accommodate slower transitions
            const slideDuration = 7000;

            setInterval(() => { 
                // Determine active project based on main carousel index (0 = Mountain, 1 = Lake)
                const isProject1 = currentSlide === 0;
                const activeGalleryId = isProject1 ? 'gallery-mountain' : 'gallery-lake';
                
                const container = document.getElementById(activeGalleryId);
                // Safety check in case DOM isn't ready or IDs changed
                if (!container) return;

                const images = container.querySelectorAll('img');
                const currentIndex = galleryState[activeGalleryId];

                // Change 1: Sequencing Logic
                // If we are showing the last image of the current project...
                if (currentIndex >= images.length - 1) {
                    // 1. Reset the current gallery to the first image (wraps to 0) so it's ready for next loop
                    cycleInternalImage(activeGalleryId, 1);
                    
                    // 2. Automatically transition the main carousel to the next project
                    moveCarousel(1);
                } else {
                    // Otherwise, just advance to the next slide within the current project
                    cycleInternalImage(activeGalleryId, 1);
                }
            }, slideDuration); 
        }
    </script>
</body>
</html>